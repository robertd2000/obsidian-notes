# 1.  –ì–æ—Ä—É—Ç–∏–Ω–∞
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –ø–æ–¥—Ä–æ–±–Ω–æ.

**–ì–æ—Ä—É—Ç–∏–Ω–∞ (Goroutine)** ‚Äî —ç—Ç–æ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø–æ—Ç–æ–∫, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —Å—Ä–µ–¥–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Go (Go runtime), –∞ –Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –Ω–∞–ø—Ä—è–º—É—é.

–ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, **—ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –≤ —Ç–æ–º –∂–µ –∞–¥—Ä–µ—Å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ**. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∞ –Ω–∞ –ø–æ—Ç–æ–∫–∏ (threads), –Ω–æ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –æ—Ç–ª–∏—á–∏—è–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≥–æ—Ä—É—Ç–∏–Ω

1.  **–õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å**
    *   –ó–∞–ø—É—Å–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã —Ç—Ä–µ–±—É–µ—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∏–ª–æ–±–∞–π—Ç –ø–∞–º—è—Ç–∏, –∏ –∏—Ö —Å—Ç–µ–∫ –º–æ–∂–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ç–∏ –∏ —Å–∂–∏–º–∞—Ç—å—Å—è.
    *   –î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: –ø–æ—Ç–æ–∫ –û–° –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 1-2 –ú–ë. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –∑–∞–ø—É—Å–∫–∞—Ç—å *–¥–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á* –≥–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –æ—Å–æ–±—ã—Ö –ø—Ä–æ–±–ª–µ–º.

2.  **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
    *   –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go (scheduler), –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Ä–∞–Ω—Ç–∞–π–º–∞, —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏, –∞ –Ω–µ –û–°. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö –ø–æ—Ç–æ–∫–æ–≤ –û–° (–æ–±—ã—á–Ω–æ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —è–¥–µ—Ä CPU).
    *   –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã –ø–æ —ç—Ç–∏–º –ø–æ—Ç–æ–∫–∞–º –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏ –≤ –º–æ–º–µ–Ω—Ç—ã, –∫–æ–≥–¥–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∂–¥–µ—Ç I/O - —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞, —Å–µ—Ç–∏ –∏ —Ç.–¥.) –∏–ª–∏ —è–≤–Ω–æ —É—Å—Ç—É–ø–∞–µ—Ç –º–µ—Å—Ç–æ (`runtime.Gosched()`).

3.  **–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫**
    *   –ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –≥–æ—Ä—É—Ç–∏–Ω—É, –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –µ–µ –≤—ã–∑–æ–≤–æ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `go`.
    *   –ù–µ –Ω—É–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–∞–º–∏, –∫–∞–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Ç–æ–∫–æ–≤ –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö.

### –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä

```go
package main

import (
    "fmt"
    "time"
)

// –û–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
func say(s string) {
    for i := 0; i < 3; i++ {
        time.Sleep(100 * time.Millisecond)
        fmt.Println(s)
    }
}

func main() {
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é say –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ
    go say("–≥–æ—Ä—É—Ç–∏–Ω–∞") // <- –≤–æ—Ç –æ–Ω–∞, –º–∞–≥–∏—è!

    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é say –≤ –≥–ª–∞–≤–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ (main)
    say("–≥–ª–∞–≤–Ω–∞—è")

    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –≥–æ—Ä—É—Ç–∏–Ω–∞ —É—Å–ø–µ–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –¥–æ –≤—ã—Ö–æ–¥–∞ –∏–∑ main
    time.Sleep(500 * time.Millisecond)
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–≤–æ–¥:**
```
–≥–ª–∞–≤–Ω–∞—è
–≥–æ—Ä—É—Ç–∏–Ω–∞
–≥–æ—Ä—É—Ç–∏–Ω–∞
–≥–ª–∞–≤–Ω–∞—è
–≥–ª–∞–≤–Ω–∞—è
–≥–æ—Ä—É—Ç–∏–Ω–∞
```

–í—ã –≤–∏–¥–∏—Ç–µ, —á—Ç–æ –≤—ã–≤–æ–¥ –ø–µ—Ä–µ–º–µ—à–∞–Ω ‚Äî —ç—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`say("–≥–ª–∞–≤–Ω–∞—è")` –∏ `say("–≥–æ—Ä—É—Ç–∏–Ω–∞")`) –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å *–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ*.

### –ê–Ω–∞–ª–æ–≥–∏—è

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã ‚Äî —à–µ—Ñ-–ø–æ–≤–∞—Ä –Ω–∞ –∫—É—Ö–Ω–µ (–≤–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ ‚Äî —ç—Ç–æ `main`).

*   **–ü–æ—Ç–æ–∫ –û–°** ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–∞–Ω—è—Ç—å –µ—â–µ –æ–¥–Ω–æ–≥–æ –ø–æ–≤–∞—Ä–∞. –≠—Ç–æ –¥–æ—Ä–æ–≥–æ (–ø–∞–º—è—Ç—å), –∏ –∏—Ö –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –û–°).
*   **–ì–æ—Ä—É—Ç–∏–Ω–∞** ‚Äî —ç—Ç–æ –∫–∞–∫ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞—Å—Ç—Ä—é–ª—é –Ω–∞ –ø–ª–∏—Ç—É –∏ –ø–æ–π—Ç–∏ —Ä–µ–∑–∞—Ç—å –æ–≤–æ—â–∏, –ø–æ–∫–∞ –æ–Ω–∞ –∑–∞–∫–∏–ø–∞–µ—Ç. –í—ã, –æ–¥–∏–Ω –ø–æ–≤–∞—Ä, –¥–µ–ª–∞–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–ª "–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ", –ø–µ—Ä–µ–∫–ª—é—á–∞—è—Å—å –º–µ–∂–¥—É –Ω–∏–º–∏. –í—ã –Ω–µ –∂–¥–µ—Ç–µ, –ø–æ–∫–∞ –≤–æ–¥–∞ –∑–∞–∫–∏–ø–∏—Ç, —Å—Ç–æ—è –Ω–∞–¥ –∫–∞—Å—Ç—Ä—é–ª–µ–π.

### –î–ª—è —á–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≥–æ—Ä—É—Ç–∏–Ω—ã?

–ì–æ—Ä—É—Ç–∏–Ω—ã ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–∞–¥–∞—á, –≥–¥–µ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ (I/O-bound –∑–∞–¥–∞—á–∏):

*   –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ (–∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Å–≤–æ–µ–π –≥–æ—Ä—É—Ç–∏–Ω–µ).
*   –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
*   –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤.
*   –û–±—â–µ–Ω–∏–µ –ø–æ —Å–µ—Ç–∏ (—Å–æ–∫–µ—Ç—ã).
*   –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (–æ—Ç–ø—Ä–∞–≤–∫–∞ email, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤).

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏ —Å–≤—è–∑—å —Å –∫–∞–Ω–∞–ª–∞–º–∏ (Channels)

1.  **main –∂–¥–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã**: –ï—Å–ª–∏ –≥–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `main` –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –≤ –Ω–µ–π –≥–æ—Ä—É—Ç–∏–Ω—ã –±—É–¥—É—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –ü–æ—ç—Ç–æ–º—É —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ.
2.  **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏**: –ì–æ—Ä—É—Ç–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –∞–¥—Ä–µ—Å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–µ–π –ø–∞–º—è—Ç–∏. –û–¥–Ω–∞–∫–æ –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –≤ –æ–±—â—É—é –ø–∞–º—è—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ. –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ Go –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–∫–∞–Ω–∞–ª—ã (channels)**.

**–ü—Ä–∏–º–µ—Ä —Å –∫–∞–Ω–∞–ª–æ–º –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

```go
package main

import "fmt"

func worker(done chan bool) {
    fmt.Print("—Ä–∞–±–æ—Ç–∞—é...")
    // ...–≤—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞–±–æ—Ç—É
    fmt.Println("–≥–æ—Ç–æ–≤–æ!")
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤ –∫–∞–Ω–∞–ª
    done <- true
}

func main() {
    // –°–æ–∑–¥–∞–µ–º –∫–∞–Ω–∞–ª –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    done := make(chan bool, 1)

    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É
    go worker(done)

    // –û–∂–∏–¥–∞–µ–º —Å–∏–≥–Ω–∞–ª –∏–∑ –∫–∞–Ω–∞–ª–∞ –æ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã
    <-done // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∑–¥–µ—Å—å, –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–¥–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.
}
```

### –ò—Ç–æ–≥

**–ì–æ—Ä—É—Ç–∏–Ω–∞** ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –±–ª–æ–∫ –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Go. –≠—Ç–æ:
*   **–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø–æ—Ç–æ–∫** (–¥–µ—à–µ–≤–ª–µ –ø–æ—Ç–æ–∫–æ–≤ –û–°).
*   **–ü—Ä–æ—Å—Ç–æ–π –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏** (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `go`).
*   **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π** (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º Go).
*   **–ò–¥–µ–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö concurrent-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

–°–æ—á–µ—Ç–∞–Ω–∏–µ **–≥–æ—Ä—É—Ç–∏–Ω** (–¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è) –∏ **–∫–∞–Ω–∞–ª–æ–≤** (–¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏) –æ–±—Ä–∞–∑—É–µ—Ç –º–æ—â–Ω—É—é –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω—É—é –º–æ–¥–µ–ª—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤ Go, –∏–∑–≤–µ—Å—Ç–Ω—É—é –∫–∞–∫ **CSP (Communicating Sequential Processes)**.

# 2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≥–æ
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go (Go Scheduler)** ‚Äî —ç—Ç–æ –º–æ–∑–≥ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤ Go, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã —Ç–∞–∫–∏–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –µ–≥–æ —Ä–∞–±–æ—Ç—É –ø–æ–¥—Ä–æ–±–Ω–æ.

## –ß—Ç–æ —Ç–∞–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go?

–≠—Ç–æ —á–∞—Å—Ç—å runtime Go, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –ø–æ –ø–æ—Ç–æ–∫–∞–º –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (OS threads) –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ —è–¥—Ä–∞ –û–°.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –ú–æ–¥–µ–ª—å M:P:G

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω –≤–æ–∫—Ä—É–≥ —Ç—Ä–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π:

### **G (Goroutine)** - –ì–æ—Ä—É—Ç–∏–Ω–∞
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∞–º—É –≥–æ—Ä—É—Ç–∏–Ω—É
- –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–µ–∫, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é

### **M (Machine) - –ü–æ—Ç–æ–∫ –û–°**
- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ –ø–æ—Ç–æ–∫–æ–º —è–¥—Ä–∞ –û–°
- –ò–º–µ–Ω–Ω–æ "M" –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –≥–æ—Ä—É—Ç–∏–Ω
- –°–≤—è–∑–∞–Ω —Å —è–¥—Ä–æ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

### **P (Processor) - –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä**
- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, —Ä–µ—Å—É—Ä—Å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω
- –ö–∞–∂–¥—ã–π P –∏–º–µ–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å –≥–æ—Ä—É—Ç–∏–Ω
- –°–≤—è–∑—ã–≤–∞–µ—Ç M –∏ G

```go
// –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
[P1] -> –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å: [G1, G2, G3]
     -> M1 -> –í—ã–ø–æ–ª–Ω—è–µ—Ç G1
     
[P2] -> –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å: [G4, G5]
     -> M2 -> –í—ã–ø–æ–ª–Ω—è–µ—Ç G4

[–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å] -> [G6, G7, G8]
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

### 1. **–ó–∞–ø—É—Å–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã**
```go
func main() {
    go myFunction() // –°–æ–∑–¥–∞–µ—Ç—Å—è G, –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å P
}
```

### 2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**
- –ö–∞–∂–¥—ã–π P –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å–≤–æ—é –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å –≥–æ—Ä—É—Ç–∏–Ω
- –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞, P "–∫—Ä–∞–¥–µ—Ç" —Ä–∞–±–æ—Ç—É –∏–∑ –¥—Ä—É–≥–∏—Ö P –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

### 3. **–ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (scheduling)**
–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª—É—á–∞—è—Ö:

#### **a) –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã (–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ)**
```go
file, err := os.Open("file.txt") // –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
```
- –ö–æ–≥–¥–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –¥–µ–ª–∞–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤:
  - P "–æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è" –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ M
  - –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π M –∏–ª–∏ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø—É–ª–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω
  - –ö–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω, G –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å

#### **b) –°–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
```go
resp, err := http.Get("https://example.com")
```
- Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–≤–æ–¥/–≤—ã–≤–æ–¥ —á–µ—Ä–µ–∑ netpoller
- G —Å—Ç–∞–≤–∏—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è, P –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á
- –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã, G –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### **c) –ö–∞–Ω–∞–ª—ã –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
```go
data := <-ch // –û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞–Ω–∞–ª–∞
```
- G –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, P –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –≥–æ—Ä—É—Ç–∏–Ω—É

#### **d) –Ø–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**
```go
runtime.Gosched() // –Ø–≤–Ω–æ —É—Å—Ç—É–ø–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤—Ä–µ–º—è
```

#### **e) –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ (preemption)**
- –ù–∞—á–∏–Ω–∞—è —Å Go 1.14, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–æ–∂–µ—Ç –≤—ã—Ç–µ—Å–Ω—è—Ç—å –¥–æ–ª–≥–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–≥–æ–ª–æ–¥–∞–Ω–∏–µ" –¥—Ä—É–≥–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### **1. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ –û–°
- –ù–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —è–¥—Ä–∞

### **2. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —è–¥–µ—Ä CPU

### **3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–≤–æ–¥–æ–º/–≤—ã–≤–æ–¥–æ–º**
- Netpoller —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—ã—Å—è—á–∏ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

```go
package main

import (
    "fmt"
    "runtime"
    "time"
)

func worker(id int, results chan<- int) {
    fmt.Printf("Worker %d started\n", id)
    time.Sleep(time.Second) // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
    results <- id * 2
}

func main() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
    fmt.Printf("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU: %d\n", runtime.NumCPU())
    fmt.Printf("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω: %d\n", runtime.NumGoroutine())
    
    results := make(chan int, 10)
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º 10 –≥–æ—Ä—É—Ç–∏–Ω
    for i := 0; i < 10; i++ {
        go worker(i, results)
    }
    
    fmt.Printf("–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω: %d\n", runtime.NumGoroutine())
    
    // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for i := 0; i < 10; i++ {
        result := <-results
        fmt.Printf("–†–µ–∑—É–ª—å—Ç–∞—Ç: %d\n", result)
    }
    
    fmt.Printf("–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: %d\n", runtime.NumGoroutine())
}
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

```go
// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤ –û–°
runtime.GOMAXPROCS(4)

// –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π GOMAXPROCS
fmt.Println(runtime.GOMAXPROCS(0))

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞
runtime.GC()

// –Ø–≤–Ω–æ —É—Å—Ç—É–ø–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
runtime.Gosched()
```

## –ò—Ç–æ–≥

**–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go** ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ –≤—Å–µ–º —è–¥—Ä–∞–º CPU
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—ã—Å—è—á–∞–º–∏ –≥–æ—Ä—É—Ç–∏–Ω
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–æ–≤ –û–°
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å I/O-bound –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

–ë–ª–∞–≥–æ–¥–∞—Ä—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∫–æ–¥, –Ω–µ –∑–∞–¥—É–º—ã–≤–∞—è—Å—å –æ —Å–ª–æ–∂–Ω–æ—Å—Ç—è—Ö –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞–º–∏.

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Go-–ø—Ä–æ–≥—Ä–∞–º–º—ã —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Go —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–∞—à–∏–Ω—É (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∏–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é) —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ. –≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —è–¥–µ—Ä, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–µ. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (M) –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –µ–≥–æ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (P) –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –≠—Ç–∏ P –∏ M –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ—â–Ω–æ—Å—Ç–∏ –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã Go.

–¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ (G) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º M/P. –¢–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ M —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–∏, G —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –Ω–∞ –ú. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –Ω–∞–¥ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π, –Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

[![](https://tour.ardanlabs.com/tour/eng/static/img/gor1.png)](https://tour.ardanlabs.com/tour/eng/static/img/gor1.png)

–ü–æ—Å–∫–æ–ª—å–∫—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –≤–∞–∂–Ω–æ –∏–º–µ—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ó–∞–¥–∞—á–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã - —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–ª–ª—é–∑–∏—é —Ç–æ–≥–æ, —á—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π —Ä–∞–±–æ—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –î–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤ –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞. –ü—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å, –≤–∞–∂–Ω–æ –¥–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º —Å–ª–æ–≤–∞–º.

**–†–∞–±–æ—Ç–∞:**¬†–ù–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –≠—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Ç–æ–∫–∞–º–∏, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ—Ç 1 –¥–æ –º–Ω–æ–≥–∏—Ö –ø–æ—Ç–æ–∫–æ–≤.

**–ü–æ—Ç–æ–∫:**¬†–ü—É—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –ü–æ—Ç–æ–∫–∏ –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏.

**–°–æ—Å—Ç–æ—è–Ω–∏—è**¬†**–ü–æ—Ç–æ–∫–∞:**¬†–ü–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –æ–¥–Ω–æ–º –∏–∑ —Ç—Ä–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –µ–º—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞ M —Å—Ç–∞–≤–∏—Ç—Å—è G. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ—Ç–æ–∫ —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –µ–º—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ. –û–∂–∏–¥–∞–Ω–∏–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ—Ç–æ–∫ –∂–¥–µ—Ç —á–µ–≥–æ-—Ç–æ, –ø—Ä–µ–∂–¥–µ —á–µ–º —Å–º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–≤–æ—é —Ä–∞–±–æ—Ç—É. –û–∂–∏–¥–∞—é—â–∏–µ –ø–æ—Ç–æ–∫–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –∑–∞–±–æ—Ç–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.

**–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å:**¬†–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–Ω–µ –æ—á–µ—Ä–µ–¥–∏. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º, –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é. –ö–ª—é—á–µ–≤—ã–º –º–æ–º–µ–Ω—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –≤ –ª—é–±–æ–º –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –¥–∞–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –í—ã —Å–∫–∞–∂–µ—Ç–µ, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –∫–æ–≥–¥–∞ –ø–æ—Ä—è–¥–æ–∫ –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ–∫–∞ –≤—Å—è —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å:**¬†–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π. –ß—Ç–æ–±—ã —ç—Ç–æ —Å—Ç–∞–ª–æ –≤–æ–∑–º–æ–∂–Ω—ã–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–≤—É—Ö –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ—Ç–æ–∫–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–∏.

**–†–∞–±–æ—Ç–∞,**¬†**—Å**¬†**–ó–∞–≥—Ä—É–∑–∫–æ–π**¬†**CPU:**¬†–≠—Ç–æ —Ä–∞–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥—É –ø–æ—Ç–æ–∫–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —á–∏—Å–µ–ª –§–∏–±–æ–Ω–∞—á—á–∏ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Ä–∞–±–æ—Ç–æ–π, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç CPU.

**–†–∞–±–æ—Ç–∞**¬†**—Å**¬†*–ó–∞–≥—Ä—É–∑–∫–æ–π¬†**I/O:**¬†–≠—Ç–æ —Ä–∞–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è. —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö URL –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Ä–∞–±–æ—Ç–æ–π, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç I/O.

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**¬†–ö–æ–≥–¥–∞ –¥–≤—É–º –∏–ª–∏ –±–æ–ª–µ–µ –≥–æ—Ä—É—Ç–∏–Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ –º–µ—Å—Ç—É –ø–∞–º—è—Ç–∏ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ –æ—á–µ—Ä–µ–¥–∏. –ï—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å, —Ç–æ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –≥–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö. –ì–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏—á–∏–Ω–æ–π –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –±–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä—É–¥–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å.

**–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è:**¬†–ö–æ–≥–¥–∞ –¥–≤—É–º –∏–ª–∏ –±–æ–ª–µ–µ –≥–æ—Ä—É—Ç–∏–Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥—É —Å–∏–≥–Ω–∞–ª, —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö, —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏. –ï—Å–ª–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –≥–∞—Ä–∞–Ω—Ç–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –±—É–¥—É—Ç —É–ø—É—â–µ–Ω—ã. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤—Å–µ–≤–æ–∑–º–æ–∂–Ω—ã–º –æ—à–∏–±–∫–∞–º, —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö.

# 3. –ü–æ—á–µ–º—É –≥–æ—Ä—É—Ç–∏–Ω—ã –±—ã—Å—Ç—Ä—ã–µ
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! **–ì–æ—Ä—É—Ç–∏–Ω—ã –±—ã—Å—Ç—Ä—ã–µ** –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –ø–æ –ø–æ–ª–æ—á–∫–∞–º.

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã —Å–∫–æ—Ä–æ—Å—Ç–∏ –≥–æ—Ä—É—Ç–∏–Ω

### 1. **–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ —Å—Ç–µ–∫–∏**

**–ü–æ—Ç–æ–∫–∏ –û–°:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ 1-8 –ú–ë
```go
// –ü–æ—Ç–æ–∫ –û–°: 1MB —Å—Ç–µ–∫–∞ —Å—Ä–∞–∑—É
// 1000 –ø–æ—Ç–æ–∫–æ–≤ = 1000 * 1MB = 1GB –ø–∞–º—è—Ç–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–µ–∫–∏!
```

**–ì–æ—Ä—É—Ç–∏–Ω—ã:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ 2-8 –ö–ë –Ω–∞—á–∞–ª—å–Ω–æ
```go
// –ì–æ—Ä—É—Ç–∏–Ω–∞: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 2KB
func main() {
    for i := 0; i < 100000; i++ {
        go worker(i) // 100000 * 2KB = 200MB - –ø—Ä–∏–µ–º–ª–µ–º–æ!
    }
}
```
- **–°—Ç–µ–∫ —Ä–∞—Å—Ç–µ—Ç/—Å–∂–∏–º–∞–µ—Ç—Å—è** –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞** –ø—Ä–∏ —Ä–æ—Å—Ç–µ –≤–º–µ—Å—Ç–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

### 2. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```go
package main

import "runtime"

func fastSwitch() {
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ë–ï–ó —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
    // –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go —Å–∞–º —Ä–µ—à–∞–µ—Ç –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è
    ch := make(chan int)
    
    go func() {
        ch <- 42  // –¢–æ—á–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è - –¥–µ—à–µ–≤–∞—è!
    }()
    
    <-ch  // –¢–æ—á–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è - –¥–µ—à–µ–≤–∞—è!
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- **–ù–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤** –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- **–ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ —è–¥—Ä–æ** –û–°
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### 3. **–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å —Å –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ–º**

```go
func cooperativeExample() {
    go func() {
        // –ì–æ—Ä—É—Ç–∏–Ω–∞ –°–ê–ú–ê —É—Å—Ç—É–ø–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö:
        // - –ü—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å –∫–∞–Ω–∞–ª–∞–º–∏
        // - –ü—Ä–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö  
        // - –ü—Ä–∏ –≤—ã–∑–æ–≤–µ runtime.Gosched()
        // - –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å sync –ø–∞–∫–µ—Ç–æ–º
    }()
}
```

**–¢–æ—á–∫–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è:**
```go
ch <- data           // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∫–∞–Ω–∞–ª
<-ch                 // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞
time.Sleep()         // –°–æ–Ω
http.Get()           // –°–µ—Ç–µ–≤–æ–π I/O
file.Read()          // –§–∞–π–ª–æ–≤—ã–π I/O  
runtime.Gosched()    // –Ø–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
mutex.Lock()         // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```

### 4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å I/O —á–µ—Ä–µ–∑ netpoller**

```go
package main

import (
    "net/http"
    "time"
)

func efficientIO() {
    for i := 0; i < 10000; i++ {
        go func(id int) {
            // –í–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–∞ –û–°:
            resp, _ := http.Get("https://api.example.com/data")
            // –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –ø–æ—Ç–æ–∫ –û–° –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
            // –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω!
            _ = resp
        }(i)
    }
}
```

**Netpoller magic:**
- **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O** –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–°
- **–ì–æ—Ä—É—Ç–∏–Ω—ã "—Å–ø—è—Ç"** –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≥–æ—Ç–æ–≤—ã
- **–ü–æ—Ç–æ–∫–∏ –û–° –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è** - –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã

### 5. **Work-stealing –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**

```go
// –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É:
// [P1] -> [G1, G2, G3]  // –ó–∞–Ω—è—Ç
// [P2] -> []             // –°–≤–æ–±–æ–¥–µ–Ω - "–∫—Ä–∞–¥–µ—Ç" G3 —É P1!
// [P3] -> [G4, G5]       // –ó–∞–Ω—è—Ç
```

**–ü—Ä–∏–Ω—Ü–∏–ø—ã work-stealing:**
- –ö–∞–∂–¥—ã–π P (–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä) –∏–º–µ–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
- –ï—Å–ª–∏ —É P –Ω–µ—Ç —Ä–∞–±–æ—Ç—ã - –∫—Ä–∞–¥–µ—Ç —É –¥—Ä—É–≥–∏—Ö P
- **–ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–∏** –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** –Ω–∞–≥—Ä—É–∑–∫–∏

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫

```go
package main

import (
    "sync"
    "testing"
    "time"
)

// –ë–µ–Ω—á–º–∞—Ä–∫ –≥–æ—Ä—É—Ç–∏–Ω
func BenchmarkGoroutines(b *testing.B) {
    var wg sync.WaitGroup
    for i := 0; i < b.N; i++ {
        wg.Add(1)
        go func(id int) {
            time.Sleep(1 * time.Microsecond)
            wg.Done()
        }(i)
    }
    wg.Wait()
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: 
// 100000 –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
```

## –ß–∏—Å–ª–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –û–ø–µ—Ä–∞—Ü–∏—è | –ü–æ—Ç–æ–∫–∏ –û–° | –ì–æ—Ä—É—Ç–∏–Ω—ã |
|----------|-----------|----------|
| **–°–æ–∑–¥–∞–Ω–∏–µ** | 10-30 ¬µs | 0.1-0.3 ¬µs |
| **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** | 1-1.5 ¬µs | 0.1-0.3 ¬µs |
| **–ü–∞–º—è—Ç—å** | 1-8 MB | 2-8 KB |
| **–ú–∞–∫—Å–∏–º—É–º** | ~10,000 | ~1,000,000 |

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```go
package main

import (
    "fmt"
    "net/http"
    "sync"
    "time"
)

func main() {
    start := time.Now()
    var wg sync.WaitGroup
    urls := []string{
        "https://httpbin.org/delay/1",
        "https://httpbin.org/delay/1", 
        "https://httpbin.org/delay/1",
    }
    
    // –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ö–û–ù–ö–£–†–ï–ù–¢–ù–û
    for _, url := range urls {
        wg.Add(1)
        go func(u string) {
            defer wg.Done()
            resp, _ := http.Get(u)
            if resp != nil {
                resp.Body.Close()
            }
            fmt.Printf("Completed: %s\n", u)
        }(url)
    }
    
    wg.Wait()
    fmt.Printf("Total time: %v (instead of ~3s)\n", time.Since(start))
    // –í—ã–≤–æ–¥: Total time: ~1.1s - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!
}
```

## –ò—Ç–æ–≥: –ø–æ—á–µ–º—É –≥–æ—Ä—É—Ç–∏–Ω—ã –±—ã—Å—Ç—Ä—ã–µ

1. **üöÄ –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ** - –º–∞–ª–µ–Ω—å–∫–∏–µ —Å—Ç–µ–∫–∏, –±—ã—Å—Ç—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
2. **‚ö° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** - –Ω–µ—Ç –¥–æ—Ä–æ–≥–∏—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤  
3. **üîÑ –£–º–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å —Å –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ–º
4. **üì° –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π I/O** - netpoller –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–∏ –û–°
5. **üéØ Work-stealing** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
6. **üí∞ –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏** - –º–∏–Ω–∏–º—É–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Go –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –∏–¥–µ–∞–ª—å–Ω—ã–º –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.
# 4. –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω—ã

### –û–±—ä–µ–∫—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã¬†

_–î–ª–∏–Ω–∞ –æ–±—ä–µ–∫—Ç–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—Ä—è–¥–∫–∞ 70 —Å—Ç—Ä–æ–∫. –ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ —É–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –Ω–∞–≤–µ—Å—Ç–∏ –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ—Ä—è–¥–æ–∫:_

```go
type g struct {
	stack          stack
	stackguard0    uintptr
	stackguard1    uintptr
	_panic         *_panic
	_defer         *_defer
	m              *m
	sched          gobuf
	syscallsp      uintptr
	syscallpc      uintptr
	stktopsp       uintptr
	param          unsafe.Pointer
	atomicstatus   uint32
	stackLock      uint32
	goid           int64
	schedlink      guintptr
	waitsince      int64
	waitreason     waitReason
	preempt        bool
	preemptStop    bool
	preemptShrink  bool
	asyncSafePoint bool
	paniconfault   bool
	gcscandone     bool
	throwsplit     bool
	activeStackChans bool
	raceignore     int8
	sysblocktraced bool
	sysexitticks   int64
	traceseq       uint64
	tracelastp     puintptr
	lockedm        muintptr
	sig            uint32
	writebuf       []byte
	sigcode0       uintptr
	sigcode1       uintptr
	sigpc          uintptr
	gopc           uintptr
	ancestors      *[]ancestorInfo
	startpc        uintptr
	racectx        uintptr
	waiting        *sudog
	cgoCtxt        []uintptr
	labels         unsafe.Pointer
	timer          *timer
	selectDone     uint32
	gcAssistBytes  int64
}
```

–í–æ—Ç –∏ –≤—Å–µ!

–ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º–∞—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä;¬†`uintptr`¬†–≤–µ—Å–∏—Ç 64 –±–∏—Ç, —Ç.–µ. 8 –±–∞–π—Ç –≤ –Ω–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, —Ç–∞–∫ –∂–µ –∫–∞–∫ –∏¬†`int64`. –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä –≤ 1 –±–∞–π—Ç, –∞ —Å–ª–∞–π—Å - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–ª—é—Å –¥–≤–∞ –∏–Ω—Ç–∞.

–ï—Å—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Ç–∏–ø—ã, —Ç–∞–∫–∏–µ –∫–∞–∫¬†`timer`¬†(~70 –±–∞–π—Ç),¬†`_panic`¬†(~40 –±–∞–π—Ç) –∏–ª–∏¬†`_defer`¬†(~100 –±–∞–π—Ç), –Ω–æ –≤ —Ü–µ–ª–æ–º —è –Ω–∞—Å—á–∏—Ç–∞–ª –æ–∫–æ–ª–æ 600 –±–∞–π—Ç.

–•–º, —ç—Ç–æ –∫–∞–∂–µ—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º‚Ä¶ –û—Ç–∫—É–¥–∞ –≤–∑—è–ª–æ—Å—å –ø—Ä–µ—Å–ª–æ–≤—É—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ¬´2 –∫–±¬ª?

–î–∞–≤–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã‚Ä¶

### –°—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã

–ü–µ—Ä–≤–æ–µ –ø–æ–ª–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã¬†`g`¬†–∏–º–µ–µ—Ç —Ç–∏–ø¬†`stack`.

```go
type g struct {
	// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–∫–∞.
	// stack –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å —Å—Ç–µ–∫–∞: [stack.lo, stack.hi).
	// stackguard0 - —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º—ã–π –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ —Å—Ç–µ–∫–∞ Go.
	// stackguard1 - —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º—ã–π –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ —Å—Ç–µ–∫–∞ C.
	// ...
	stack       stack   // —Å–º–µ—â–µ–Ω–∏–µ, –∏–∑–≤–µ—Å—Ç–Ω–æ–µ runtime/cgo
	stackguard0 uintptr // —Å–º–µ—â–µ–Ω–∏–µ, –∏–∑–≤–µ—Å—Ç–Ω–æ–µ liblink
	stackguard1 uintptr // —Å–º–µ—â–µ–Ω–∏–µ, –∏–∑–≤–µ—Å—Ç–Ω–æ–µ liblink
}
```

–°–∞–º —Å—Ç–µ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –Ω–µ —á—Ç–æ –∏–Ω–æ–µ, –∫–∞–∫ –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è, –æ–±–æ–∑–Ω–∞—á–∞—é—â–∏—Ö –µ–≥–æ –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü.

```go
type stack struct {
	lo uintptr
	hi uintptr
}
```

–ö —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –≤—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, –∑–∞–¥–∞–¥–∏—Ç–µ—Å—å –≤–æ–ø—Ä–æ—Å–æ–º:¬†_¬´–ê –∫–∞–∫–æ–≤ –∂–µ —Ä–∞–∑–º–µ—Ä —ç—Ç–æ–≥–æ —Å—Ç–µ–∫–∞?¬ª_, –∏–ª–∏ —É–∂–µ –¥–æ–≥–∞–¥–∞–µ—Ç–µ—Å—å, —á—Ç–æ 2 –∫–∏–ª–æ–±–∞–π—Ç–∞ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —ç—Ç–æ–º—É —Å—Ç–µ–∫—É!

**_–ì–æ—Ä—É—Ç–∏–Ω–∞_**¬†[**_—Å—Ç–∞—Ä—Ç—É–µ—Ç_**](https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/proc.go#L3410)¬†**_—Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–µ–∫–∞ –≤_**¬†[**_2 –∫–∏–ª–æ–±–∞–π—Ç–∞_**](https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/stack.go#L72)**_, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –±–µ–∑ —Ä–∏—Å–∫–∞ –∫–æ–≥–¥–∞-–ª–∏–±–æ –∑–∞–∫–æ–Ω—á–∏—Ç—å—Å—è._**

[–≠—Ç–∞](https://dave.cheney.net/2013/06/02/why-is-a-goroutines-stack-infinite)¬†–æ—Ç–ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç—å—è –î—ç–π–≤–∞ –ß–µ–π–Ω–∏ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–æ —Å—É—Ç–∏, –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ª—é–±–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ Go –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –æ–±—ä–µ–º —Å—Ç–µ–∫–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é –æ–Ω —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å; –µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã–∑–æ–≤¬†[runtime.morestack,](https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/asm_amd64.s#L407)¬†–∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–µ–ª—è–µ—Ç –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è. –ù–∞–∫–æ–Ω–µ—Ü, –∫–æ–≥–¥–∞ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –µ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ—Ä–µ–π–º —Å—Ç–µ–∫–∞, –∞ –≤—Å–µ –Ω–µ–≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å—Ç–µ–∫–∞ –≤—ã—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è.

–•–æ—Ç—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–∫ 2048 –±–∞–π—Ç–æ–≤, —Ä–∞–Ω—Ç–∞–π–º Go —Ç–∞–∫–∂–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω–∞–º –ø—Ä–µ–≤—ã—à–∞—Ç—å¬†[–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞](https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/stack.go#L1031); —ç—Ç–æ—Ç –º–∞–∫—Å–∏–º—É–º –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç¬†[1 –ì–ë –¥–ª—è 64-—Ä–∞–∑—Ä—è–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ 250 –ú–ë –¥–ª—è 32-—Ä–∞–∑—Ä—è–¥–Ω—ã—Ö](https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/proc.go#L120)¬†—Å–∏—Å—Ç–µ–º.

–ï—Å–ª–∏ —ç—Ç–æ—Ç –ø—Ä–µ–¥–µ–ª –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤—ã–∑–æ–≤¬†[runtime.abort](https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/asm_amd64.s#L450). –ü—Ä–µ–≤—ã—Å–∏—Ç—å —ç—Ç–æ–≥–æ —Ä–∞–∑–º–µ—Ä –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ —Å –ø–æ–º–æ—â—å—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏; –≤—Å–µ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —ç—Ç–æ

```go
package main

func foo(i int) int {
	if i < 1e8 {
		return foo(i + 1)
	}
	return -1
}

func main() {
	foo(0)
}
```

–ò –º—ã –≤–∏–¥–∏–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–Ω–∏–∫—É–µ—Ç, —Å—Ç–µ–∫ –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç—ã–π runtime.abort .

```
$ go run exceed-stack.goruntime: goroutine stack exceeds 1000000000-byte limitfatal error: stack overflowruntime stack:runtime.throw(0x1071ce1, 0xe)	/usr/local/go/src/runtime/panic.go:774 +0x72runtime.newstack()	/usr/local/go/src/runtime/stack.go:1046 +0x6e9runtime.morestack()	/usr/local/go/src/runtime/asm_amd64.s:449 +0x8fgoroutine 1 [running]:main.foo(0xffffdf, 0x0)......
```

# 5. –û—Ç–ª–∏—á–∏–µ –ø–æ—Ç–æ–∫–∞ –æ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–∞–∑–±–µ—Ä–µ–º **–æ—Ç–ª–∏—á–∏—è –ø–æ—Ç–æ–∫–æ–≤ –æ—Ç –≥–æ—Ä—É—Ç–∏–Ω** —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ü–æ—Ç–æ–∫–∏ –û–° (Threads) | –ì–æ—Ä—É—Ç–∏–Ω—ã (Goroutines) |
|----------------|-------------------|---------------------|
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** | –Ø–¥—Ä–æ –û–° | Go runtime (–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) |
| **–ü–∞–º—è—Ç—å** | 1-8 –ú–ë (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫) | 2-8 –ö–ë (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫) |
| **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** | 1000-1500 ns (–¥–æ—Ä–æ–≥–æ–µ) | 200-500 ns (–¥–µ—à–µ–≤–æ–µ) |
| **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–° | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go |
| **–ú–∞–∫—Å–∏–º—É–º** | 1000-10000 | 1000000+ |
| **–°–æ–∑–¥–∞–Ω–∏–µ** | –ú–µ–¥–ª–µ–Ω–Ω–æ–µ (~10-30 ¬µs) | –ë—ã—Å—Ç—Ä–æ–µ (~0.1-0.3 ¬µs) |

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Ç–ª–∏—á–∏—è

### 1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**

**–ü–æ—Ç–æ–∫–∏ –û–°:**
```go
import (
    "fmt"
    "sync"
    "time"
)

func threadLikeWork() {
    var wg sync.WaitGroup
    
    // –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–æ–∫ –û–° (—á–µ—Ä–µ–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–°)
    for i := 0; i < 1000; i++ {
        wg.Add(1)
        go func(id int) {  // –ó–¥–µ—Å—å "go" —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–æ–∫ –û–°
            defer wg.Done()
            time.Sleep(time.Millisecond)
            fmt.Printf("Thread %d\n", id)
        }(i)
    }
    wg.Wait()
    // –ü—Ä–æ–±–ª–µ–º–∞: 1000 –ø–æ—Ç–æ–∫–æ–≤ –û–° - —ç—Ç–æ —Ç—è–∂–µ–ª–æ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã!
}
```

**–ì–æ—Ä—É—Ç–∏–Ω—ã:**
```go
func goroutineWork() {
    var wg sync.WaitGroup
    
    // –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ –≥–æ—Ä—É—Ç–∏–Ω—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è Go runtime
    for i := 0; i < 100000; i++ {
        wg.Add(1)
        go func(id int) {  // –õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
            defer wg.Done()
            time.Sleep(time.Millisecond)
            fmt.Printf("Goroutine %d\n", id)
        }(i)
    }
    wg.Wait()
    // 100000 –≥–æ—Ä—É—Ç–∏–Ω - –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ –¥–ª—è Go!
}
```

### 2. **–ü–∞–º—è—Ç—å –∏ —Å—Ç–µ–∫–∏**

**–ü–æ—Ç–æ–∫–∏ –û–°:**
```go
// –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ 1-8 –ú–ë
// 1000 –ø–æ—Ç–æ–∫–æ–≤ = 1000 * 1MB = 1 –ì–ë –ø–∞–º—è—Ç–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–µ–∫–∏!

func threadMemoryDemo() {
    // –°–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–≥–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –±—ã—Å—Ç—Ä–æ –∏—Å—á–µ—Ä–ø—ã–≤–∞–µ—Ç –ø–∞–º—è—Ç—å
    for i := 0; i < 5000; i++ {
        go heavyOperation() // –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ OOM
    }
}
```

**–ì–æ—Ä—É—Ç–∏–Ω—ã:**
```go
// –ù–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫: 2 –ö–ë, —Ä–∞—Å—Ç–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
// 100000 –≥–æ—Ä—É—Ç–∏–Ω = 100000 * 2KB = 200 –ú–ë (–ø—Ä–∏–µ–º–ª–µ–º–æ!)

func goroutineMemoryDemo() {
    // –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ—Ç–Ω–∏ —Ç—ã—Å—è—á –≥–æ—Ä—É—Ç–∏–Ω
    for i := 0; i < 500000; i++ {
        go lightOperation() // –ë–µ–∑ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é
    }
}
```

### 3. **–ú–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

**–ü–æ—Ç–æ–∫–∏ –û–° - –í—ã—Ç–µ—Å–Ω—è—é—â–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å:**
```go
func osThreadExample() {
    // –ü–æ—Ç–æ–∫–∏ –≤—ã—Ç–µ—Å–Ω—è—é—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –û–°:
    // - –ü–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—é –∫–≤–∞–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏
    // - –ü–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    // - –ü–æ —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º
    
    go cpuIntensiveTask() // –ú–æ–∂–µ—Ç "–º–æ–Ω–æ–ø–æ–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å" —è–¥—Ä–æ
    go ioIntensiveTask()  // –ú–æ–∂–µ—Ç "–≥–æ–ª–æ–¥–∞—Ç—å" –∏–∑-–∑–∞ CPU-bound –∑–∞–¥–∞—á–∏
}
```

**–ì–æ—Ä—É—Ç–∏–Ω—ã - –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å —Å –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ–º:**
```go
func goroutineExample() {
    // –ì–æ—Ä—É—Ç–∏–Ω—ã —É—Å—Ç—É–ø–∞—é—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ç–æ—á–∫–∞—Ö:
    go func() {
        // 1. –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–∞–Ω–∞–ª–∞–º–∏
        ch <- data
        <-ch
        
        // 2. –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã
        http.Get("...")
        file.Read()
        
        // 3. Sleep
        time.Sleep(...)
        
        // 4. –Ø–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
        runtime.Gosched()
        
        // 5. –°–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞
    }()
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–ª–∏—á–∏–π

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–¥–∞—á

**–° –ø–æ—Ç–æ–∫–∞–º–∏ –û–° (–ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ):**
```go
func withOSThreads() {
    start := time.Now()
    var wg sync.WaitGroup
    
    // –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ
    for i := 0; i < 50000; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
            time.Sleep(1 * time.Microsecond)
        }(i)
    }
    
    wg.Wait()
    fmt.Printf("Threads time: %v\n", time.Since(start))
    // –í–µ—Ä–æ—è—Ç–Ω–æ: out of memory –∏–ª–∏ –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ
}
```

**–° –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ):**
```go
func withGoroutines() {
    start := time.Now()
    var wg sync.WaitGroup
    
    // –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–∞–∂–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª
    for i := 0; i < 500000; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
            time.Sleep(1 * time.Microsecond)
        }(i)
    }
    
    wg.Wait()
    fmt.Printf("Goroutines time: %v\n", time.Since(start))
    // –ë—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é
}
```

### –ü—Ä–∏–º–µ—Ä 2: –†–∞–±–æ—Ç–∞ —Å I/O

**–ü–æ—Ç–æ–∫–∏ –û–° –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è:**
```go
func blockingIOWithThreads() {
    // –ö–∞–∂–¥—ã–π —Å–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –û–°
    for i := 0; i < 1000; i++ {
        go func() {
            resp, _ := http.Get("https://api.example.com")
            // –ü–æ—Ç–æ–∫ –û–° –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞!
            _ = resp
        }()
    }
    // –¢—Ä–µ–±—É–µ—Ç—Å—è 1000 –ø–æ—Ç–æ–∫–æ–≤ –û–° –¥–ª—è 1000 concurrent –∑–∞–ø—Ä–æ—Å–æ–≤
}
```

**–ì–æ—Ä—É—Ç–∏–Ω—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ—Ç–æ–∫–∏ –û–°:**
```go
func nonBlockingIOWithGoroutines() {
    // Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç netpoller –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ I/O
    for i := 0; i < 100000; i++ {
        go func() {
            resp, _ := http.Get("https://api.example.com")
            // –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ—Ç–æ–∫ –û–° –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
            // –ü–æ—Ç–æ–∫ –û–° –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã!
            _ = resp
        }()
    }
    // –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –û–° –¥–ª—è 100000 concurrent –∑–∞–ø—Ä–æ—Å–æ–≤
}
```

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –û–ø–µ—Ä–∞—Ü–∏—è | –ü–æ—Ç–æ–∫–∏ –û–° | –ì–æ—Ä—É—Ç–∏–Ω—ã | –í—ã–∏–≥—Ä—ã—à |
|----------|-----------|----------|---------|
| **–°–æ–∑–¥–∞–Ω–∏–µ** | ~20 ¬µs | ~0.3 ¬µs | 60x |
| **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** | ~1.2 ¬µs | ~0.2 ¬µs | 6x |
| **–ü–∞–º—è—Ç—å/—ç–∫–∑–µ–º–ø–ª—è—Ä** | ~1 MB | ~2 KB | 500x |
| **Concurrent connections** | ~10k | ~1M | 100x |

## –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

### **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ç–æ–∫–∏ –û–° –∫–æ–≥–¥–∞:**
- –†–∞–±–æ—Ç–∞–µ—Ç–µ —Å C/C++ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏, —Ç—Ä–µ–±—É—é—â–∏–º–∏ –Ω–∞—Å—Ç–æ—è—â–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
- –í—ã–ø–æ–ª–Ω—è–µ—Ç–µ CPU-intensive –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ—Ä–≤–∞–Ω—ã
- –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

### **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∫–æ–≥–¥–∞:**
- –°—Ç—Ä–æ–∏—Ç–µ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –í—ã–ø–æ–ª–Ω—è–µ—Ç–µ I/O-bound –∑–∞–¥–∞—á–∏ (—Å–µ—Ç—å, —Ñ–∞–π–ª—ã, –ë–î)
- –•–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å—Ç—É—é –º–æ–¥–µ–ª—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏

## –ü—Ä–∏–º–µ—Ä –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –º–∏—Ä–∞

**–í–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ç–æ–∫–∞—Ö:**
```go
// –ü—Å–µ–≤–¥–æ–∫–æ–¥ - —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
func traditionalWebServer() {
    for {
        conn := acceptConnection()
        go handleConnection(conn) // –°–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–æ–∫ –û–°
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: ~10k –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    }
}
```

**–í–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö:**
```go
// –†–µ–∞–ª—å–Ω—ã–π Go –ø–æ–¥—Ö–æ–¥
func goWebServer() {
    http.HandleFunc("/", handler)
    http.ListenAndServe(":8080", nil)
    // –ö–∞–∂–¥—ã–π HTTP –∑–∞–ø—Ä–æ—Å - –æ—Ç–¥–µ–ª—å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
    // –í–æ–∑–º–æ–∂–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å 1M+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
}

func handler(w http.ResponseWriter, r *http.Request) {
    // –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ - –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ
    // –õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
}
```

## –ò—Ç–æ–≥

**–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è:**

1. **üíæ –ü–∞–º—è—Ç—å** - –≥–æ—Ä—É—Ç–∏–Ω—ã –Ω–∞ –ø–æ—Ä—è–¥–∫–∏ —ç–∫–æ–Ω–æ–º–Ω–µ–µ
2. **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ  
3. **üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –û–°
4. **üì° –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω vs —Ç—ã—Å—è—á–∏ –ø–æ—Ç–æ–∫–æ–≤
5. **üîÑ –ú–æ–¥–µ–ª—å** - –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è vs –≤—ã—Ç–µ—Å–Ω—è—é—â–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å

**–ì–æ—Ä—É—Ç–∏–Ω—ã** - —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã–º, –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º, —Å–∫—Ä—ã–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞–º–∏ –û–°.
# 6. –í–æ—Ä–æ–≤—Å—Ç–≤–æ —É –≥–æ—Ä—É—Ç–∏–Ω
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! **Work stealing (–≤–æ—Ä–æ–≤—Å—Ç–≤–æ –∑–∞–¥–∞—á)** ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ Go –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

## –ß—Ç–æ —Ç–∞–∫–æ–µ work stealing?

**Work stealing** ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º **—Å–≤–æ–±–æ–¥–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã (P) "–∫—Ä–∞–¥—É—Ç" –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–Ω—è—Ç—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤**, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—Ç—å.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–æ—Ä–æ–≤—Å—Ç–≤–∞ –≤ Go

```go
// runtime/proc.go - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
type p struct {
    // –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –≥–æ—Ä—É—Ç–∏–Ω
    runq [256]guintptr
    runqhead uint32
    runqtail uint32
    
    runnext guintptr // –í—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Å–ª–µ–¥—É—é—â–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
}
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ—Ä–æ–≤—Å—Ç–≤–æ

### –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞:

```
[P1] -> [G1, G2, G3, G4]  // –ó–∞–Ω—è—Ç, –º–Ω–æ–≥–æ —Ä–∞–±–æ—Ç—ã
[P2] -> [G5]              // –ó–∞–Ω—è—Ç, –º–∞–ª–æ —Ä–∞–±–æ—Ç—ã  
[P3] -> []                // –°–≤–æ–±–æ–¥–µ–Ω - –ò–©–ï–¢ —Ä–∞–±–æ—Ç—É!
[P4] -> [G6, G7]          // –ó–∞–Ω—è—Ç

// P3 "–∫—Ä–∞–¥–µ—Ç" G4 –∏–∑ P1 —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—Ç—å
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ:

```go
// runtime/proc.go
func findrunnable() (gp *g, inheritTime bool) {
    // –ü–æ–ø—ã—Ç–∫–∞ —É–∫—Ä–∞—Å—Ç—å —Ä–∞–±–æ—Ç—É —É –¥—Ä—É–≥–∏—Ö P
    if gp := runqsteal(_p_, allp[enum.position()]); gp != nil {
        return gp, false
    }
}
```

## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤–æ—Ä–æ–≤—Å—Ç–≤–∞

### 1. **–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ—Ä–æ–≤—Å—Ç–≤–æ?**

```go
func scheduler() {
    for {
        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
        if gp, inheritTime := runqget(_p_); gp != nil {
            execute(gp, inheritTime) // –í—ã–ø–æ–ª–Ω—è–µ–º —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
        }
        
        // 2. –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ - –ø—ã—Ç–∞–µ–º—Å—è —É–∫—Ä–∞—Å—Ç—å
        if gp := runqsteal(_p_, otherP); gp != nil {
            execute(gp, false) // –í—ã–ø–æ–ª–Ω—è–µ–º —É–∫—Ä–∞–¥–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É
        }
        
        // 3. –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –µ—Å–ª–∏ –≤–æ—Ä–æ–≤—Å—Ç–≤–æ –Ω–µ —É–¥–∞–ª–æ—Å—å
        // ...
    }
}
```

### 2. **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–æ—Ä–æ–≤—Å—Ç–≤–∞**

```go
// runtime/proc.go
func runqsteal(pp, otherp *p) *g {
    // –ü—ã—Ç–∞–µ–º—Å—è —É–∫—Ä–∞—Å—Ç—å –ø–æ–ª–æ–≤–∏–Ω—É –≥–æ—Ä—É—Ç–∏–Ω –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –¥—Ä—É–≥–æ–≥–æ P
    n := runqgrab(otherp, &pp.runq, t)
    if n == 0 {
        return nil
    }
    return runqget(pp)
}

func runqgrab(pp *p, batch *[256]guintptr, t int) int {
    // –ë–µ—Ä–µ–º –¥–æ –ø–æ–ª–æ–≤–∏–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω –∏–∑ –æ—á–µ—Ä–µ–¥–∏
    n := pp.runqtail - pp.runqhead
    n = n - n/2 // –ë–µ—Ä–µ–º –ø–æ–ª–æ–≤–∏–Ω—É
    
    // –ê—Ç–æ–º–∞—Ä–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—ã –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å
    // ...
    return n
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–æ—Ä–æ–≤—Å—Ç–≤–∞

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func worker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    fmt.Printf("Worker %d executed on CPU %d\n", id, getCPUID())
    time.Sleep(10 * time.Millisecond)
}

func getCPUID() int {
    // –ü–æ–ª—É—á–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ P (–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞)
    return runtime.GetProcessorID()
}

func main() {
    runtime.GOMAXPROCS(4) // 4 –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
    
    var wg sync.WaitGroup
    
    // –°–æ–∑–¥–∞–µ–º –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
    // –ë–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã –Ω–∞ –ø–µ—Ä–≤–æ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ
    for i := 0; i < 100; i++ {
        wg.Add(1)
        if i < 80 {
            // 80% —Ä–∞–±–æ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ "—Ç—è–∂–µ–ª—É—é" –≥–æ—Ä—É—Ç–∏–Ω—É
            go heavyWorker(i, &wg)
        } else {
            go worker(i, &wg)
        }
    }
    
    wg.Wait()
    fmt.Println("All workers completed")
}

func heavyWorker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    // –ò–º–∏—Ç–∞—Ü–∏—è —Ç—è–∂–µ–ª–æ–π —Ä–∞–±–æ—Ç—ã
    sum := 0
    for i := 0; i < 1000000; i++ {
        sum += i
    }
    fmt.Printf("Heavy worker %d on CPU %d\n", id, getCPUID())
}
```

### –ü—Ä–∏–º–µ—Ä 2: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "sync/atomic"
)

var cpuWorkers [4]int64 // –°—á–µ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –ø–æ CPU

func distributedWorker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞ –∫–∞–∫–æ–º P –≤—ã–ø–æ–ª–Ω—è–µ–º—Å—è
    pID := getCurrentP()
    atomic.AddInt64(&cpuWorkers[pID], 1)
    
    // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
    for i := 0; i < 10000; i++ {
        // some work
    }
}

func getCurrentP() int {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å runtime/internal/sys
    // –ó–¥–µ—Å—å —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
    return runtime.GOMAXPROCS(0) - 1 // —É–ø—Ä–æ—â–µ–Ω–∏–µ
}

func main() {
    runtime.GOMAXPROCS(4)
    
    var wg sync.WaitGroup
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –º–Ω–æ–≥–æ –≥–æ—Ä—É—Ç–∏–Ω
    for i := 0; i < 1000; i++ {
        wg.Add(1)
        go distributedWorker(i, &wg)
    }
    
    wg.Wait()
    
    // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    fmt.Println("Work distribution across CPUs:")
    total := int64(0)
    for i, count := range cpuWorkers {
        fmt.Printf("CPU %d: %d tasks\n", i, count)
        total += count
    }
    fmt.Printf("Total: %d tasks\n", total)
    // –ë–ª–∞–≥–æ–¥–∞—Ä—è work stealing –Ω–∞–≥—Ä—É–∑–∫–∞ –±—É–¥–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
}
```

## –¢–∏–ø—ã –≤–æ—Ä–æ–≤—Å—Ç–≤–∞ –≤ Go

### 1. **–í–æ—Ä–æ–≤—Å—Ç–≤–æ –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π**

```go
// P1 —É–∫—Ä–∞–¥–µ—Ç —É P2 –∏–∑ runq
[P1] -> []              // –ü—É—Å—Ç–∞—è –æ—á–µ—Ä–µ–¥—å
[P2] -> [G1, G2, G3, G4] // –ü–æ–ª–Ω–∞—è –æ—á–µ—Ä–µ–¥—å

// P1 –∫—Ä–∞–¥–µ—Ç G3 –∏ G4
```

### 2. **–í–æ—Ä–æ–≤—Å—Ç–≤–æ runnext**

```go
// runnext - –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
[P1] -> runnext: G5, runq: [G1, G2]
[P2] -> []  // –°–≤–æ–±–æ–¥–µ–Ω

// P2 —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —É–∫—Ä–∞—Å—Ç—å runnext (G5), –∑–∞—Ç–µ–º –∏–∑ runq
```

### 3. **–í–æ—Ä–æ–≤—Å—Ç–≤–æ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏**

```go
// –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –ø—É—Å—Ç—ã
// –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å

global runq -> [G100, G101, G102...]

[P1] -> []  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å –∏ –±–µ—Ä–µ—Ç G100
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ work stealing

### 1. **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏**

```go
func loadBalancingExample() {
    // –ë–µ–∑ work stealing:
    // CPU1: [G1, G2, G3, G4, G5]  // –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
    // CPU2: []                     // –ü—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç
    
    // –° work stealing:
    // CPU1: [G1, G2, G3]          // –ë–∞–ª–∞–Ω—Å
    // CPU2: [G4, G5]              // –£–∫—Ä–∞–¥–µ–Ω–æ —É CPU1
}
```

### 2. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ—è**

```go
func noIdleTime() {
    // –°–≤–æ–±–æ–¥–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç —Ä–∞–±–æ—Ç—É
    // –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –û–°
}
```

### 3. **–õ–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**

```go
func dataLocality() {
    // –ö–∞–∂–¥—ã–π P —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–≤–æ–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã
    // –ù–æ –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É
}
```

## –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: HTTP —Å–µ—Ä–≤–µ—Ä

```go
package main

import (
    "fmt"
    "net/http"
    "runtime"
    "sync/atomic"
    "time"
)

var requestCount int64

func handler(w http.ResponseWriter, r *http.Request) {
    atomic.AddInt64(&requestCount, 1)
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
    time.Sleep(10 * time.Millisecond)
    
    // Work stealing –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ CPU –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è
    // –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
    cpu := runtime.GOMAXPROCS(0)
    fmt.Fprintf(w, "Request %d handled (CPUs: %d)", 
        atomic.LoadInt64(&requestCount), cpu)
}

func main() {
    http.HandleFunc("/", handler)
    
    fmt.Println("Server starting on :8080")
    fmt.Println("Work stealing will balance load across all CPUs")
    
    http.ListenAndServe(":8080", nil)
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ work stealing

```go
package main

import (
    "fmt"
    "runtime"
    "time"
)

func monitorStealing() {
    for {
        var m runtime.MemStats
        runtime.ReadMemStats(&m)
        
        // –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö
        fmt.Printf("Goroutines: %d, CPUs: %d\n", 
            runtime.NumGoroutine(), 
            runtime.GOMAXPROCS(0))
        
        time.Sleep(2 * time.Second)
    }
}

func main() {
    go monitorStealing()
    
    // –°–æ–∑–¥–∞–µ–º –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
    for i := 0; i < 1000; i++ {
        go func(id int) {
            // –î–ª–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
            for {
                time.Sleep(time.Second)
            }
        }(i)
    }
    
    select {} // –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
}
```

## –ò—Ç–æ–≥

**Work stealing –≤ Go –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:**

1. **‚öñÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É** –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏
2. **üö´ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ—Å—Ç–æ—è** - —Å–≤–æ–±–æ–¥–Ω—ã–µ CPU —Å—Ä–∞–∑—É –Ω–∞—Ö–æ–¥—è—Ç —Ä–∞–±–æ—Ç—É
3. **üìà –í—ã—Å–æ–∫—É—é —É—Ç–∏–ª–∏–∑–∞—Ü–∏—é** –≤—Å–µ—Ö —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
4. **üéØ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å** –∫ –∏–∑–º–µ–Ω—è—é—â–µ–π—Å—è –Ω–∞–≥—Ä—É–∑–∫–µ
5. **üèÉ‚Äç‚ôÇÔ∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

–≠—Ç–æ—Ç –º–µ—Ö–∞–Ω–∏–∑–º ‚Äî –æ–¥–Ω–∞ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏—á–∏–Ω, –ø–æ—á–µ–º—É Go –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∞–∫—É—é –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ highly concurrent —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã CPU –±–µ–∑ —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.
# 7. –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! **–õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ—Ü–µ—Å—Å–∞ (P)** ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ Go, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

```go
// runtime/runtime2.go
type p struct {
    // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å - –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –Ω–∞ 256 –≥–æ—Ä—É—Ç–∏–Ω
    runqhead uint32           // –ì–æ–ª–æ–≤–∞ –æ—á–µ—Ä–µ–¥–∏ (—á—Ç–µ–Ω–∏–µ)
    runqtail uint32           // –•–≤–æ—Å—Ç –æ—á–µ—Ä–µ–¥–∏ (–∑–∞–ø–∏—Å—å)  
    runq     [256]guintptr    // –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –≥–æ—Ä—É—Ç–∏–Ω
    
    // –í—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–µ–π)
    runnext guintptr
    
    // –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Ç–æ–∫ OS
    m        muintptr
    
    // –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
    status   uint32  // _Pidle, _Prunning, _Psyscall
}
```

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

### –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞:
```
–õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å P (runq):
[head] -> [G1][G2][G3][G4][G5] ... [G256] <- [tail]
           ‚Üë                           ‚Üë
        —á—Ç–µ–Ω–∏–µ (runqget)           –∑–∞–ø–∏—Å—å (runqput)
```

## –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –≤ –æ—á–µ—Ä–µ–¥—å**

```go
// runtime/proc.go
func runqput(_p_ *p, gp *g, next bool) {
    if next {
        // 1. –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –≤ runnext
        oldnext := _p_.runnext
        _p_.runnext = gp
        if oldnext != 0 {
            // –°—Ç–∞—Ä—É—é –≥–æ—Ä—É—Ç–∏–Ω—É –∏–∑ runnext –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –æ–±—â—É—é –æ—á–µ—Ä–µ–¥—å
            gp = oldnext
        } else {
            return
        }
    }
    
    // 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –æ—á–µ—Ä–µ–¥—å (runq)
    for {
        h := atomic.LoadAcq(&_p_.runqhead)
        t := _p_.runqtail
        
        if t-h < uint32(len(_p_.runq)) {
            // –ï—Å—Ç—å –º–µ—Å—Ç–æ –≤ –æ—á–µ—Ä–µ–¥–∏
            _p_.runq[t%uint32(len(_p_.runq))] = gp
            atomic.StoreRel(&_p_.runqtail, t+1)
            return
        }
        
        // –û—á–µ—Ä–µ–¥—å –ø–æ–ª–Ω–∞ - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –ø–æ–ª–æ–≤–∏–Ω—É –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
        if runqputslow(_p_, gp, h, t) {
            return
        }
    }
}
```

### 2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –æ—á–µ—Ä–µ–¥–∏**

```go
func runqget(_p_ *p) (gp *g, inheritTime bool) {
    // 1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º runnext (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    for {
        next := _p_.runnext
        if next == 0 {
            break
        }
        if _p_.runnext.cas(next, 0) {
            return next.ptr(), true
        }
    }
    
    // 2. –ó–∞—Ç–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    for {
        h := atomic.LoadAcq(&_p_.runqhead)
        t := _p_.runqtail
        if t == h {
            return nil, false // –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞
        }
        
        gp := _p_.runq[h%uint32(len(_p_.runq))].ptr()
        if atomic.CasRel(&_p_.runqhead, h, h+1) {
            return gp, false
        }
    }
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func worker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    fmt.Printf("Worker %d started\n", id)
    time.Sleep(10 * time.Millisecond)
}

func main() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 1 CPU –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
    runtime.GOMAXPROCS(1)
    
    var wg sync.WaitGroup
    
    fmt.Printf("Initial goroutines: %d\n", runtime.NumGoroutine())
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ–ª—å—à–µ –≥–æ—Ä—É—Ç–∏–Ω, —á–µ–º —Ä–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ (256)
    for i := 0; i < 300; i++ {
        wg.Add(1)
        go worker(i, &wg)
        
        // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
        if i%50 == 0 {
            fmt.Printf("After %d goroutines: %d in system\n", 
                i, runtime.NumGoroutine())
            time.Sleep(1 * time.Millisecond)
        }
    }
    
    wg.Wait()
    fmt.Printf("Final goroutines: %d\n", runtime.NumGoroutine())
}
```

### –ü—Ä–∏–º–µ—Ä 2: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è runnext

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func highPriorityWorker(id int) {
    fmt.Printf("HIGH PRIORITY %d executed\n", id)
}

func normalWorker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    fmt.Printf("Normal worker %d\n", id)
    time.Sleep(time.Millisecond)
}

func main() {
    runtime.GOMAXPROCS(1)
    
    var wg sync.WaitGroup
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    for i := 0; i < 10; i++ {
        wg.Add(1)
        go normalWorker(i, &wg)
    }
    
    // –î–∞–µ–º –≤—Ä–µ–º—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
    time.Sleep(time.Millisecond)
    
    // –ì–æ—Ä—É—Ç–∏–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    // –û–Ω–∞ –ø–æ–ø–∞–¥–µ—Ç –≤ runnext –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –°–†–ê–ó–£ –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π
    go highPriorityWorker(999)
    
    time.Sleep(time.Millisecond)
    
    wg.Wait()
}
```

## –†–∞–∑–º–µ—Ä—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã:
```go
const (
    runqSize = 256          // –†–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    runqBatch = 32          // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω –¥–ª—è –≤–æ—Ä–æ–≤—Å—Ç–≤–∞
)

// –ö–æ–≥–¥–∞ –æ—á–µ—Ä–µ–¥—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è:
func runqputslow(_p_ *p, gp *g, h, t uint32) bool {
    var batch [len(_p_.runq)/2 + 1]*g
    
    // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    n := t - h
    n = n / 2
    
    for i := uint32(0); i < n; i++ {
        batch[i] = _p_.runq[(h+i)%uint32(len(_p_.runq))].ptr()
    }
    
    if !atomic.CasRel(&_p_.runqhead, h, h+n) {
        return false
    }
    
    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø–æ–ª–æ–≤–∏–Ω—É –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    batch[n] = gp
    for i := uint32(0); i < n+1; i++ {
        batch[i].schedlink = guintptr(0)
    }
    
    globrunqputbatch(&batch[0], n+1)
    return true
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π

### 1. **–õ–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫—ç—à–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞**

```go
func cacheLocalityExample() {
    // –ö–∞–∂–¥—ã–π P —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–µ–π –æ—á–µ—Ä–µ–¥—å—é
    // –î–∞–Ω–Ω—ã–µ –≥–æ—Ä—É—Ç–∏–Ω –æ—Å—Ç–∞—é—Ç—Å—è "–≥–æ—Ä—è—á–∏–º–∏" –≤ –∫—ç—à–µ CPU
    // –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è cache misses
}
```

### 2. **–°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏**

```go
func lowContention() {
    // –ö–∞–∂–¥—ã–π P —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–µ–π –æ—á–µ—Ä–µ–¥—å—é –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
    // –ù–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    // –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏/–≤–æ—Ä–æ–≤—Å—Ç–≤–µ
}
```

### 3. **–ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**

```go
func fastOperations() {
    // runqget/runqput - –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–µ
    // –û–±—ã—á–Ω–æ 1 –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
    // –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ = –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø
}
```

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é

### –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏:

```go
func overflowHandling() {
    // –ö–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (256 –≥–æ—Ä—É—Ç–∏–Ω):
    // 1. –ë–µ—Ä–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ (128 –≥–æ—Ä—É—Ç–∏–Ω)
    // 2. –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    // 3. –ù–æ–≤–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    
    // –°—Ö–µ–º–∞:
    // –õ–æ–∫–∞–ª—å–Ω–∞—è [G1..G256] -> –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ -> 
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è [G1..G128] + –õ–æ–∫–∞–ª—å–Ω–∞—è [G129..G256, newG]
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π

### –ü—Ä–∏–º–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```go
package main

import (
    "fmt"
    "runtime"
    "time"
)

func queueMonitor() {
    for {
        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
        procs := runtime.GOMAXPROCS(0)
        
        fmt.Printf("=== Queue Monitor ===\n")
        fmt.Printf("CPUs: %d, Goroutines: %d\n", 
            procs, runtime.NumGoroutine())
        
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        // –æ —Ä–∞–∑–º–µ—Ä–∞—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π
        
        time.Sleep(2 * time.Second)
    }
}

func main() {
    go queueMonitor()
    
    // –°–æ–∑–¥–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É
    for i := 0; i < 500; i++ {
        go func(id int) {
            time.Sleep(time.Second * 10)
        }(i)
    }
    
    select {}
}
```

## –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –í–µ–±-—Å–µ—Ä–≤–µ—Ä

```go
package main

import (
    "fmt"
    "net/http"
    "runtime"
    "time"
)

func handler(w http.ResponseWriter, r *http.Request) {
    // –ö–∞–∂–¥—ã–π HTTP –∑–∞–ø—Ä–æ—Å - –æ—Ç–¥–µ–ª—å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
    start := time.Now()
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    time.Sleep(10 * time.Millisecond)
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
    fmt.Fprintf(w, "Request processed in %v\n", time.Since(start))
}

func main() {
    http.HandleFunc("/", handler)
    
    fmt.Printf("Server starting with %d CPUs\n", runtime.GOMAXPROCS(0))
    fmt.Printf("Each CPU has local queue of %d goroutines\n", 256)
    
    // –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
    // —Ç—ã—Å—è—á–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    http.ListenAndServe(":8080", nil)
}
```

## –ò—Ç–æ–≥

**–õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ—Ü–µ—Å—Å–∞ P ‚Äî —ç—Ç–æ:**

1. **üèÉ‚Äç‚ôÇÔ∏è –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä** –Ω–∞ 256 –≥–æ—Ä—É—Ç–∏–Ω
2. **üéØ Runnext —Å–ª–æ—Ç** –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–∞–¥–∞—á
3. **üíæ –ö—ç—à-–¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è** —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
4. **üö´ –ë–µ—Å–∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø** –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
5. **‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç Go —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö concurrent –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
# 8. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å** ‚Äî —ç—Ç–æ –≤–∞–∂–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ Go, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –æ—á–µ—Ä–µ–¥—è–º–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

```go
// runtime/runtime2.go
type schedt struct {
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –≥–æ—Ä—É—Ç–∏–Ω
    runq     gQueue    // –û—á–µ—Ä–µ–¥—å –≥–æ—Ä—É—Ç–∏–Ω
    runqsize int32     // –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
    
    // Lock –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    runqlock mutex     // –ó–∞—â–∏—â–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    npidle   uint32    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ idle P
    nmspinning uint32  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ spinning M
}
```

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

### –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞:
```
–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å (sched.runq):
[G100] ‚Üî [G101] ‚Üî [G102] ‚Üî [G103] ‚Üî ... ‚Üî [G999]

–õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ P:
[P1] -> [G1, G2, G3]    [P2] -> [G4, G5]
[P3] -> [] (–ø—É—Å—Ç–æ)      [P4] -> [G6, G7]

// P3 –∑–∞–±–∏—Ä–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
```

## –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å**

```go
// runtime/proc.go
func globrunqput(gp *g) {
    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    lock(&sched.runqlock)
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –≤ –∫–æ–Ω–µ—Ü –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    sched.runq.pushBack(gp)
    sched.runqsize++
    
    unlock(&sched.runqlock)
}

// –ü–∞–∫–µ—Ç–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
func globrunqputbatch(batch []*g, n int32) {
    if n == 0 {
        return
    }
    
    lock(&sched.runqlock)
    for i := int32(0); i < n; i++ {
        sched.runq.pushBack(batch[i])
    }
    sched.runqsize += n
    unlock(&sched.runqlock)
}
```

### 2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏**

```go
func globrunqget(_p_ *p, max int32) *g {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    if sched.runqsize == 0 {
        return nil
    }
    
    lock(&sched.runqlock)
    
    // –í—ã—á–∏—Å–ª—è–µ–º —Å–∫–æ–ª—å–∫–æ –≤–∑—è—Ç—å (–Ω–µ –±–æ–ª–µ–µ 1/2 –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏)
    n := sched.runqsize / runtime.GOMAXPROCS(0) + 1
    if n > sched.runqsize {
        n = sched.runqsize
    }
    if n > max {
        n = max
    }
    if n == 0 {
        unlock(&sched.runqlock)
        return nil
    }
    
    // –ë–µ—Ä–µ–º –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    gp := sched.runq.pop() // –ü–µ—Ä–≤–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
    n--
    sched.runqsize--
    
    // –ü–æ–º–µ—â–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å P
    for n > 0 {
        gp1 := sched.runq.pop()
        sched.runqsize--
        runqput(_p_, gp1, false)
        n--
    }
    
    unlock(&sched.runqlock)
    return gp
}
```

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å

### 1. **–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏**

```go
// runtime/proc.go
func runqputslow(_p_ *p, gp *g, h, t uint32) bool {
    // –ö–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ (256 –≥–æ—Ä—É—Ç–∏–Ω)
    // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    
    var batch [len(_p_.runq)/2 + 1]*g
    n := t - h
    n = n / 2
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º batch –∏–∑ –ø–µ—Ä–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    for i := uint32(0); i < n; i++ {
        batch[i] = _p_.runq[(h+i)%uint32(len(_p_.runq))].ptr()
    }
    
    if !atomic.CasRel(&_p_.runqhead, h, h+n) {
        return false
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≥–æ—Ä—É—Ç–∏–Ω—É –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    batch[n] = gp
    globrunqputbatch(&batch[0], n+1)
    return true
}
```

### 2. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω**

```go
// runtime/proc.go
func newproc1(fn *funcval, argp unsafe.Pointer, narg int32, callergp *g, callerpc uintptr) {
    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã
    newg := gfget(_p_)
    
    if randomizeScheduler && randomEnabled && debug.schedrace == 0 {
        delay := uint32(fastrand())
        if delay%10 == 0 { // 10% chance –ø–æ–ø–∞—Å—Ç—å –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
            lock(&sched.runqlock)
            globrunqput(newg)
            unlock(&sched.runqlock)
            return
        }
    }
    
    // –û–±—ã—á–Ω–æ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    runqput(_p_, newg, true)
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func worker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    time.Sleep(time.Microsecond * 100)
    if id%100 == 0 {
        fmt.Printf("Worker %d completed\n", id)
    }
}

func main() {
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º CPU –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
    runtime.GOMAXPROCS(2)
    
    var wg sync.WaitGroup
    
    fmt.Printf("Starting with %d CPUs\n", runtime.GOMAXPROCS(0))
    fmt.Printf("Initial goroutines: %d\n", runtime.NumGoroutine())
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ–ª—å—à–µ –≥–æ—Ä—É—Ç–∏–Ω, —á–µ–º –≤–º–µ—â–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏
    total := 600  // 2 CPU * 256 = 512 –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥—è—Ö + 88 –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π
    for i := 0; i < total; i++ {
        wg.Add(1)
        go worker(i, &wg)
        
        if i%100 == 0 {
            fmt.Printf("Created %d goroutines, total in system: %d\n", 
                i, runtime.NumGoroutine())
            time.Sleep(time.Millisecond) // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        }
    }
    
    fmt.Printf("All %d goroutines created, waiting...\n", total)
    fmt.Printf("Current goroutines: %d\n", runtime.NumGoroutine())
    
    wg.Wait()
    fmt.Println("All workers completed")
}
```

### –ü—Ä–∏–º–µ—Ä 2: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "sync/atomic"
    "time"
)

var (
    globalQueueCount int64
    localQueueCount  int64
)

func monitoredWorker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    
    // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
    time.Sleep(time.Millisecond * 5)
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ —Ç–æ–º, –≥–¥–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –≥–æ—Ä—É—Ç–∏–Ω–∞
    if id%50 == 0 {
        fmt.Printf("Worker %d - Global: %d, Local: %d\n", 
            id, atomic.LoadInt64(&globalQueueCount), 
            atomic.LoadInt64(&localQueueCount))
    }
}

func main() {
    runtime.GOMAXPROCS(4)
    
    var wg sync.WaitGroup
    total := 1000
    
    // –°–æ–∑–¥–∞–µ–º –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
    for i := 0; i < total; i++ {
        wg.Add(1)
        
        // –ü–µ—Ä–≤—ã–µ –≥–æ—Ä—É—Ç–∏–Ω—ã —Å–æ–∑–¥–∞–µ–º –±—ã—Å—Ç—Ä–æ (–ø–æ–ø–∞–¥—É—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å)
        if i < 300 {
            atomic.AddInt64(&globalQueueCount, 1)
        } else {
            atomic.AddInt64(&localQueueCount, 1)
        }
        
        go monitoredWorker(i, &wg)
        
        // –ò–º–∏—Ç–∏—Ä—É–µ–º –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω
        if i < 300 {
            time.Sleep(time.Microsecond * 10)
        }
    }
    
    wg.Wait()
    fmt.Printf("Final stats - Global: %d, Local: %d\n",
        atomic.LoadInt64(&globalQueueCount), 
        atomic.LoadInt64(&localQueueCount))
}
```

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º

### –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º:

```go
// runtime/proc.go
func findrunnable() (gp *g, inheritTime bool) {
    // 1. –ü–æ–ø—ã—Ç–∫–∞ –≤–∑—è—Ç—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    if gp, inheritTime := runqget(_p_); gp != nil {
        return gp, inheritTime
    }
    
    // 2. –ü–æ–ø—ã—Ç–∫–∞ –≤–∑—è—Ç—å –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    if sched.runqsize != 0 {
        lock(&sched.runqlock)
        gp := globrunqget(_p_, 0)
        unlock(&sched.runqlock)
        if gp != nil {
            return gp, false
        }
    }
    
    // 3. Work stealing —É –¥—Ä—É–≥–∏—Ö P
    if gp := runqsteal(_p_, allp[enum.position()]); gp != nil {
        return gp, false
    }
    
    // 4. –°–µ—Ç–µ–≤–æ–π poller –∏ –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
    // ...
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

### 1. **–ë—É—Ñ–µ—Ä –¥–ª—è –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏**

```go
func peakLoadBuffer() {
    // –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ –≥–æ—Ä—É—Ç–∏–Ω –±—ã—Å—Ç—Ä–æ:
    // - –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è
    // - –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–∑–±—ã—Ç–æ–∫
    // - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É
}
```

### 2. **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏**

```go
func loadBalancing() {
    // –°–≤–æ–±–æ–¥–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –º–æ–≥—É—Ç –±—Ä–∞—Ç—å —Ä–∞–±–æ—Ç—É –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    // –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—É—á—à—É—é —É—Ç–∏–ª–∏–∑–∞—Ü–∏—é CPU
}
```

### 3. **–†–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞–±–æ—Ç—ã**

```go
func backupWorkSource() {
    // –ö–æ–≥–¥–∞ work stealing –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ä–∞–±–æ—Ç—É —É –¥—Ä—É–≥–∏—Ö P
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å —Å–ª—É–∂–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –≥–æ—Ä—É—Ç–∏–Ω
}
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

### 1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ—Å—Ç—É–ø–∞**

```go
func globalQueueLock() {
    // –î–æ—Å—Ç—É–ø –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –∑–∞—â–∏—â–µ–Ω –º—å—é—Ç–µ–∫—Å–æ–º
    // –≠—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å contention –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
    lock(&sched.runqlock)   // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    // –æ–ø–µ—Ä–∞—Ü–∏–∏...
    unlock(&sched.runqlock) // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
}
```

### 2. **–ú–µ–Ω—å—à–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**

```go
func efficiencyComparison() {
    // –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å: ~0.2¬µs –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é (–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å: ~1.0¬µs –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏)
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏

### –ü—Ä–∏–º–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```go
package main

import (
    "fmt"
    "runtime"
    "time"
)

func globalQueueMonitor() {
    for {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –¥–æ—Å—Ç—É–ø –∫ sched.runqsize
        // —á–µ—Ä–µ–∑ internal –ø–∞–∫–µ—Ç—ã –∏–ª–∏ debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        
        goroutines := runtime.NumGoroutine()
        cpus := runtime.GOMAXPROCS(0)
        
        fmt.Printf("Goroutines: %d, CPUs: %d\n", goroutines, cpus)
        
        // –≠–º–ø–∏—Ä–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
        if goroutines > cpus * 256 {
            estimatedGlobal := goroutines - cpus * 256
            fmt.Printf("Estimated global queue size: %d\n", estimatedGlobal)
        }
        
        time.Sleep(2 * time.Second)
    }
}

func main() {
    go globalQueueMonitor()
    
    // –°–æ–∑–¥–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É
    for i := 0; i < 2000; i++ {
        go func(id int) {
            time.Sleep(time.Minute)
        }(i)
        time.Sleep(time.Millisecond)
    }
    
    select {}
}
```

## –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

```go
package main

import (
    "fmt"
    "net/http"
    "runtime"
    "time"
)

func burstHandler(w http.ResponseWriter, r *http.Request) {
    // –ò–º–∏—Ç–∞—Ü–∏—è –≤—Å–ø–ª–µ—Å–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
    for i := 0; i < 100; i++ {
        go func(reqID int) {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
            time.Sleep(time.Millisecond * 10)
        }(i)
    }
    
    fmt.Fprintf(w, "Burst processed - Goroutines: %d", 
        runtime.NumGoroutine())
}

func main() {
    http.HandleFunc("/burst", burstHandler)
    
    fmt.Println("Server started on :8080")
    fmt.Println("Global queue will handle burst loads")
    
    http.ListenAndServe(":8080", nil)
}
```

## –ò—Ç–æ–≥

**–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ Go ‚Äî —ç—Ç–æ:**

1. **üîÑ –ë—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π
2. **‚öñÔ∏è –ú–µ—Ö–∞–Ω–∏–∑–º –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏** –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏  
3. **üÜò –†–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫** —Ä–∞–±–æ—Ç—ã –¥–ª—è —Å–≤–æ–±–æ–¥–Ω—ã—Ö P
4. **üîí –ó–∞—â–∏—â–µ–Ω–Ω–∞—è –º—å—é—Ç–µ–∫—Å–æ–º** —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–º–µ–Ω—å—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
5. **üìà –ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫**

–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—Å–Ω–æ–π —Å–≤—è–∑–∫–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –æ—á–µ—Ä–µ–¥—è–º–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Ä–µ–∑–∫–∏—Ö –≤—Å–ø–ª–µ—Å–∫–∞—Ö –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –º–µ–∂–¥—É –≤—Å–µ–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏.
# 9. Wait –æ—á–µ—Ä–µ–¥—å
–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! **Wait –æ—á–µ—Ä–µ–¥—å** ‚Äî —ç—Ç–æ –≤–∞–∂–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ Go –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏.

## –ß—Ç–æ —Ç–∞–∫–æ–µ wait –æ—á–µ—Ä–µ–¥—å?

**Wait –æ—á–µ—Ä–µ–¥—å** ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã, –æ–∂–∏–¥–∞—é—â–∏–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–∏–º–∏—Ç–∏–≤–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- **–ö–∞–Ω–∞–ª—ã** (channel operations)
- **–ú—å—é—Ç–µ–∫—Å—ã** (mutexes) 
- **–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (condition variables)
- **–¢–∞–π–º–µ—Ä—ã** (timers)
- **–°–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (network I/O)

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö wait –æ—á–µ—Ä–µ–¥–µ–π

### 1. **sudog - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–∂–∏–¥–∞—é—â–µ–π –≥–æ—Ä—É—Ç–∏–Ω—ã**

```go
// runtime/runtime2.go
type sudog struct {
    // –ì–æ—Ä—É—Ç–∏–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–∂–∏–¥–∞–µ—Ç
    g *g
    
    // –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π sudog –≤ –æ—á–µ—Ä–µ–¥–∏
    next *sudog
    prev *sudog
    
    // –û–±—ä–µ–∫—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∫–∞–Ω–∞–ª, –º—å—é—Ç–µ–∫—Å –∏ —Ç.–¥.)
    elem unsafe.Pointer // data element
    
    // –ü—Ä–∏–º–∏—Ç–∏–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    c        *hchan     // –∫–∞–Ω–∞–ª
    waitlink *sudog     // wait queue for semaphore
    waittail *sudog     
    
    // –¢–∞–π–º–µ—Ä—ã
    t        *timer
    
    // –î–ª—è select
    isSelect bool
    success  bool
    
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    releasetime int64
}
```

## –¢–∏–ø—ã wait –æ—á–µ—Ä–µ–¥–µ–π

### 1. **Wait –æ—á–µ—Ä–µ–¥—å –∫–∞–Ω–∞–ª–æ–≤**

```go
// runtime/chan.go
type hchan struct {
    // –î–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª–∞
    qcount   uint           // –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏
    dataqsiz uint           // —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –∫–∞–Ω–∞–ª–∞
    buf      unsafe.Pointer // —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±—É—Ñ–µ—Ä
    elemsize uint16
    elemtype *_type // —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞
    
    // –û—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è
    sendq    waitq  // –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω
    recvq    waitq  // –æ—á–µ—Ä–µ–¥—å –ø–æ–ª—É—á–∞—é—â–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω
    
    lock mutex
}

type waitq struct {
    first *sudog  // –≥–æ–ª–æ–≤–∞ –æ—á–µ—Ä–µ–¥–∏
    last  *sudog  // —Ö–≤–æ—Å—Ç –æ—á–µ—Ä–µ–¥–∏
}
```

### 2. **Wait –æ—á–µ—Ä–µ–¥—å –º—å—é—Ç–µ–∫—Å–æ–≤**

```go
// runtime/sync.go
type mutex struct {
    // –ë–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    state int32
    
    // –û—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è
    sema  uint32
}

// –û—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è sync.Mutex
func sync_runtime_SemacquireMutex(addr *uint32, lifo bool, skipframes int) {
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è –º—å—é—Ç–µ–∫—Å–∞
}
```

## –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã wait –æ—á–µ—Ä–µ–¥–µ–π

### 1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª–µ (send)**

```go
// runtime/chan.go
func chansend(c *hchan, ep unsafe.Pointer, block bool, callerpc uintptr) bool {
    lock(&c.lock)
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ - —Ä–∞–∑–±—É–¥–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ
    if sg := c.recvq.dequeue(); sg != nil {
        // –ü—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª—é
        unlock(&c.lock)
        return true
    }
    
    // –ï—Å–ª–∏ –±—É—Ñ–µ—Ä –ø–æ–ª–Ω—ã–π - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è
    if c.qcount >= c.dataqsiz {
        // –°–æ–∑–¥–∞–Ω–∏–µ sudog –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏
        gp := getg()
        mysg := acquireSudog()
        mysg.g = gp
        mysg.elem = ep
        mysg.c = c
        gp.waiting = mysg
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏
        c.sendq.enqueue(mysg)
        
        // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è
        gopark(chanparkcommit, unsafe.Pointer(&c.lock), waitReasonChanSend, traceEvGoBlockSend, 2)
        
        // –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ
        releaseSudog(mysg)
        return true
    }
    
    unlock(&c.lock)
    return true
}
```

### 2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª–µ (receive)**

```go
func chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool) {
    lock(&c.lock)
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–∂–∏–¥–∞—é—â–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–∏ - —Ä–∞–∑–±—É–¥–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ
    if sg := c.sendq.dequeue(); sg != nil {
        // –ü—Ä—è–º–æ–π –ø—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
        unlock(&c.lock)
        return true, true
    }
    
    // –ï—Å–ª–∏ –±—É—Ñ–µ—Ä –ø—É—Å—Ç–æ–π - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è
    if c.qcount == 0 {
        gp := getg()
        mysg := acquireSudog()
        mysg.g = gp
        mysg.elem = ep
        mysg.c = c
        gp.waiting = mysg
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –ø–æ–ª—É—á–µ–Ω–∏—è
        c.recvq.enqueue(mysg)
        
        // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è
        gopark(chanparkcommit, unsafe.Pointer(&c.lock), waitReasonChanReceive, traceEvGoBlockRecv, 2)
        
        // –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ
        releaseSudog(mysg)
        return true, false
    }
    
    unlock(&c.lock)
    return true, true
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

### –ü—Ä–∏–º–µ—Ä 1: Wait –æ—á–µ—Ä–µ–¥—å –∫–∞–Ω–∞–ª–∞

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func demonstrateChannelWaitQueue() {
    ch := make(chan int, 2) // –ë—É—Ñ–µ—Ä —Ä–∞–∑–º–µ—Ä–æ–º 2
    
    var wg sync.WaitGroup
    
    // Producer - –∑–∞–ø–æ–ª–Ω—è–µ—Ç –±—É—Ñ–µ—Ä –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
    wg.Add(1)
    go func() {
        defer wg.Done()
        
        fmt.Println("Producer: sending 1, 2, 3...")
        ch <- 1 // –ü—Ä–æ—Ö–æ–¥–∏—Ç
        ch <- 2 // –ü—Ä–æ—Ö–æ–¥–∏—Ç
        fmt.Println("Producer: buffer full, blocking on send 3...")
        ch <- 3 // –ë–õ–û–ö–ò–†–û–í–ö–ê - –ø–æ–ø–∞–¥–∞–µ—Ç –≤ sendq wait queue
        fmt.Println("Producer: unblocked, sent 3")
    }()
    
    time.Sleep(100 * time.Millisecond)
    
    // Consumer - –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º–µ—Å—Ç–æ –≤ –±—É—Ñ–µ—Ä–µ
    wg.Add(1)
    go func() {
        defer wg.Done()
        
        time.Sleep(500 * time.Millisecond) // –î–∞–µ–º producer'—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è
        
        fmt.Println("Consumer: receiving...")
        fmt.Println("Received:", <-ch) // –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º–µ—Å—Ç–æ –∏ –±—É–¥–∏—Ç producer'a
    }()
    
    wg.Wait()
    fmt.Printf("Active goroutines: %d\n", runtime.NumGoroutine())
}
```

### –ü—Ä–∏–º–µ—Ä 2: Wait –æ—á–µ—Ä–µ–¥—å –º—å—é—Ç–µ–∫—Å–∞

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func demonstrateMutexWaitQueue() {
    var mu sync.Mutex
    var wg sync.WaitGroup
    
    resource := "initial"
    
    // –ü–µ—Ä–≤–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –º—å—é—Ç–µ–∫—Å –Ω–∞–¥–æ–ª–≥–æ
    wg.Add(1)
    go func() {
        defer wg.Done()
        
        fmt.Println("Goroutine 1: acquiring mutex...")
        mu.Lock()
        fmt.Println("Goroutine 1: mutex acquired, working...")
        
        resource = "modified by goroutine 1"
        time.Sleep(2 * time.Second) // –î–æ–ª–≥–∞—è —Ä–∞–±–æ—Ç–∞
        
        mu.Unlock()
        fmt.Println("Goroutine 1: mutex released")
    }()
    
    time.Sleep(100 * time.Millisecond) // –î–∞–µ–º –ø–µ—Ä–≤–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –º—å—é—Ç–µ–∫—Å
    
    // –í—Ç–æ—Ä–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –º—å—é—Ç–µ–∫—Å–µ
    wg.Add(1)
    go func() {
        defer wg.Done()
        
        fmt.Println("Goroutine 2: trying to acquire mutex...")
        mu.Lock() // –ë–õ–û–ö–ò–†–û–í–ö–ê - –ø–æ–ø–∞–¥–∞–µ—Ç –≤ wait queue –º—å—é—Ç–µ–∫—Å–∞
        fmt.Println("Goroutine 2: mutex acquired!")
        
        resource = "modified by goroutine 2"
        mu.Unlock()
        fmt.Println("Goroutine 2: mutex released")
    }()
    
    // –¢—Ä–µ—Ç—å—è –≥–æ—Ä—É—Ç–∏–Ω–∞ —Ç–∞–∫–∂–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
    wg.Add(1)
    go func() {
        defer wg.Done()
        
        fmt.Println("Goroutine 3: trying to acquire mutex...")
        mu.Lock() // –ë–õ–û–ö–ò–†–û–í–ö–ê - –ø–æ–ø–∞–¥–∞–µ—Ç –≤ wait queue –º—å—é—Ç–µ–∫—Å–∞
        fmt.Println("Goroutine 3: mutex acquired!")
        
        resource = "modified by goroutine 3"
        mu.Unlock()
        fmt.Println("Goroutine 3: mutex released")
    }()
    
    wg.Wait()
    fmt.Println("Final resource:", resource)
    fmt.Printf("Active goroutines: %d\n", runtime.NumGoroutine())
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ wait –æ—á–µ—Ä–µ–¥–µ–π

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func monitorWaitQueues() {
    ch := make(chan int) // –ù–µ–±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
    var mu sync.Mutex
    
    var wg sync.WaitGroup
    
    // –ú–æ–Ω–∏—Ç–æ—Ä –≥–æ—Ä—É—Ç–∏–Ω
    go func() {
        for {
            fmt.Printf("Goroutines: %d (waiting in queues)\n", 
                runtime.NumGoroutine())
            time.Sleep(500 * time.Millisecond)
        }
    }()
    
    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª–µ
    wg.Add(2)
    go func() {
        defer wg.Done()
        fmt.Println("Sender: blocking on channel send...")
        ch <- 42 // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ sendq
        fmt.Println("Sender: unblocked")
    }()
    
    go func() {
        defer wg.Done()
        fmt.Println("Receiver: blocking on channel receive...")
        <-ch // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ recvq
        fmt.Println("Receiver: unblocked")
    }()
    
    time.Sleep(1 * time.Second)
    
    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –º—å—é—Ç–µ–∫—Å–µ
    wg.Add(3)
    mu.Lock()
    
    for i := 0; i < 3; i++ {
        go func(id int) {
            defer wg.Done()
            fmt.Printf("Mutex waiter %d: blocking...\n", id)
            mu.Lock() // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ wait queue –º—å—é—Ç–µ–∫—Å–∞
            fmt.Printf("Mutex waiter %d: acquired mutex\n", id)
            mu.Unlock()
        }(i)
    }
    
    time.Sleep(1 * time.Second)
    fmt.Println("Releasing mutex...")
    mu.Unlock()
    
    wg.Wait()
}
```

## –ú–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏—è gopark –∏ goready

```go
// runtime/proc.go
func gopark(unlockf func(*g, unsafe.Pointer) bool, lock unsafe.Pointer, reason waitReason, traceEv byte, traceskip int) {
    // –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≥–æ—Ä—É—Ç–∏–Ω—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è
    mp := acquirem()
    releasem(mp)
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    mg := getg()
    mg.m.waitlock = lock
    mg.m.waitunlockf = unlockf
    
    // –°–º–µ–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    casgstatus(mg, _Grunning, _Gwaiting)
    
    // –í—ã–∑–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
    schedule()
}

func goready(gp *g, traceskip int) {
    // –ü—Ä–æ–±—É–∂–¥–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—É
    systemstack(func() {
        ready(gp, traceskip, true)
    })
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ wait –æ—á–µ—Ä–µ–¥–µ–π

### 1. **FIFO –ø–æ—Ä—è–¥–æ–∫** (–æ–±—ã—á–Ω–æ)

```go
// –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ - First-In-First-Out
// –ü–µ—Ä–≤–∞—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π
```

### 2. **–ü—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö**

```go
// –ü—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å –∫–∞–Ω–∞–ª–∞–º–∏ –≤–æ–∑–º–æ–∂–Ω–∞ –ø—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞
// –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º –º–∏–Ω—É—è –±—É—Ñ–µ—Ä
```

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å netpoller**

```go
// –°–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º
// —á–µ—Ä–µ–∑ netpoller, –Ω–æ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç wait queues
```

## –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: Producer-Consumer

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func producerConsumerWithWaitQueues() {
    const (
        numProducers = 3
        numConsumers = 2
        bufferSize   = 5
    )
    
    ch := make(chan int, bufferSize)
    var wg sync.WaitGroup
    
    // Producers
    for i := 0; i < numProducers; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            
            for j := 0; j < 10; j++ {
                item := id*100 + j
                fmt.Printf("Producer %d: sending %d\n", id, item)
                ch <- item
                fmt.Printf("Producer %d: sent %d\n", id, item)
                time.Sleep(50 * time.Millisecond)
            }
        }(i)
    }
    
    // Consumers
    for i := 0; i < numConsumers; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            
            for j := 0; j < 15; j++ {
                time.Sleep(100 * time.Millisecond) // –ú–µ–¥–ª–µ–Ω–Ω—ã–µ consumers
                item := <-ch
                fmt.Printf("Consumer %d: received %d\n", id, item)
            }
        }(i)
    }
    
    wg.Wait()
    close(ch)
    fmt.Println("All done!")
}
```

## –ò—Ç–æ–≥

**Wait –æ—á–µ—Ä–µ–¥–∏ –≤ Go ‚Äî —ç—Ç–æ:**

1. **‚è≥ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–∂–∏–¥–∞–Ω–∏—è** –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω
2. **üìã sudog —ç–ª–µ–º–µ–Ω—Ç—ã** –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –∂–¥—É—â–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã
3. **üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–∏—Ç–∏–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
4. **üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º** —á–µ—Ä–µ–∑ gopark/goready
5. **‚ö° –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ** –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

Wait –æ—á–µ—Ä–µ–¥–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—ã—Å—è—á–∞–º–∏ –æ–∂–∏–¥–∞—é—â–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω –±–µ–∑ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è CPU —Ä–µ—Å—É—Ä—Å–æ–≤.
# 10. –û—á–µ—Ä–µ–¥—å net pull

# 11. –†–∞–Ω—Ç–∞–π–º –≥–æ

# 12. –°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –≥–æ

# 13. –ó–∞ —Å—á–µ—Ç —á–µ–≥–æ –≥–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

# 14. –ö–∞–Ω–∞–ª—ã

# 15. –ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å –≤ nil –∫–∞–Ω–∞–ª

# 16. –ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤ nil –∫–∞–Ω–∞–ª

# 17. deadlock

# 18. –ø–µ—Ä–µ–¥–∞—á–∞ –∏–∑ –æ–¥–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã –≤ –¥—Ä—É–≥—É—é —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª

# 19. –º—å—é—Ç–µ–∫—Å—ã

# 20. –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –±—É—Ñ–µ—Ä –≤ –≥–æ –∫–∞–Ω–∞–ª–∞—Ö

# 21. –∞—Ç–æ–º–∏–∫–∏

# 22. wait group

# 23. –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

# 24. —É—Ç–∏–Ω–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è

# 25. –∏–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ—è—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

# 26. –ø–∞–º—è—Ç—å –≤ –≥–æ

# 27. –æ—Ç–ª–∏—á–∏–µ —Å–ª–∞–π—Å–∞ –æ—Ç –º–∞–ø—ã

# 28. –¥–ª–∏–Ω–∞ —Å–ª–∞–π—Å–∞ –∏ –µ–º–∫–æ—Å—Ç—å

# 29. –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è –¥–ª–∏–Ω–∞ —Å–ª–∞–π—Å–∞

# 30. –∫–∞–∫ –≤–Ω—É—Ç—Ä–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–∞–ø–∞

# 31. —ç–≤–∞–∫—É–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

# 32. —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞

# 33. write –±–∞—Ä—å–µ—Ä

# 34. —Ç–µ—Å—Ç—ã –≤ –≥–æ

# 35. –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥—ã go test

# 36. –º–æ–∫–∏

# 37. –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ –ø—Ä–æ–≥—Ä–∞–º–º

# 38.  —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

# 39. –∫–∞–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è cap slice ------------------------------------

# 40. —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ —Å–ª–∞–π—Å
