# 1 - –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
–í Go (Golang) –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã—Ö (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö) —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

---

### 1. **–ß–∏—Å–ª–æ–≤—ã–µ —Ç–∏–ø—ã**
#### –¶–µ–ª—ã–µ —á–∏—Å–ª–∞:
- **–ó–Ω–∞–∫–æ–≤—ã–µ** (–º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏):  
  `int8`, `int16`, `int32`, `int64`  
  `int` ‚Äî —Ä–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (32 –∏–ª–∏ 64 –±–∏—Ç–∞).
- **–ë–µ–∑–∑–Ω–∞–∫–æ–≤—ã–µ** (—Ç–æ–ª—å–∫–æ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ):  
  `uint8`, `uint16`, `uint32`, `uint64`, `uint`  
  `byte` ‚Äî —Å–∏–Ω–æ–Ω–∏–º –¥–ª—è `uint8`.  
  `rune` ‚Äî —Å–∏–Ω–æ–Ω–∏–º –¥–ª—è `int32` (—Ö—Ä–∞–Ω–∏—Ç Unicode-—Å–∏–º–≤–æ–ª).
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–æ–∑–∞–≤–∏—Å–∏–º—ã–µ**:  
  `int` –∏ `uint` ‚Äî 32 –∏–ª–∏ 64 –±–∏—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –û–°.

#### –ß–∏—Å–ª–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π:
- `float32` ‚Äî 32-–±–∏—Ç–Ω–æ–µ —á–∏—Å–ª–æ (—Ç–æ—á–Ω–æ—Å—Ç—å ~6 –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö —Ü–∏—Ñ—Ä).
- `float64` ‚Äî 64-–±–∏—Ç–Ω–æ–µ —á–∏—Å–ª–æ (—Ç–æ—á–Ω–æ—Å—Ç—å ~15 —Ü–∏—Ñ—Ä, **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**).

#### –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —á–∏—Å–ª–∞:
- `complex64` (–Ω–∞ –æ—Å–Ω–æ–≤–µ `float32`).  
- `complex128` (–Ω–∞ –æ—Å–Ω–æ–≤–µ `float64`).  
–ü—Ä–∏–º–µ—Ä: `var c complex64 = 1 + 2i`.

---

### 2. **–°—Ç—Ä–æ–∫–æ–≤—ã–π —Ç–∏–ø**
- `string` ‚Äî –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç (–æ–±—ã—á–Ω–æ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8).  
–ü—Ä–∏–º–µ—Ä: `s := "Hello, ‰∏ñÁïå"`.

---

### 3. **–õ–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–∏–ø**
- `bool` ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `true` –∏–ª–∏ `false`.

---

### 4. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã**
- **`byte`** ‚Äî –∞–ª–∏–∞—Å –¥–ª—è `uint8` (—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).  
- **`rune`** ‚Äî –∞–ª–∏–∞—Å –¥–ª—è `int32` (—Ö—Ä–∞–Ω–∏—Ç Unicode-—Å–∏–º–≤–æ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä `'A'` –∏–ª–∏ `'‰∏ñ'`).  

---

### –ü—Ä–∏–º–µ—Ä—ã –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
```go
var age int = 30
var price float64 = 29.99
var name string = "Alice"
var isActive bool = true
var symbol rune = '‚ô•'
var data byte = 0xFF
```

---

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **–ù—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:  
  - –ß–∏—Å–ª–∞: `0`  
  - –°—Ç—Ä–æ–∫–∏: `""` (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞)  
  - –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–∏–ø: `false`  
- **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è**: —Ç–∏–ø –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
- **–í—ã–≤–æ–¥ —Ç–∏–ø–æ–≤**: –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:  
  ```go
  x := 42      // int
  y := 3.14    // float64
  z := "Hello" // string
  ```

---

### –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
Go –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–º–µ—à–∏–≤–∞—Ç—å —Ç–∏–ø—ã –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö –±–µ–∑ —è–≤–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:  
```go
var a int32 = 10
var b int64 = 20
// –û—à–∏–±–∫–∞: invalid operation (–Ω–µ–ª—å–∑—è —Å–ª–æ–∂–∏—Ç—å int32 –∏ int64)
// result := a + b // –¢–∞–∫ –Ω–µ–ª—å–∑—è!
result := int64(a) + b // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

–ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –≤ Go –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø—Ä–æ—Å—Ç–æ—Ç—É, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
# 2 - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫–∏

–í Go —Å—Ç—Ä–æ–∫–∞ –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–æ–∫–∏

```go
// –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
type stringStruct struct {
    str unsafe.Pointer // —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–∞—Å—Å–∏–≤ –±–∞–π—Ç
    len int           // –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ –≤ –±–∞–π—Ç–∞—Ö
}
```

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. **–ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å (immutable)**
```go
s := "Hello"
// s[0] = 'h' // –û—à–∏–±–∫–∞: –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç—Ä–æ–∫—É

// –°–æ–∑–¥–∞–µ—Ç—Å—è –ù–û–í–ê–Ø —Å—Ç—Ä–æ–∫–∞
s = "hello" + " world"
```

### 2. **UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
```go
s := "–ü—Ä–∏–≤–µ—Ç"  // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ UTF-8
fmt.Println(len(s)) // 12 –±–∞–π—Ç, –∞ –Ω–µ 6 —Å–∏–º–≤–æ–ª–æ–≤!
```

### 3. **–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**
```go
s := "Hello"
// –í –ø–∞–º—è—Ç–∏: | H | e | l | l | o |
//           ^
//           —É–∫–∞–∑–∞—Ç–µ–ª—å str
// –¥–ª–∏–Ω–∞ len = 5
```

## –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è

### –î–ª–∏–Ω–∞ –≤ –±–∞–π—Ç–∞—Ö vs —Å–∏–º–≤–æ–ª–∞—Ö
```go
s := "Hello, ‰∏ñÁïå"
fmt.Println(len(s)) // 13 –±–∞–π—Ç
fmt.Println(utf8.RuneCountInString(s)) // 9 —Å–∏–º–≤–æ–ª–æ–≤ (—Ä—É–Ω)
```

### –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```go
s1 := "very long string..."
s2 := s1 // –ù–µ –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞—Ç–µ–ª—å!
```

## –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

### –°—Ç—Ä–æ–∫–∞ ‚Üí –°—Ä–µ–∑ –±–∞–π—Ç
```go
s := "Hello"
b := []byte(s) // –°–æ–∑–¥–∞–µ—Ç –ö–û–ü–ò–Æ –¥–∞–Ω–Ω—ã—Ö
b[0] = 'h'
fmt.Println(s) // "Hello" (–Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å)
```

### –°—Ä–µ–∑ –±–∞–π—Ç ‚Üí –°—Ç—Ä–æ–∫–∞
```go
b := []byte{'H', 'e', 'l', 'l', 'o'}
s := string(b) // –°–æ–∑–¥–∞–µ—Ç –ö–û–ü–ò–Æ –¥–∞–Ω–Ω—ã—Ö
b[0] = 'h'
fmt.Println(s) // "Hello" (–Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å)
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞

### 1. **–ü—É–ª —Å—Ç—Ä–æ–∫ (string interning)**
```go
s1 := "hello"
s2 := "hello"
// –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –≤ –ø–∞–º—è—Ç–∏
```

### 2. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
```go
// –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é
s := "a" + "b" + "c"
// –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –≤ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª–µ–¥—Å—Ç–≤–∏—è

### 1. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–¥—Å—Ç—Ä–æ–∫**
```go
bigString := "very long text..."
sub := bigString[5:10] // –ù–µ –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ!
```

### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –±–æ–ª—å—à–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏**
```go
// –ü–ª–æ—Ö–æ: —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–ø–∏–∏
var result string
for i := 0; i < 1000; i++ {
    result += "data"
}

// –•–æ—Ä–æ—à–æ: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç strings.Builder
var builder strings.Builder
for i := 0; i < 1000; i++ {
    builder.WriteString("data")
}
result := builder.String()
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —è–∑—ã–∫–∞–º–∏

| –Ø–∑—ã–∫ | –ò–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å | –ö–æ–¥–∏—Ä–æ–≤–∫–∞ |
|------|--------------|-----------|
| Go | –ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è | UTF-8 |
| Java | –ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è | UTF-16 |
| Python | –ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è | UTF-8/16/32 |
| C++ | –ò–∑–º–µ–Ω—è–µ–º–∞—è | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ |

–¢–∞–∫–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–µ–ª–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ Go —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ —Ç–µ–∫—Å—Ç–∞ –∏ —á–∞—Å—Ç—ã–º–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏.
# 3 - –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏

–í Go –µ—Å—Ç—å –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

## 1. **–î–ª–∏–Ω–∞ –≤ –±–∞–π—Ç–∞—Ö (`len(string)`)**

–§—É–Ω–∫—Ü–∏—è `len()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **–±–∞–π—Ç–æ–≤** –≤ —Å—Ç—Ä–æ–∫–µ:

```go
package main

import "fmt"

func main() {
    s1 := "Hello"
    fmt.Println(len(s1)) // 5 (5 ASCII —Å–∏–º–≤–æ–ª–æ–≤ = 5 –±–∞–π—Ç)
    
    s2 := "–ü—Ä–∏–≤–µ—Ç"
    fmt.Println(len(s2)) // 12 (6 –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ √ó 2 –±–∞–π—Ç–∞)
    
    s3 := "Hello, ‰∏ñÁïå"
    fmt.Println(len(s3)) // 13 (7 + 1 + 5 –±–∞–π—Ç)
    // H e l l o , [–ø—Ä–æ–±–µ–ª] = 7 –±–∞–π—Ç
    // ‰∏ñÁïå = 2 —Å–∏–º–≤–æ–ª–∞ √ó 3 –±–∞–π—Ç–∞ = 6 –±–∞–π—Ç
}
```

## 2. **–î–ª–∏–Ω–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö (—Ä—É–Ω–∞—Ö)**

–î–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ Unicode —Å–∏–º–≤–æ–ª–æ–≤ (—Ä—É–Ω) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

### –°–ø–æ—Å–æ–± 1: `utf8.RuneCountInString()`
```go
package main

import (
    "fmt"
    "unicode/utf8"
)

func main() {
    s := "Hello, ‰∏ñÁïå"
    
    fmt.Println("–ë–∞–π—Ç—ã:", len(s))         // 13
    fmt.Println("–°–∏–º–≤–æ–ª—ã:", utf8.RuneCountInString(s)) // 9
}
```

### –°–ø–æ—Å–æ–± 2: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ä–µ–∑ —Ä—É–Ω
```go
s := "Hello, ‰∏ñÁïå"
chars := []rune(s)
fmt.Println("–°–∏–º–≤–æ–ª—ã:", len(chars)) // 9
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤
```go
texts := []string{
    "Hello",           // –¢–æ–ª—å–∫–æ ASCII
    "Caf√©",           // –° –∞–∫—Ü–µ–Ω—Ç–æ–º
    "–ü—Ä–∏–≤–µ—Ç",         // –ö–∏—Ä–∏–ª–ª–∏—Ü–∞  
    "Hello, ‰∏ñÁïå",     // –°–º–µ—à–∞–Ω–Ω—ã–π
    "üòÄüéâüåü",          // –≠–º–æ–¥–∑–∏
}

for _, text := range texts {
    bytes := len(text)
    runes := utf8.RuneCountInString(text)
    fmt.Printf("–¢–µ–∫—Å—Ç: %-10s –ë–∞–π—Ç—ã: %2d –°–∏–º–≤–æ–ª—ã: %2d\n", text, bytes, runes)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–¢–µ–∫—Å—Ç: Hello      –ë–∞–π—Ç—ã:  5 –°–∏–º–≤–æ–ª—ã:  5
–¢–µ–∫—Å—Ç: Caf√©       –ë–∞–π—Ç—ã:  5 –°–∏–º–≤–æ–ª—ã:  4
–¢–µ–∫—Å—Ç: –ü—Ä–∏–≤–µ—Ç     –ë–∞–π—Ç—ã: 12 –°–∏–º–≤–æ–ª—ã:  6
–¢–µ–∫—Å—Ç: Hello, ‰∏ñÁïå –ë–∞–π—Ç—ã: 13 –°–∏–º–≤–æ–ª—ã:  9
–¢–µ–∫—Å—Ç: üòÄüéâüåü      –ë–∞–π—Ç—ã: 12 –°–∏–º–≤–æ–ª—ã:  3
```

### –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ —Å–∏–º–≤–æ–ª–∞–º, –∞ –Ω–µ –±–∞–π—Ç–∞–º
```go
s := "Hello, ‰∏ñÁïå"

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –±–∞–π—Ç–∞–º
for i := 0; i < len(s); i++ {
    fmt.Printf("%c ", s[i]) // –ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –º–Ω–æ–≥–æ–±–∞–π—Ç–æ–≤—ã—Ö
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ —Ä—É–Ω–∞–º
for _, char := range s {
    fmt.Printf("%c ", char) // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ —Å–∏–º–≤–æ–ª—ã
}
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **`len(string)`** - O(1) –æ–ø–µ—Ä–∞—Ü–∏—è, —Ç–∞–∫ –∫–∞–∫ –¥–ª–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å—Ç—Ä–æ–∫–∏
- **`utf8.RuneCountInString()`** - O(n) –æ–ø–µ—Ä–∞—Ü–∏—è, —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –≤—Å–µ–π —Å—Ç—Ä–æ–∫–µ
- **`len([]rune(string))`** - O(n) + –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø–æ–¥ —Å—Ä–µ–∑

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

```go
// –î–ª—è ASCII —Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ len()
if len(username) < 3 {
    return errors.New("–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ")
}

// –î–ª—è Unicode —Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ utf8.RuneCountInString()
if utf8.RuneCountInString(displayName) > 20 {
    return errors.New("–æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ")
}

// –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ –æ–±–∞ —Å–ø–æ—Å–æ–±–∞ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã
if len(s) == 0 {
    // –∏–ª–∏ if utf8.RuneCountInString(s) == 0 {
    fmt.Println("–°—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞—è")
}
```

**–í—ã–≤–æ–¥:** –í—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –¥–ª–∏–Ω–æ–π –≤ –±–∞–π—Ç–∞—Ö –∏ –¥–ª–∏–Ω–æ–π –≤ —Å–∏–º–≤–æ–ª–∞—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Unicode —Ç–µ–∫—Å—Ç–æ–º.
# 4 - –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –º–∞–ø—ã –≤ GO

Map (–∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤) –≤ Go ‚Äî —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—ã, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø–∞–º—è—Ç–∏.

## –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

Map —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

**hmap** - –∑–∞–≥–æ–ª–æ–≤–æ–∫ map, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
- count - —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- B - –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Ä–∞–∑–º–µ—Ä–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∫–µ—Ç–æ–≤ = 2^B)
- buckets - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤
- oldbuckets - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç–∞—Ä—É—é —Ç–∞–±–ª–∏—Ü—É –≤–æ –≤—Ä–µ–º—è —Ä–æ—Å—Ç–∞
- hash0 - seed –¥–ª—è —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏–∏

**bmap** - –±–∞–∫–µ—Ç (–∫–æ—Ä–∑–∏–Ω–∞), —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
- tophash - –º–∞—Å—Å–∏–≤ –∏–∑ 8 –≤–µ—Ä—Ö–Ω–∏—Ö –±–∏—Ç–æ–≤ —Ö—ç—à–µ–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –∫–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ –ø–æ 8 –ø–∞—Ä –Ω–∞ –±–∞–∫–µ—Ç)
- overflow pointer - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–∞–∫–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏

## –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–î–∞–Ω–Ω—ã–µ –≤ map –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. **–•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –∫–ª—é—á–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏—è
2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–∫–µ—Ç–∞**: –ú–ª–∞–¥—à–∏–µ –±–∏—Ç—ã —Ö—ç—à–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –Ω–æ–º–µ—Ä –±–∞–∫–µ—Ç–∞
3. **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫**: –í –±–∞–∫–µ—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è tophash –∑–Ω–∞—á–µ–Ω–∏—è
4. **–¢–æ—á–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ**: –ü—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ tophash —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è —Å–∞–º–∏ –∫–ª—é—á–∏

## –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–æ—Å—Ç–∞

Map —Ä–∞—Å—Ç–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ –º–µ—Ä–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤:

- **–£—Å–ª–æ–≤–∏–µ —Ä–æ—Å—Ç–∞**: –ö–æ–≥–¥–∞ —Å—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 6.5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –±–∞–∫–µ—Ç
- **–ü—Ä–æ—Ü–µ—Å—Å —Ä–æ—Å—Ç–∞**: –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ
- **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**: –≠–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å**: –ó–∞ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –æ–¥–∏–Ω –±–∞–∫–µ—Ç

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏**: –ö–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ –±–∞–∫–µ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫**: tophash –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –æ—Ç—Å–µ—á—å –Ω–µ—Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –∫–ª—é—á–∏
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö map**: –î–ª—è map –¥–æ 8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏** - —ç–ª–µ–º–µ–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
2. **–ù—É–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** - –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è map —Ä–∞–≤–Ω–∞ nil
3. **–ù–µ—Å—Ä–∞–≤–Ω–∏–º–æ—Å—Ç—å** - map –Ω–µ–ª—å–∑—è —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º ==
4. **–ù–µ–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π

- –í—Å—Ç–∞–≤–∫–∞: O(1) –≤ —Å—Ä–µ–¥–Ω–µ–º —Å–ª—É—á–∞–µ
- –ü–æ–∏—Å–∫: O(1) –≤ —Å—Ä–µ–¥–Ω–µ–º —Å–ª—É—á–∞–µ  
- –£–¥–∞–ª–µ–Ω–∏–µ: O(1) –≤ —Å—Ä–µ–¥–Ω–µ–º —Å–ª—É—á–∞–µ
- –ò—Ç–µ—Ä–∞—Ü–∏—è: O(n) –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

- **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–≤–∞–π—Ç–µ map —Å –Ω—É–∂–Ω–æ–π –µ–º–∫–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ make(map[K]V, capacity)
- **–ò–∑–±–µ–≥–∞–π—Ç–µ —á–∞—Å—Ç–æ–≥–æ —Ä–æ—Å—Ç–∞**: –ö–∞–∂–¥—ã–π —Ä–æ—Å—Ç —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –ø–µ—Ä–µ—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π**: –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

Map –≤ Go –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ç—â–∞—Ç–µ–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—É, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, —Å–æ—á–µ—Ç–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ —Å –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –¥–∞–Ω–Ω—ã–º.
# 5 - –≠–≤–∞–∫—É–∞—Ü–∏—è –≤ map Go

**–≠–≤–∞–∫—É–∞—Ü–∏—è** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Å—Ç–∞—Ä—ã—Ö –±–∞–∫–µ—Ç–æ–≤ –≤ –Ω–æ–≤—ã–µ –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ map.

## –ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —ç–≤–∞–∫—É–∞—Ü–∏—è

–≠–≤–∞–∫—É–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ –Ω–∞–≥—Ä—É–∑–∫–∏:
- **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–∞–≥—Ä—É–∑–∫–∏** = 6.5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –±–∞–∫–µ—Ç –≤ —Å—Ä–µ–¥–Ω–µ–º
- **–§–æ—Ä–º—É–ª–∞**: `count > 6.5 * 2^B`

## –ü—Ä–æ—Ü–µ—Å—Å —ç–≤–∞–∫—É–∞—Ü–∏–∏

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
```go
// –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –±–∞–∫–µ—Ç—ã –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ
newBuckets = makeBuckets(1 << (h.B + 1))
h.oldbuckets = h.buckets  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –±–∞–∫–µ—Ç—ã
h.buckets = newBuckets    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –Ω–æ–≤—ã–µ
h.B++                     // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Ä–∞–∑–º–µ—Ä–∞
```

### 2. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
–≠–≤–∞–∫—É–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ —Å—Ä–∞–∑—É, –∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å map:

```go
func mapassign(t *maptype, h *hmap, key unsafe.Pointer) unsafe.Pointer {
    // –ï—Å–ª–∏ map –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–æ—Å—Ç–∞, —ç–≤–∞–∫—É–∏—Ä—É–µ–º –æ–¥–∏–Ω –±–∞–∫–µ—Ç
    if h.growing() {
        growWork(t, h, bucket)
    }
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—Å—Ç–∞–≤–∫–∏
}
```

### 3. –ú–µ—Ö–∞–Ω–∏–∑–º growWork
```go
func growWork(t *maptype, h *hmap, bucket uintptr) {
    // –≠–≤–∞–∫—É–∏—Ä—É–µ–º –±–∞–∫–µ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–µ–∫—É—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
    evacuate(t, h, bucket&h.oldbucketmask())
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —ç–≤–∞–∫—É–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –±–∞–∫–µ—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏
    if h.growing() {
        evacuate(t, h, h.nevacuate)
    }
}
```

## –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ evacuate

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
–ü—Ä–∏ —ç–≤–∞–∫—É–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –≤ –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö –Ω–æ–≤—ã—Ö –±–∞–∫–µ—Ç–æ–≤:

```
–°—Ç–∞—Ä—ã–π –±–∞–∫–µ—Ç X –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –¥–≤–∞ –Ω–æ–≤—ã—Ö:
- –ù–æ–≤—ã–π –±–∞–∫–µ—Ç X (—Ç–µ –∂–µ –º–ª–∞–¥—à–∏–µ –±–∏—Ç—ã)
- –ù–æ–≤—ã–π –±–∞–∫–µ—Ç X + oldSize (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ä—à–∏–π –±–∏—Ç)
```

### –ü—Ä–∏–º–µ—Ä –¥–ª—è B=2 ‚Üí B=3
```
–°—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞: 4 –±–∞–∫–µ—Ç–∞ (B=2)
–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: 8 –±–∞–∫–µ—Ç–æ–≤ (B=3)

–°—Ç–∞—Ä—ã–π –±–∞–∫–µ—Ç 1 (01) –¥–µ–ª–∏—Ç—Å—è –Ω–∞:
- –ù–æ–≤—ã–π –±–∞–∫–µ—Ç 1 (001) - –µ—Å–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–∏—Ç = 0
- –ù–æ–≤—ã–π –±–∞–∫–µ—Ç 5 (101) - –µ—Å–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–∏—Ç = 1
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
```go
func evacuate(t *maptype, h *hmap, oldbucket uintptr) {
    b := (*bmap)(add(h.oldbuckets, oldbucket*uintptr(t.bucketsize)))
    
    // –°–æ–∑–¥–∞–µ–º –¥–≤–∞ —Ü–µ–ª–µ–≤—ã—Ö –±–∞–∫–µ—Ç–∞ –≤ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ
    var newBuckets [2]uintptr
    newBuckets[0] = newBucketBase
    newBuckets[1] = newBucketBase + oldBucketCount
    
    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç
    for ; b != nil; b = b.overflow(t) {
        for i := 0; i < bucketCnt; i++ {
            if b.tophash[i] == empty {
                continue
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—ã–π –±–∞–∫–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –±–∏—Ç–∞ —Ö—ç—à–∞
            hash := keyHash(b.keys[i])
            newBucketIndex := (hash >> h.B) & 1  // 0 –∏–ª–∏ 1
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –Ω–æ–≤—ã–π –±–∞–∫–µ—Ç
            dst := newBuckets[newBucketIndex]
            // ... –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ –∏ –∑–Ω–∞—á–µ–Ω–∏—è
        }
    }
    
    // –ü–æ–º–µ—á–∞–µ–º —Å—Ç–∞—Ä—ã–π –±–∞–∫–µ—Ç –∫–∞–∫ —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
    h.nevacuate++
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å**
- –≠–≤–∞–∫—É–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
- –ó–∞ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è 1-2 –±–∞–∫–µ—Ç–∞
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å map –Ω–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

### 2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- –û–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è —ç–≤–∞–∫—É–∞—Ü–∏–∏
- –ü–æ–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è (—Å—Ç–∞—Ä–æ–µ –∏ –Ω–æ–≤–æ–µ)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

### 3. **–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ—Å—Ç–∞**
–ö–æ–≥–¥–∞ –≤—Å–µ –±–∞–∫–µ—Ç—ã —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω—ã:
```go
h.oldbuckets = nil  // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å—Ç–∞—Ä—É—é –ø–∞–º—è—Ç—å
h.flags &^= sameSizeGrow
```

## –ü—Ä–∏–º–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ª–∏–Ω–∏–∏ —ç–≤–∞–∫—É–∞—Ü–∏–∏

```
–í—Ä–µ–º—è | –°–æ–±—ã—Ç–∏–µ
------|--------
T0    | Map –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ø–æ—Ä–æ–≥–∞ —Ä–æ—Å—Ç–∞
T0    | –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –±–∞–∫–µ—Ç—ã, oldbuckets = —Ç–µ–∫—É—â–∏–µ
T1    | –û–ø–µ—Ä–∞—Ü–∏—è #1: —ç–≤–∞–∫—É–∏—Ä—É–µ—Ç –±–∞–∫–µ—Ç 0
T2    | –û–ø–µ—Ä–∞—Ü–∏—è #2: —ç–≤–∞–∫—É–∏—Ä—É–µ—Ç –±–∞–∫–µ—Ç 1
T3    | –û–ø–µ—Ä–∞—Ü–∏—è #3: —ç–≤–∞–∫—É–∏—Ä—É–µ—Ç –±–∞–∫–µ—Ç 2
...   | ...
Tn    | –í—Å–µ –±–∞–∫–µ—Ç—ã —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω—ã, oldbuckets = nil
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑–∫–∏—Ö –ø–∞—É–∑** - –Ω–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç** - —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ –º–Ω–æ–≥–∏–º –æ–ø–µ—Ä–∞—Ü–∏—è–º
3. **–ü—Ä–æ–¥–æ–ª–∂–∞—é—â–∞—è—Å—è —Ä–∞–±–æ—Ç–∞** - map –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ–π –≤–æ –≤—Ä–µ–º—è —Ä–æ—Å—Ç–∞

–≠–≤–∞–∫—É–∞—Ü–∏—è –¥–µ–ª–∞–µ—Ç —Ä–æ—Å—Ç map –≤ Go —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏ –Ω–µ–∑–∞–º–µ—Ç–Ω—ã–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å—Ç–∞–±–∏–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∞–∂–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞.
# 6 - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã/–ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

–í Go –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –¥–≤—É–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

```go
// –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
type iface struct {
    tab  *itab          // —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç–æ–¥–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ
    data unsafe.Pointer // —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
}

type itab struct {
    inter *interfacetype // –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
    _type *_type         // –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ç–∏–ø–µ
    hash  uint32         // –∫–æ–ø–∏—è —Ö—ç—à–∞ —Ç–∏–ø–∞
    _     [4]byte
    fun   [1]uintptr     // –º–∞—Å—Å–∏–≤ –º–µ—Ç–æ–¥–æ–≤ (–≥–∏–±–∫–∏–π)
}
```

### –ü—É—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```go
type eface struct {
    _type *_type         // –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ
    data  unsafe.Pointer // —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

### 1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```go
package main

import (
    "fmt"
    "math"
)

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
type Shape interface {
    Area() float64
    Perimeter() float64
}

// –†–µ–∞–ª–∏–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
type Circle struct {
    Radius float64
}

func (c Circle) Area() float64 {
    return math.Pi * c.Radius * c.Radius
}

func (c Circle) Perimeter() float64 {
    return 2 * math.Pi * c.Radius
}

type Rectangle struct {
    Width, Height float64
}

func (r Rectangle) Area() float64 {
    return r.Width * r.Height
}

func (r Rectangle) Perimeter() float64 {
    return 2 * (r.Width + r.Height)
}

// –§—É–Ω–∫—Ü–∏—è, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
func PrintShapeInfo(s Shape) {
    fmt.Printf("Area: %.2f, Perimeter: %.2f\n", s.Area(), s.Perimeter())
}

func main() {
    circle := Circle{Radius: 5}
    rectangle := Rectangle{Width: 10, Height: 5}
    
    PrintShapeInfo(circle)     // Area: 78.54, Perimeter: 31.42
    PrintShapeInfo(rectangle)  // Area: 50.00, Perimeter: 30.00
    
    // –°–ª–∞–π—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
    shapes := []Shape{circle, rectangle}
    for _, shape := range shapes {
        PrintShapeInfo(shape)
    }
}
```

### 2. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ

```go
package main

import (
    "fmt"
    "io"
    "os"
    "strings"
)

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
func processReader(r io.Reader) {
    data := make([]byte, 100)
    n, err := r.Read(data)
    if err != nil && err != io.EOF {
        panic(err)
    }
    fmt.Printf("Read %d bytes: %s\n", n, string(data[:n]))
}

func main() {
    // –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–µ io.Reader
    stringReader := strings.NewReader("Hello from string reader")
    file, _ := os.Open("example.txt") // –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    defer file.Close()
    
    processReader(stringReader)
    processReader(file)
    
    // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bytes.Buffer, os.Stdin –∏ –¥—Ä.
}
```

### 3. –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

```go
package main

import "fmt"

// –ë–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
type Reader interface {
    Read() string
}

type Writer interface {
    Write(string)
}

// –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
type ReadWriter interface {
    Reader
    Writer
}

// –¢–∏–ø, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
type Console struct {
    buffer string
}

func (c *Console) Read() string {
    return c.buffer
}

func (c *Console) Write(s string) {
    c.buffer = s
    fmt.Println("Written to console:", s)
}

func Process(rw ReadWriter) {
    rw.Write("Hello World")
    fmt.Println("Read back:", rw.Read())
}

func main() {
    console := &Console{}
    Process(console)
}
```

### 4. Type assertions –∏ type switches

```go
package main

import "fmt"

func describe(i interface{}) {
    // Type switch
    switch v := i.(type) {
    case int:
        fmt.Printf("Integer: %d\n", v)
    case string:
        fmt.Printf("String: %s\n", v)
    case bool:
        fmt.Printf("Boolean: %t\n", v)
    default:
        fmt.Printf("Unknown type: %T\n", v)
    }
}

func main() {
    var i interface{}
    
    i = 42
    describe(i)
    
    // Type assertion
    if value, ok := i.(int); ok {
        fmt.Printf("Successfully asserted as int: %d\n", value)
    }
    
    i = "hello"
    describe(i)
    
    i = true
    describe(i)
}
```

### 5. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```go
package main

import (
    "fmt"
    "time"
)

// Cache –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
type Cache interface {
    Get(key string) (interface{}, bool)
    Set(key string, value interface{})
    Delete(key string)
}

// InMemoryCache —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
type InMemoryCache struct {
    data map[string]interface{}
}

func NewInMemoryCache() *InMemoryCache {
    return &InMemoryCache{
        data: make(map[string]interface{}),
    }
}

func (c *InMemoryCache) Get(key string) (interface{}, bool) {
    value, exists := c.data[key]
    return value, exists
}

func (c *InMemoryCache) Set(key string, value interface{}) {
    c.data[key] = value
}

func (c *InMemoryCache) Delete(key string) {
    delete(c.data, key)
}

// TTLCache —Å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
type TTLCache struct {
    InMemoryCache
    ttl    time.Duration
    timers map[string]*time.Timer
}

func NewTTLCache(ttl time.Duration) *TTLCache {
    return &TTLCache{
        InMemoryCache: *NewInMemoryCache(),
        ttl:           ttl,
        timers:        make(map[string]*time.Timer),
    }
}

func (c *TTLCache) Set(key string, value interface{}) {
    c.InMemoryCache.Set(key, value)
    
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
    if timer, exists := c.timers[key]; exists {
        timer.Stop()
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
    c.timers[key] = time.AfterFunc(c.ttl, func() {
        c.Delete(key)
    })
}

func (c *TTLCache) Delete(key string) {
    c.InMemoryCache.Delete(key)
    if timer, exists := c.timers[key]; exists {
        timer.Stop()
        delete(c.timers, key)
    }
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—â–∞—è —Å –ª—é–±—ã–º –∫—ç—à–µ–º
func UseCache(cache Cache) {
    cache.Set("user:1", "John Doe")
    
    if value, exists := cache.Get("user:1"); exists {
        fmt.Println("Found:", value)
    }
    
    cache.Delete("user:1")
}

func main() {
    memoryCache := NewInMemoryCache()
    ttlCache := NewTTLCache(5 * time.Minute)
    
    UseCache(memoryCache)
    UseCache(ttlCache)
}
```

### 6. Mock-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏

```go
package main

import "fmt"

// Database –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î
type Database interface {
    GetUser(id int) (string, error)
    SaveUser(id int, name string) error
}

// RealDatabase - —Ä–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
type RealDatabase struct{}

func (db *RealDatabase) GetUser(id int) (string, error) {
    // –†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î
    return "Real User", nil
}

func (db *RealDatabase) SaveUser(id int, name string) error {
    // –†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    return nil
}

// MockDatabase –¥–ª—è —Ç–µ—Å—Ç–æ–≤
type MockDatabase struct {
    users map[int]string
}

func NewMockDatabase() *MockDatabase {
    return &MockDatabase{
        users: make(map[int]string),
    }
}

func (db *MockDatabase) GetUser(id int) (string, error) {
    if user, exists := db.users[id]; exists {
        return user, nil
    }
    return "", fmt.Errorf("user not found")
}

func (db *MockDatabase) SaveUser(id int, name string) error {
    db.users[id] = name
    return nil
}

// UserService –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
type UserService struct {
    db Database
}

func NewUserService(db Database) *UserService {
    return &UserService{db: db}
}

func (s *UserService) CreateUser(id int, name string) error {
    return s.db.SaveUser(id, name)
}

func (s *UserService) GetUserName(id int) (string, error) {
    return s.db.GetUser(id)
}

func main() {
    // –í production –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—É—é –ë–î
    realDB := &RealDatabase{}
    userService := NewUserService(realDB)
    
    // –í —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º mock
    mockDB := NewMockDatabase()
    testService := NewUserService(mockDB)
    
    _ = userService
    _ = testService
}
```

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

1. **–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º**: –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å mock-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–ì–∏–±–∫–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞
4. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–º–∏** (–ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- **–ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**
- **–ò–∑–±–µ–≥–∞–π—Ç–µ –ø—É—Å—Ç—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ**

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ Go –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –º–æ—â–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–∏–±–∫–æ–≥–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –∫–æ–¥–∞, –ø–æ–∑–≤–æ–ª—è—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
# 7 - –ì–æ—Ä—É—Ç–∏–Ω—ã
# 8 - i/o bound operations

## –ß—Ç–æ —Ç–∞–∫–æ–µ I/O Bound Operations?

**I/O Bound Operations** - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ—Ç–æ—Ä—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å—é –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞, –∞ –Ω–µ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç—å—é CPU. –¢–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–æ–¥—è—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π.

### –ü—Ä–∏–º–µ—Ä—ã I/O Bound –æ–ø–µ—Ä–∞—Ü–∏–π:
- –°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (HTTP, gRPC, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
- –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
- Web scraping

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ I/O Bound –æ–ø–µ—Ä–∞—Ü–∏–π –≤ Go

### –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ vs –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```go
package main

import (
    "fmt"
    "io"
    "net/http"
    "time"
)

// –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O (–ø–ª–æ—Ö–æ–π –ø–æ–¥—Ö–æ–¥)
func blockingIO() {
    start := time.Now()
    
    // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
    response1, _ := http.Get("https://api.example.com/data1")
    defer response1.Body.Close()
    
    response2, _ := http.Get("https://api.example.com/data2") 
    defer response2.Body.Close()
    
    response3, _ := http.Get("https://api.example.com/data3")
    defer response3.Body.Close()
    
    fmt.Printf("Blocking IO took: %v\n", time.Since(start))
}

// –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O —Å –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ (—Ö–æ—Ä–æ—à–∏–π –ø–æ–¥—Ö–æ–¥)
func nonBlockingIO() {
    start := time.Now()
    var wg sync.WaitGroup
    
    urls := []string{
        "https://api.example.com/data1",
        "https://api.example.com/data2",
        "https://api.example.com/data3",
    }
    
    for _, url := range urls {
        wg.Add(1)
        go func(u string) {
            defer wg.Done()
            response, _ := http.Get(u)
            if response != nil {
                response.Body.Close()
            }
        }(url)
    }
    
    wg.Wait()
    fmt.Printf("Non-blocking IO took: %v\n", time.Since(start))
}
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å I/O Bound –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

### 1. Worker Pool –¥–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π

```go
package main

import (
    "fmt"
    "io"
    "net/http"
    "sync"
)

type Job struct {
    URL string
}

type Result struct {
    URL  string
    Size int64
    Err  error
}

func worker(id int, jobs <-chan Job, results chan<- Result, wg *sync.WaitGroup) {
    defer wg.Done()
    
    client := &http.Client{
        Timeout: 10 * time.Second,
    }
    
    for job := range jobs {
        fmt.Printf("Worker %d processing %s\n", id, job.URL)
        
        resp, err := client.Get(job.URL)
        if err != nil {
            results <- Result{URL: job.URL, Err: err}
            continue
        }
        
        size, err := io.Copy(io.Discard, resp.Body)
        resp.Body.Close()
        
        results <- Result{
            URL:  job.URL,
            Size: size,
            Err:  err,
        }
    }
}

func main() {
    urls := []string{
        "https://httpbin.org/json",
        "https://httpbin.org/xml", 
        "https://httpbin.org/html",
        "https://httpbin.org/bytes/1024",
        "https://httpbin.org/bytes/2048",
    }
    
    const numWorkers = 3
    jobs := make(chan Job, len(urls))
    results := make(chan Result, len(urls))
    
    var wg sync.WaitGroup
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º workers
    for i := 1; i <= numWorkers; i++ {
        wg.Add(1)
        go worker(i, jobs, results, &wg)
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º jobs
    for _, url := range urls {
        jobs <- Job{URL: url}
    }
    close(jobs)
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º results –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö workers
    go func() {
        wg.Wait()
        close(results)
    }()
    
    // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for result := range results {
        if result.Err != nil {
            fmt.Printf("Error fetching %s: %v\n", result.URL, result.Err)
        } else {
            fmt.Printf("Fetched %s: %d bytes\n", result.URL, result.Size)
        }
    }
}
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π

```go
package main

import (
    "context"
    "fmt"
    "golang.org/x/sync/semaphore"
    "net/http"
    "sync"
    "time"
)

func rateLimitedIO() {
    var (
        sem    = semaphore.NewWeighted(5) // –ú–∞–∫—Å–∏–º—É–º 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        client = &http.Client{Timeout: 10 * time.Second}
        wg     sync.WaitGroup
        mu     sync.Mutex
        results []string
    )
    
    urls := make([]string, 20)
    for i := range urls {
        urls[i] = fmt.Sprintf("https://httpbin.org/delay/%d", i%3+1)
    }
    
    ctx := context.Background()
    
    for _, url := range urls {
        wg.Add(1)
        go func(u string) {
            defer wg.Done()
            
            // Acquire semaphore
            if err := sem.Acquire(ctx, 1); err != nil {
                fmt.Printf("Failed to acquire semaphore: %v\n", err)
                return
            }
            defer sem.Release(1)
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º HTTP –∑–∞–ø—Ä–æ—Å
            resp, err := client.Get(u)
            if err != nil {
                fmt.Printf("Error fetching %s: %v\n", u, err)
                return
            }
            defer resp.Body.Close()
            
            mu.Lock()
            results = append(results, fmt.Sprintf("Completed: %s", u))
            mu.Unlock()
        }(url)
    }
    
    wg.Wait()
    fmt.Printf("Completed %d requests\n", len(results))
}
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ context –¥–ª—è –æ—Ç–º–µ–Ω—ã I/O –æ–ø–µ—Ä–∞—Ü–∏–π

```go
package main

import (
    "context"
    "fmt"
    "io"
    "net/http"
    "time"
)

func fetchWithTimeout(url string, timeout time.Duration) (string, error) {
    ctx, cancel := context.WithTimeout(context.Background(), timeout)
    defer cancel()
    
    req, err := http.NewRequestWithContext(ctx, "GET", url, nil)
    if err != nil {
        return "", err
    }
    
    client := http.DefaultClient
    resp, err := client.Do(req)
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()
    
    body, err := io.ReadAll(resp.Body)
    if err != nil {
        return "", err
    }
    
    return string(body), nil
}

func main() {
    url := "https://httpbin.org/delay/3" // –°–µ—Ä–≤–µ—Ä –∂–¥–µ—Ç 3 —Å–µ–∫—É–Ω–¥—ã
    
    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º 2 —Å–µ–∫—É–Ω–¥—ã
    start := time.Now()
    data, err := fetchWithTimeout(url, 2*time.Second)
    
    if err != nil {
        fmt.Printf("Request failed after %v: %v\n", time.Since(start), err)
    } else {
        fmt.Printf("Request succeeded: %d bytes\n", len(data))
    }
}
```

### 4. Pipeline –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ I/O –¥–∞–Ω–Ω—ã—Ö

```go
package main

import (
    "fmt"
    "io"
    "net/http"
    "strings"
    "sync"
)

func processURLs(urls []string) {
    // Stage 1: –ó–∞–≥—Ä—É–∑–∫–∞
    download := func(urls []string) <-chan string {
        out := make(chan string)
        go func() {
            defer close(out)
            client := http.Client{Timeout: 10 * time.Second}
            for _, url := range urls {
                resp, err := client.Get(url)
                if err != nil {
                    continue
                }
                body, _ := io.ReadAll(resp.Body)
                resp.Body.Close()
                out <- string(body)
            }
        }()
        return out
    }
    
    // Stage 2: –û–±—Ä–∞–±–æ—Ç–∫–∞
    process := func(in <-chan string) <-chan int {
        out := make(chan int)
        go func() {
            defer close(out)
            for data := range in {
                // –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏: –ø–æ–¥—Å—á–µ—Ç —Å–ª–æ–≤
                words := len(strings.Fields(data))
                out <- words
            }
        }()
        return out
    }
    
    // Stage 3: –ê–≥—Ä–µ–≥–∞—Ü–∏—è
    aggregate := func(in <-chan int) int {
        total := 0
        for count := range in {
            total += count
        }
        return total
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º pipeline
    downloaded := download(urls)
    processed := process(downloaded)
    result := aggregate(processed)
    
    fmt.Printf("Total words: %d\n", result)
}
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è I/O Bound –æ–ø–µ—Ä–∞—Ü–∏–π

### 1. Connection Pooling

```go
package main

import (
    "database/sql"
    "fmt"
    _ "github.com/lib/pq"
    "time"
)

func setupConnectionPool() *sql.DB {
    db, err := sql.Open("postgres", "user=postgres dbname=test sslmode=disable")
    if err != nil {
        panic(err)
    }
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ connection pool
    db.SetMaxOpenConns(25)       // –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    db.SetMaxIdleConns(25)       // –ú–∞–∫—Å–∏–º—É–º idle —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π  
    db.SetConnMaxLifetime(5 * time.Minute) // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    
    return db
}

func concurrentDBQueries(db *sql.DB) {
    var wg sync.WaitGroup
    queries := []string{
        "SELECT * FROM users WHERE active = true",
        "SELECT COUNT(*) FROM orders",
        "SELECT * FROM products WHERE price > 100",
    }
    
    for i, query := range queries {
        wg.Add(1)
        go func(q string, id int) {
            defer wg.Done()
            
            start := time.Now()
            rows, err := db.Query(q)
            if err != nil {
                fmt.Printf("Query %d failed: %v\n", id, err)
                return
            }
            defer rows.Close()
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...
            fmt.Printf("Query %d completed in %v\n", id, time.Since(start))
        }(query, i)
    }
    
    wg.Wait()
}
```

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ I/O –æ–ø–µ—Ä–∞—Ü–∏–π

```go
package main

import (
    "sync"
    "time"
)

type Cache struct {
    mu    sync.RWMutex
    data  map[string]cacheEntry
}

type cacheEntry struct {
    value      interface{}
    expiration time.Time
}

func NewCache(cleanupInterval time.Duration) *Cache {
    cache := &Cache{
        data: make(map[string]cacheEntry),
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
    go cache.cleanup(cleanupInterval)
    return cache
}

func (c *Cache) Set(key string, value interface{}, ttl time.Duration) {
    c.mu.Lock()
    defer c.mu.Unlock()
    
    c.data[key] = cacheEntry{
        value:      value,
        expiration: time.Now().Add(ttl),
    }
}

func (c *Cache) Get(key string) (interface{}, bool) {
    c.mu.RLock()
    defer c.mu.RUnlock()
    
    entry, exists := c.data[key]
    if !exists || time.Now().After(entry.expiration) {
        return nil, false
    }
    
    return entry.value, true
}

func (c *Cache) cleanup(interval time.Duration) {
    ticker := time.NewTicker(interval)
    defer ticker.Stop()
    
    for range ticker.C {
        c.mu.Lock()
        now := time.Now()
        for key, entry := range c.data {
            if now.After(entry.expiration) {
                delete(c.data, key)
            }
        }
        c.mu.Unlock()
    }
}
```

### 3. Bulk Operations –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è I/O

```go
package main

import (
    "fmt"
    "time"
)

// –í–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ - –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π
func bulkDatabaseOperations(records []Record) error {
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ batch insert
    const batchSize = 100
    var batches [][]Record
    
    for batchSize < len(records) {
        records, batches = records[batchSize:], append(batches, records[0:batchSize:batchSize])
    }
    batches = append(batches, records)
    
    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ batch –æ–ø–µ—Ä–∞—Ü–∏–π
    for i, batch := range batches {
        if err := insertBatch(batch); err != nil {
            return fmt.Errorf("batch %d failed: %w", i, err)
        }
    }
    
    return nil
}

func insertBatch(records []Record) error {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è batch insert
    time.Sleep(10 * time.Millisecond) // –ò–º–∏—Ç–∞—Ü–∏—è I/O
    return nil
}

type Record struct {
    ID   int
    Data string
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–π

```go
package main

import (
    "fmt"
    "net/http"
    _ "net/http/pprof"
    "runtime"
    "time"
)

func monitorIOBoundApp() {
    // –ó–∞–ø—É—Å–∫–∞–µ–º pprof —Å–µ—Ä–≤–µ—Ä
    go func() {
        http.ListenAndServe(":6060", nil)
    }()
    
    // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥–æ—Ä—É—Ç–∏–Ω
    go func() {
        for {
            time.Sleep(5 * time.Second)
            fmt.Printf("Goroutines: %d\n", runtime.NumGoroutine())
        }
    }()
}
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è I/O Bound –æ–ø–µ—Ä–∞—Ü–∏–π

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –Ω–µ –±–ª–æ–∫–∏—Ä—É–π—Ç–µ –≥–ª–∞–≤–Ω—ã–µ –≥–æ—Ä—É—Ç–∏–Ω—ã
2. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ semaphore –∏–ª–∏ worker pools
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã** - –≤—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ä–∞–∑—É–º–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
4. **–ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - —É–º–µ–Ω—å—à–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ connection pooling** - –¥–ª—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
6. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏** - I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –æ—à–∏–±–∫–∞–º–∏
7. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ pprof –∏ –º–µ—Ç—Ä–∏–∫–∏

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å I/O Bound –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Go. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –∏ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ –∏–∑–ª–∏—à–Ω–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É.
# 9 - cpu bound operations

## –ß—Ç–æ —Ç–∞–∫–æ–µ CPU Bound Operations?

CPU Bound Operations (–æ–ø–µ—Ä–∞—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞) ‚Äî —ç—Ç–æ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã CPU. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç I/O Bound –æ–ø–µ—Ä–∞—Ü–∏–π, –æ–Ω–∏ –ø—Ä–æ–≤–æ–¥—è—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö, –∞ –Ω–µ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.

## –ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ CPU Bound –æ–ø–µ—Ä–∞—Ü–∏–π:

- –í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è I/O
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞–∫—Ç–æ–≤–æ–π —á–∞—Å—Ç–æ—Ç—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–¥–µ—Ä
- –ü—Ä–∏–º–µ—Ä—ã: –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å CPU Bound –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –≤ Go

### –ü—Ä–æ–±–ª–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ Go

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è I/O Bound –æ–ø–µ—Ä–∞—Ü–∏–π. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å CPU Bound –∑–∞–¥–∞—á–∞–º–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ß—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥–æ—Ä—É—Ç–∏–Ω –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤—Ä–µ–º—è
2. **–õ–æ–∂–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫—ç—à–∞ (False Sharing)** - –Ω–µ—Å–∫–æ–ª—å–∫–æ —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç—å—é –ø–∞–º—è—Ç–∏
3. **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≥–æ—Ä—É—Ç–∏–Ω –º–æ–∂–µ—Ç —Å—ä–µ–¥–∞—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

### –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω

–î–ª—è CPU Bound –∑–∞–¥–∞—á –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö CPU —è–¥–µ—Ä:

```go
numGoroutines := runtime.NumCPU()
```

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. Worker Pool —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤, –≥–¥–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:

```go
func worker(id int, jobs <-chan Task, results chan<- Result) {
    for task := range jobs {
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ CPU –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏
        result := processTask(task)
        results <- result
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞
numWorkers := runtime.NumCPU()
for i := 0; i < numWorkers; i++ {
    go worker(i, jobs, results)
}
```

### 2. –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ—Ç–æ–∫–∞–º –û–°

–î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö CPU Bound –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–≤—è–∑–∫—É –∫ –ø–æ—Ç–æ–∫–∞–º –û–°:

```go
func criticalCPUWork() {
    runtime.LockOSThread()
    defer runtime.UnlockOSThread()
    
    // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è CPU Bound –∑–∞–¥–∞—á–∞
    performIntensiveComputation()
}
```

### 3. –ë–ª–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∞–º–∏ –¥–ª—è –ª—É—á—à–µ–π –∫—ç—à-–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏:

```go
func processDataBlock(data []float64, start, end int) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    for i := start; i < end; i++ {
        data[i] = expensiveComputation(data[i])
    }
}
```

## –¢–µ—Ö–Ω–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É–ª—ã –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:

```go
var matrixPool = sync.Pool{
    New: func() interface{} {
        return make([][]float64, 1000)
    },
}

func getMatrix() [][]float64 {
    return matrixPool.Get().([][]float64)
}

func putMatrix(m [][]float64) {
    matrixPool.Put(m)
}
```

### 2. –ö—ç—à-–¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

–û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:

```go
// –ü–ª–æ—Ö–æ: —Å–ª—É—á–∞–π–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
for i := 0; i < size; i++ {
    for j := 0; j < size; j++ {
        result[j][i] = matrix[i][j] // –ü–ª–æ—Ö–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
    }
}

// –•–æ—Ä–æ—à–æ: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
for i := 0; i < size; i++ {
    for j := 0; j < size; j++ {
        result[i][j] = matrix[i][j] // –•–æ—Ä–æ—à–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
    }
}
```

### 3. –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

```go
func processBatch(data []float64) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –æ–¥–Ω–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
    for i := 0; i < len(data); i += 4 {
        processFourElements(data[i:])
    }
}
```

### 4. –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏ –º–µ–º–æ–∏–∑–∞—Ü–∏—è

–ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π:

```go
var computationCache sync.Map

func expensiveComputation(input int) int {
    if val, ok := computationCache.Load(input); ok {
        return val.(int)
    }
    
    // –î–æ—Ä–æ–≥–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
    result := compute(input)
    computationCache.Store(input, result)
    return result
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CPU

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è:

```go
func startCPUProfile() {
    f, _ := os.Create("cpu.prof")
    pprof.StartCPUProfile(f)
    defer pprof.StopCPUProfile()
    
    performCPUIntensiveWork()
}
```

### –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥–æ—Ä—É—Ç–∏–Ω

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≥–æ—Ä—É—Ç–∏–Ω –≤ —Å–∏—Å—Ç–µ–º–µ:

```go
func monitorGoroutines() {
    for {
        count := runtime.NumGoroutine()
        if count > 1000 {
            log.Printf("Warning: high goroutine count: %d", count)
        }
        time.Sleep(10 * time.Second)
    }
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ò–∑–±–µ–≥–∞–π—Ç–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

–ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–æ–ª—å—à–µ –≥–æ—Ä—É—Ç–∏–Ω, —á–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU —è–¥–µ—Ä –¥–ª—è CPU Bound –∑–∞–¥–∞—á:

```go
// –ü–ª–æ—Ö–æ
for i := 0; i < 1000; i++ {
    go cpuIntensiveTask() // –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –¥–ª—è CPU Bound
}

// –•–æ—Ä–æ—à–æ
numCPU := runtime.NumCPU()
for i := 0; i < numCPU; i++ {
    go cpuIntensiveTask()
}
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ appropriate granularity

–í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–¥–∞—á –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º:

```go
// –°–ª–∏—à–∫–æ–º –º–µ–ª–∫–∏–µ –∑–∞–¥–∞—á–∏ - –±–æ–ª—å—à–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
func processTinyChunks() {
    for i := 0; i < 1000000; i++ {
        go processSingleItem(data[i]) // –°–ª–∏—à–∫–æ–º –º–µ–ª–∫–æ
    }
}

// –°–ª–∏—à–∫–æ–º –∫—Ä—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏ - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º
func processHugeChunk() {
    go processAllData(data) // –°–ª–∏—à–∫–æ–º –∫—Ä—É–ø–Ω–æ
}

// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
func processOptimalChunks() {
    chunkSize := len(data) / runtime.NumCPU()
    for i := 0; i < len(data); i += chunkSize {
        go processChunk(data[i:i+chunkSize])
    }
}
```

### 3. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

–£–º–µ–Ω—å—à–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–æ–≤ –≤ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç—è—Ö:

```go
// –ü–ª–æ—Ö–æ: —á–∞—Å—Ç—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
var mu sync.Mutex
func processWithLock() {
    mu.Lock()
    defer mu.Unlock()
    // –†–∞–±–æ—Ç–∞ —Å shared data
}

// –•–æ—Ä–æ—à–æ: —É–º–µ–Ω—å—à–µ–Ω–∏–µ contention
func processWithChannel() {
    results := make(chan Result)
    go func() {
        results <- computeResult()
    }()
    return <-results
}
```

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω

```go
// –û—à–∏–±–∫–∞: —Å–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –≤ —Ü–∏–∫–ª–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
for item := range items {
    go process(item) // –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç—ã—Å—è—á–∏ –≥–æ—Ä—É—Ç–∏–Ω
}

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ semaphore –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
sem := make(chan struct{}, runtime.NumCPU())
for item := range items {
    sem <- struct{}{}
    go func(i Item) {
        defer func() { <-sem }()
        process(i)
    }(item)
}
```

### 2. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

```go
// –û—à–∏–±–∫–∞: –ø–ª–æ—Ö–∞—è –∫—ç—à-–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
type Data struct {
    values [][]float64
}

func (d *Data) Process() {
    for col := 0; col < cols; col++ {
        for row := 0; row < rows; row++ {
            d.values[row][col] = compute() // –°–ª—É—á–∞–π–Ω—ã–π –¥–æ—Å—Ç—É–ø
        }
    }
}

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
func (d *Data) ProcessOptimized() {
    for row := 0; row < rows; row++ {
        for col := 0; col < cols; col++ {
            d.values[row][col] = compute() // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
        }
    }
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CPU Bound –æ–ø–µ—Ä–∞—Ü–∏–π –≤ Go —Ç—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–∞–∫ —Ä–∞–±–æ—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ Go, —Ç–∞–∫ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤. –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω, —Ä–∞–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É CPU —è–¥–µ—Ä
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ –∏ –∏–∑–º–µ—Ä—è–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë–∞–ª–∞–Ω—Å–∏—Ä—É–π—Ç–µ –º–µ–∂–¥—É –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º –∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏

–ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CPU Bound –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Go –º–æ–≥—É—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.
# 10 - —Å—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã

## –ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã?

**–°—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã** ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–∑–æ–≤–∞—Ö –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø–æ—Ç–æ–∫–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –≥–æ—Ä—É—Ç–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Ä–∞—Å—Ç–∏ –∏ —Å–æ–∫—Ä–∞—â–∞—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–µ–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã

### –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- **2 –ö–ë** ‚Äî –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ –∫–∞–∂–¥–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ, —á–µ–º —É –ø–æ—Ç–æ–∫–æ–≤ –û–° (–æ–±—ã—á–Ω–æ 1-8 –ú–ë)

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- –°—Ç–µ–∫ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ç–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ú–æ–∂–µ—Ç —Å–æ–∫—Ä–∞—â–∞—Ç—å—Å—è –ø—Ä–∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏ –ø–∞–º—è—Ç–∏
- –í—Å—è —Ä–∞–±–æ—Ç–∞ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–∞–º—è—Ç—å—é —Å—Ç–µ–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞

## –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–µ–∫–∞ –≤ –ø–∞–º—è—Ç–∏

```
–°—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã:
+-------------------+  ‚Üê high addresses
|    –∞—Ä–≥—É–º–µ–Ω—Ç—ã      |
|   —Ñ—É–Ω–∫—Ü–∏–∏ main    |
+-------------------+
|  –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ     |
|     –∞–¥—Ä–µ—Å–∞        |
+-------------------+
|  —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ      |
|   —Ä–µ–≥–∏—Å—Ç—Ä—ã        |
+-------------------+
|  –ª–æ–∫–∞–ª—å–Ω—ã–µ        |
|   –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ      |
+-------------------+
|   –∫–∞–¥—Ä—ã –≤—ã–∑–æ–≤–æ–≤   |
|   –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π  |
+-------------------+  ‚Üê low addresses
|   guard page      |
+-------------------+
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–µ–∫–æ–º –≤ —Ä–∞–Ω—Ç–∞–π–º–µ Go

–ö–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ–µ–º —Å—Ç–µ–∫–µ:

```go
type g struct {
    stack       stack   // [lo, hi) - –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç–µ–∫–∞
    stackguard0 uintptr // –∑–∞—â–∏—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
    stackguard1 uintptr // –∑–∞—â–∏—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è C-–∫–æ–¥–∞
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}

type stack struct {
    lo uintptr // –Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞
    hi uintptr // –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞
}
```

## –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–æ—Å—Ç–∞ —Å—Ç–µ–∫–∞

### –ö–æ–≥–¥–∞ —Å—Ç–µ–∫ —Ä–∞—Å—Ç–µ—Ç

–°—Ç–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏:
1. **–ù–µ—Ö–≤–∞—Ç–∫–µ –º–µ—Å—Ç–∞** –¥–ª—è –Ω–æ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
2. **–í—ã–¥–µ–ª–µ–Ω–∏–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤** –≤ —Å—Ç–µ–∫–µ
3. **–ì–ª—É–±–æ–∫–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏**

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–æ—Å—Ç–∞ —Å—Ç–µ–∫–∞

```go
// –ü—Å–µ–≤–¥–æ–∫–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–æ—Å—Ç–∞ —Å—Ç–µ–∫–∞
func growstack(gp *g) {
    // 1. –í—ã—á–∏—Å–ª–∏—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä (–æ–±—ã—á–Ω–æ –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ)
    oldsize := gp.stack.hi - gp.stack.lo
    newsize := oldsize * 2
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    if newsize > maxstacksize {
        throw("stack overflow")
    }
    
    // 3. –í—ã–¥–µ–ª–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ç–µ–∫
    newstack := stackalloc(newsize)
    
    // 4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç–µ–∫–∞ –≤ –Ω–æ–≤—ã–π
    copystack(gp, newstack)
    
    // 5. –û—Å–≤–æ–±–æ–¥–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Å—Ç–µ–∫
    stackfree(gp.stack)
    
    // 6. –û–±–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏ —Å—Ç–µ–∫–∞
    gp.stack = newstack
    gp.stackguard0 = newstack.lo + stackGuard
}
```

### –ü—Ä–∏–º–µ—Ä, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–æ—Å—Ç —Å—Ç–µ–∫–∞

```go
package main

import (
    "fmt"
    "runtime"
    "unsafe"
)

func printStackInfo() {
    var buf [1024]byte
    n := runtime.Stack(buf[:], false)
    fmt.Printf("Stack size: %d bytes\n", n)
}

func recursiveFunction(depth int) {
    var localArray [256]byte // –í—ã–¥–µ–ª—è–µ–º –ø–∞–º—è—Ç—å –≤ —Å—Ç–µ–∫–µ
    
    if depth%100 == 0 {
        var m runtime.MemStats
        runtime.ReadMemStats(&m)
        fmt.Printf("Depth: %d, Stack alloc: %v\n", 
            depth, unsafe.Sizeof(localArray))
    }
    
    if depth > 0 {
        recursiveFunction(depth - 1)
    }
}

func main() {
    fmt.Printf("Initial goroutine count: %d\n", runtime.NumGoroutine())
    printStackInfo()
    
    // –í—ã–∑—ã–≤–∞–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–æ—Å—Ç–∞ —Å—Ç–µ–∫–∞
    recursiveFunction(500)
    
    printStackInfo()
}
```

## –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–µ–∫–∞

### Stack Guard

Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º "stack guard" –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–µ–∫–∞:

- **StackGuard0** ‚Äî –∑–∞—â–∏—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è Go-–∫–æ–¥–∞
- **StackGuard1** ‚Äî –∑–∞—â–∏—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è C-–∫–æ–¥–∞ (cgo)

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–∞–Ω–∏–∫–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "stack overflow".

### –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–µ–∫–∞

```go
func causeStackOverflow() {
    var huge [1024 * 1024]byte // 1MB –≤ —Å—Ç–µ–∫–µ - –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ
    _ = huge
    causeStackOverflow() // –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏—è
}

func main() {
    defer func() {
        if r := recover(); r != nil {
            fmt.Println("Recovered from:", r)
        }
    }()
    
    causeStackOverflow()
}
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏

### –ü–æ—Ç–æ–∫–∏ –û–°
```go
// –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏:
// - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ (1-8 –ú–ë)
// - –ë–æ–ª—å—à–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ
// - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (—Ç—ã—Å—è—á–∏)
// - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ—Ä–æ–≥–æ–µ
```

### –ì–æ—Ä—É—Ç–∏–Ω—ã Go
```go
// –ì–æ—Ä—É—Ç–∏–Ω—ã Go:
// - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (2 –ö–ë ‚Üí ...)
// - –ú–∞–ª–µ–Ω—å–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
// - –ú–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω –≤–æ–∑–º–æ–∂–Ω—ã
// - –î–µ—à–µ–≤–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–µ–∫–∞

```go
package main

import (
    "fmt"
    "runtime"
    "time"
)

func monitorStackUsage() {
    for {
        var m runtime.MemStats
        runtime.ReadMemStats(&m)
        
        fmt.Printf("Goroutines: %d, Stack in use: %d KB\n",
            runtime.NumGoroutine(),
            m.StackInuse/1024)
        
        time.Sleep(2 * time.Second)
    }
}

func createManyGoroutines() {
    for i := 0; i < 1000; i++ {
        go func(id int) {
            // –ö–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π —Å—Ç–µ–∫
            var localData [512]byte
            _ = localData
            time.Sleep(time.Minute)
        }(i)
    }
}

func main() {
    go monitorStackUsage()
    createManyGoroutines()
    
    select {} // –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
}
```

### –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞

```go
// –ü–ª–æ—Ö–æ: –±–æ–ª—å—à–∏–µ –º–∞—Å—Å–∏–≤—ã –≤ —Å—Ç–µ–∫–µ
func inefficient() {
    var largeArray [100000]byte // 100KB –≤ —Å—Ç–µ–∫–µ
    process(largeArray[:])
}

// –õ—É—á—à–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏–ª–∏ —Å—Ä–µ–∑–æ–≤
func efficient() {
    data := make([]byte, 100000) // –í –∫—É—á–µ
    process(data)
}

// –ò–ª–∏ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–µ–∫–µ
func optimized() {
    var smallArray [1024]byte // 1KB –≤ —Å—Ç–µ–∫–µ - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
    process(smallArray[:])
}
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞

### Escape Analysis

–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä Go –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –¥–æ–ª–∂–Ω—ã –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—â–∞—Ç—å—Å—è –≤ —Å—Ç–µ–∫–µ –∏–ª–∏ –∫—É—á–µ:

```go
func example() {
    x := 42 // –†–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ —Å—Ç–µ–∫–µ (–Ω–µ —É–±–µ–≥–∞–µ—Ç)
    y := make([]byte, 1024) // –ú–æ–∂–µ—Ç —Ä–∞–∑–º–µ—â–∞—Ç—å—Å—è –≤ —Å—Ç–µ–∫–µ –∏–ª–∏ –∫—É—á–µ
    
    // –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ y –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞—Ä—É–∂—É, –æ–Ω–∞ "—É–±–µ–≥–∞–µ—Ç" –≤ –∫—É—á—É
    return y // y —É–±–µ–≥–∞–µ—Ç –≤ –∫—É—á—É
}

func noEscape() *int {
    x := 42
    return &x // x —É–±–µ–≥–∞–µ—Ç –≤ –∫—É—á—É - –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è
}

func staysOnStack() int {
    x := 42
    return x // x –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å—Ç–µ–∫–µ
}
```

### Inlining –∏ —Å—Ç–µ–∫

```go
// –ú–∞–ª–µ–Ω—å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω—ã (inlined)
func smallFunction(a, b int) int {
    return a + b
}

func caller() {
    result := smallFunction(10, 20)
    // –ü–æ—Å–ª–µ inlining —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:
    // result := 10 + 20
    // –≠–∫–æ–Ω–æ–º—è—Ç—Å—è –≤—ã–∑–æ–≤—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞
}
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë–µ–Ω—á–º–∞—Ä–∫ —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω

```go
func BenchmarkGoroutineCreation(b *testing.B) {
    for i := 0; i < b.N; i++ {
        go func() {
            // –õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
        }()
    }
}

func BenchmarkStackIntensive(b *testing.B) {
    for i := 0; i < b.N; i++ {
        stackHeavyOperation()
    }
}

func stackHeavyOperation() {
    var data [1024]int
    for i := range data {
        data[i] = i * i
    }
}
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò–∑–±–µ–≥–∞–π—Ç–µ –≥–ª—É–±–æ–∫–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
2. **–ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–µ –º–∞—Å—Å–∏–≤—ã –≤ —Å—Ç–µ–∫–µ** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—É—á—É –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞** ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã** ‚Äî –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º
5. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ pprof –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–µ–∫–∞

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞**: 1GB –Ω–∞ 64-–±–∏—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞**: 2KB
- **–ó–∞—â–∏—Ç–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**: –¥–æ–±–∞–≤–ª—è—é—Ç –Ω–µ–±–æ–ª—å—à–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

–°—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–º–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏. –ü–æ–Ω–∏–º–∞–Ω–∏–µ –µ–≥–æ —Ä–∞–±–æ—Ç—ã –ø–æ–º–æ–≥–∞–µ—Ç –ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –Ω–∞–¥–µ–∂–Ω—ã–µ Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
# 11 - –ø–æ—Ç–æ–∫–∏

## –ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ—Ç–æ–∫–∏?

**–ü–æ—Ç–æ–∫–∏** (threads) ‚Äî —ç—Ç–æ –Ω–∞–∏–º–µ–Ω—å—à–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ. –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Go –ø–æ—Ç–æ–∫–∏ ‚Äî —ç—Ç–æ –ø–æ—Ç–æ–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–æ–≤ –≤ Go

### –ú–æ–¥–µ–ª—å M:P:G

Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

- **G (Goroutine)** ‚Äî –≥–æ—Ä—É—Ç–∏–Ω–∞, –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **M (Machine)** ‚Äî –ø–æ—Ç–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- **P (Processor)** ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä)

```
Runtime Go:
+---+---+---+
| P | P | P |  ‚Üê Processors (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = GOMAXPROCS)
+---+---+---+
  |   |   |
  M   M   M   ‚Üê Threads (OS Threads)
  |   |   |
  G   G   G   ‚Üê Goroutines
  G   G   G
  .   .   .
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ (M) –≤ Go

```go
// runtime/runtime2.go (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
type m struct {
    g0      *g     // –≥–æ—Ä—É—Ç–∏–Ω–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
    curg    *g     // —Ç–µ–∫—É—â–∞—è –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞
    p       puintptr // –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π P
    nextp   puintptr // —Å–ª–µ–¥—É—é—â–∏–π P
    oldp    puintptr // —Å—Ç–∞—Ä—ã–π P (–ø—Ä–∏ syscall)
    
    // –°–≤—è–∑—å —Å OS thread
    thread  uintptr // handle OS thread
    lockedg *g     // –≥–æ—Ä—É—Ç–∏–Ω–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–≤—à–∞—è —ç—Ç–æ—Ç thread
    
    // –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã
    syscall libcall // –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
    
    // –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à
    mcache *mcache
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ –≤ Go

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func monitorThreads() {
    for {
        var m runtime.MemStats
        runtime.ReadMemStats(&m)
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω
        goroutines := runtime.NumGoroutine()
        
        // –í Go –Ω–µ—Ç –ø—Ä—è–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤,
        // –Ω–æ –º–æ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        
        fmt.Printf("Goroutines: %d\n", goroutines)
        time.Sleep(2 * time.Second)
    }
}

func main() {
    go monitorThreads()
    
    // –°–æ–∑–¥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω
    var wg sync.WaitGroup
    for i := 0; i < 1000; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            time.Sleep(10 * time.Second)
        }(i)
    }
    
    wg.Wait()
}
```

### GOMAXPROCS - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º

```go
package main

import (
    "fmt"
    "runtime"
    "time"
)

func demonstrateGOMAXPROCS() {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    current := runtime.GOMAXPROCS(0)
    fmt.Printf("Current GOMAXPROCS: %d\n", current)
    fmt.Printf("Number of CPU cores: %d\n", runtime.NumCPU())
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    runtime.GOMAXPROCS(4)
    
    // –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É
    start := time.Now()
    
    var wg sync.WaitGroup
    for i := 0; i < 8; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            // CPU-intensive —Ä–∞–±–æ—Ç–∞
            sum := 0
            for j := 0; j < 100000000; j++ {
                sum += j
            }
            fmt.Printf("Goroutine %d completed\n", id)
        }(i)
    }
    
    wg.Wait()
    fmt.Printf("Work completed in %v\n", time.Since(start))
}
```

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –∏ –ø–æ—Ç–æ–∫–æ–≤

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –Ω–∞ –ø–æ—Ç–æ–∫–∞—Ö

```go
package main

import (
    "fmt"
    "runtime"
    "sync/atomic"
    "time"
)

func demonstrateScheduling() {
    var counter int32
    var wg sync.WaitGroup
    
    // –°–æ–∑–¥–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å, –Ω–∞ –∫–∞–∫–æ–º –ø–æ—Ç–æ–∫–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
    for i := 0; i < 10; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É
            time.Sleep(100 * time.Millisecond)
            
            // –ê—Ç–æ–º–∞—Ä–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
            atomic.AddInt32(&counter, 1)
            
            fmt.Printf("Goroutine %d completed (total: %d)\n", id, atomic.LoadInt32(&counter))
        }(i)
    }
    
    wg.Wait()
    fmt.Printf("All goroutines completed. Total: %d\n", counter)
}
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –ø–æ—Ç–æ–∫–∏

```go
package main

import (
    "fmt"
    "net/http"
    "sync"
    "time"
)

func demonstrateSyscalls() {
    var wg sync.WaitGroup
    urls := []string{
        "https://httpbin.org/delay/1",
        "https://httpbin.org/delay/2",
        "https://httpbin.org/delay/1",
        "https://httpbin.org/delay/3",
    }
    
    client := &http.Client{
        Timeout: 10 * time.Second,
    }
    
    for i, url := range urls {
        wg.Add(1)
        go func(id int, u string) {
            defer wg.Done()
            
            start := time.Now()
            fmt.Printf("Goroutine %d starting HTTP request to %s\n", id, u)
            
            resp, err := client.Get(u)
            if err != nil {
                fmt.Printf("Goroutine %d error: %v\n", id, err)
                return
            }
            resp.Body.Close()
            
            duration := time.Since(start)
            fmt.Printf("Goroutine %d completed in %v (status: %d)\n", 
                id, duration, resp.StatusCode)
        }(i, url)
    }
    
    wg.Wait()
    fmt.Println("All HTTP requests completed")
}
```

## –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –ø–æ—Ç–æ–∫–æ–≤ –≤ Go

### 1. –°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ—Ç–æ–∫ (g0)

–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ M –∏–º–µ–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É g0, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- –ó–∞–ø—É—Å–∫–∞ –Ω–æ–≤—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω
- –°–±–æ—Ä–∞ –º—É—Å–æ—Ä–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–µ–∫–æ–º

### 2. Signal Handling Thread

Go —Å–æ–∑–¥–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:
```go
// –≠—Ç–æ—Ç –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
// - SIGPROF (–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
// - SIGURG (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞)
// - –î—Ä—É–≥–∏–µ POSIX-—Å–∏–≥–Ω–∞–ª—ã
```

## –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –ø–æ—Ç–æ–∫–∏

### I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å–µ—Ç–µ–≤–æ–π –ø–æ–ª–ª–∏–Ω–≥

```go
package main

import (
    "fmt"
    "net"
    "sync"
    "time"
)

func demonstrateNetworkIO() {
    var wg sync.WaitGroup
    
    // –°–æ–∑–¥–∞–µ–º TCP —Å–µ—Ä–≤–µ—Ä
    listener, err := net.Listen("tcp", "localhost:0")
    if err != nil {
        panic(err)
    }
    defer listener.Close()
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
    go func() {
        for {
            conn, err := listener.Accept()
            if err != nil {
                return
            }
            go handleConnection(conn)
        }
    }()
    
    // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤
    address := listener.Addr().String()
    for i := 0; i < 5; i++ {
        wg.Add(1)
        go func(clientID int) {
            defer wg.Done()
            
            conn, err := net.Dial("tcp", address)
            if err != nil {
                fmt.Printf("Client %d: connection error: %v\n", clientID, err)
                return
            }
            defer conn.Close()
            
            message := fmt.Sprintf("Hello from client %d", clientID)
            conn.Write([]byte(message))
            
            buffer := make([]byte, 1024)
            n, _ := conn.Read(buffer)
            fmt.Printf("Client %d received: %s\n", clientID, string(buffer[:n]))
        }(i)
    }
    
    wg.Wait()
    time.Sleep(100 * time.Millisecond)
}

func handleConnection(conn net.Conn) {
    defer conn.Close()
    
    buffer := make([]byte, 1024)
    n, err := conn.Read(buffer)
    if err != nil {
        return
    }
    
    response := fmt.Sprintf("Echo: %s", string(buffer[:n]))
    conn.Write([]byte(response))
}
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```go
package main

import (
    "fmt"
    "os"
    "sync"
    "time"
)

func demonstrateBlockingSyscalls() {
    var wg sync.WaitGroup
    
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    filenames := make([]string, 5)
    for i := range filenames {
        file, err := os.CreateTemp("", "example")
        if err != nil {
            panic(err)
        }
        file.WriteString("Hello, World!")
        file.Close()
        filenames[i] = file.Name()
        defer os.Remove(file.Name())
    }
    
    // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã)
    for i, filename := range filenames {
        wg.Add(1)
        go func(id int, fn string) {
            defer wg.Done()
            
            start := time.Now()
            
            // –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
            data, err := os.ReadFile(fn)
            if err != nil {
                fmt.Printf("Goroutine %d error: %v\n", id, err)
                return
            }
            
            duration := time.Since(start)
            fmt.Printf("Goroutine %d read %d bytes in %v\n", 
                id, len(data), duration)
        }(i, filename)
    }
    
    wg.Wait()
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### Runtime LockOSThread

```go
package main

import (
    "fmt"
    "runtime"
    "sync"
    "time"
)

func demonstrateLockOSThread() {
    var wg sync.WaitGroup
    
    for i := 0; i < 3; i++ {
        wg.Add(1)
        go func(threadID int) {
            // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ—Ç–æ–∫—É –û–°
            runtime.LockOSThread()
            defer runtime.UnlockOSThread()
            defer wg.Done()
            
            fmt.Printf("Goroutine %d locked to OS thread\n", threadID)
            
            // –î–æ–ª–≥–∞—è —Ä–∞–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ
            for j := 0; j < 3; j++ {
                time.Sleep(500 * time.Millisecond)
                fmt.Printf("Goroutine %d working... (iteration %d)\n", threadID, j)
            }
            
            fmt.Printf("Goroutine %d completed\n", threadID)
        }(i)
    }
    
    wg.Wait()
    fmt.Println("All locked goroutines completed")
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

```go
package main

import (
    "fmt"
    "log"
    "os"
    "runtime"
    "runtime/pprof"
    "time"
)

func profileThreads() {
    // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    f, err := os.Create("thread_profile.prof")
    if err != nil {
        log.Fatal(err)
    }
    defer f.Close()
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º CPU –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
    if err := pprof.StartCPUProfile(f); err != nil {
        log.Fatal(err)
    }
    defer pprof.StopCPUProfile()
    
    // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞–±–æ—Ç—É
    performWork()
    
    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≥–æ—Ä—É—Ç–∏–Ω
    g, err := os.Create("goroutine_profile.pprof")
    if err != nil {
        log.Fatal(err)
    }
    defer g.Close()
    
    if err := pprof.Lookup("goroutine").WriteTo(g, 1); err != nil {
        log.Fatal(err)
    }
}

func performWork() {
    var wg sync.WaitGroup
    
    for i := 0; i < 50; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            
            // –°–º–µ—à–∞–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: CPU + I/O
            sum := 0
            for j := 0; j < 1000000; j++ {
                sum += j
            }
            
            time.Sleep(100 * time.Millisecond)
            
            _ = sum
        }(i)
    }
    
    wg.Wait()
}

func main() {
    fmt.Printf("GOMAXPROCS: %d\n", runtime.GOMAXPROCS(0))
    fmt.Printf("NumCPU: %d\n", runtime.NumCPU())
    
    profileThreads()
}
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏ –≤ Go

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GOMAXPROCS

```go
func main() {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    runtime.GOMAXPROCS(runtime.NumCPU())
    
    // –ò–ª–∏ —Ä—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    if os.Getenv("GOMAXPROCS") == "" {
        runtime.GOMAXPROCS(4)
    }
}
```

### 2. –ò–∑–±–µ–≥–∞–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤

```go
func efficientWork() {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º worker pool –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
    workers := runtime.NumCPU()
    jobs := make(chan Job, workers*2)
    results := make(chan Result, workers*2)
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤
    for i := 0; i < workers; i++ {
        go worker(i, jobs, results)
    }
}
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤

```go
func handleBlockingCalls() {
    // –î–ª—è –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö C –≤—ã–∑–æ–≤–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≥–æ—Ä—É—Ç–∏–Ω—ã
    go func() {
        // –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
        result := blockingCcall()
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    }()
}
```

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü—Ä–æ–±–ª–µ–º–∞: –ß—Ä–µ–∑–º–µ—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—É–ª–æ–≤

```go
func controlledConcurrency() {
    sem := make(chan struct{}, runtime.NumCPU()*2) // –°–µ–º–∞—Ñ–æ—Ä
    
    for i := 0; i < 100; i++ {
        sem <- struct{}{} // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–ª–æ—Ç
        go func(id int) {
            defer func() { <-sem }() // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å–ª–æ—Ç
            
            // –†–∞–±–æ—Ç–∞
            processItem(id)
        }(i)
    }
}
```

### 2. –ü—Ä–æ–±–ª–µ–º–∞: False Sharing

**–†–µ—à–µ–Ω–∏–µ**: –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```go
type PaddedCounter struct {
    counter int64
    _       [56]byte // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à-–ª–∏–Ω–∏–∏
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ—Ç–æ–∫–æ–≤ –≤ Go –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é –º–æ–¥–µ–ª—å M:P:G –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –û–° –æ–±—ã—á–Ω–æ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ, —á–µ–º GOMAXPROCS
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –î–ª—è –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞–µ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `runtime.LockOSThread()`
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞—é—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Go.
# 12 - –º—å—é—Ç–µ–∫—Å—ã

## –ß—Ç–æ —Ç–∞–∫–æ–µ –º—å—é—Ç–µ–∫—Å?

**–ú—å—é—Ç–µ–∫—Å** (mutual exclusion - –≤–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ) ‚Äî —ç—Ç–æ –ø—Ä–∏–º–∏—Ç–∏–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–∏–º —Ä–µ—Å—É—Ä—Å–∞–º –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ. –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –º—å—é—Ç–µ–∫—Å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –°–æ—Å—Ç–æ—è–Ω–∏—è –º—å—é—Ç–µ–∫—Å–∞
- **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (Locked)** ‚Äî –º—å—é—Ç–µ–∫—Å –∑–∞—Ö–≤–∞—á–µ–Ω –≥–æ—Ä—É—Ç–∏–Ω–æ–π
- **–°–≤–æ–±–æ–¥–µ–Ω (Unlocked)** ‚Äî –º—å—é—Ç–µ–∫—Å –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **Lock()** ‚Äî –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –º—å—é—Ç–µ–∫—Å (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ —É–∂–µ –∑–∞–Ω—è—Ç)
- **Unlock()** ‚Äî –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º—å—é—Ç–µ–∫—Å

## –¢–∏–ø—ã –º—å—é—Ç–µ–∫—Å–æ–≤ –≤ Go

### 1. sync.Mutex - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º—å—é—Ç–µ–∫—Å

```go
var mu sync.Mutex
var counter int

func increment() {
    mu.Lock()        // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –º—å—é—Ç–µ–∫—Å
    counter++        // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è
    mu.Unlock()      // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –º—å—é—Ç–µ–∫—Å
}
```

### 2. sync.RWMutex - —á–∏—Ç–∞—é—â–µ-–ø–∏—Å–∞—é—â–∏–π –º—å—é—Ç–µ–∫—Å

–ü–æ–∑–≤–æ–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏–ª–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—É—é –∑–∞–ø–∏—Å—å:

```go
var rwMu sync.RWMutex
var data map[string]string

func readData(key string) string {
    rwMu.RLock()          // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –¥–ª—è —á—Ç–µ–Ω–∏—è
    defer rwMu.RUnlock()  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º
    return data[key]
}

func writeData(key, value string) {
    rwMu.Lock()           // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –¥–ª—è –∑–∞–ø–∏—Å–∏
    defer rwMu.Unlock()   // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º
    data[key] = value
}
```

## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º—å—é—Ç–µ–∫—Å

–ö–æ–≥–¥–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `Lock()`:
1. –ï—Å–ª–∏ –º—å—é—Ç–µ–∫—Å —Å–≤–æ–±–æ–¥–µ–Ω ‚Äî –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
2. –ï—Å–ª–∏ –º—å—é—Ç–µ–∫—Å –∑–∞–Ω—è—Ç ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –µ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è
3. –ü—Ä–∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏ (`Unlock()`) –æ–¥–Ω–∞ –∏–∑ –æ–∂–∏–¥–∞—é—â–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø

### –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–ú—å—é—Ç–µ–∫—Å –≤ Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—É—Ç–∏ (fast path)
- **–û—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è** –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω
- **–ê–ª–≥–æ—Ä–∏—Ç–º —Å–∞–º–æ—Å–ø–∏–Ω–Ω–∏–Ω–≥–∞** –ø–µ—Ä–µ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—à–∞—é—Ç –º—å—é—Ç–µ–∫—Å—ã

### 1. –°–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–Ω–∫–∏ (Race Condition)
–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

### 2. –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, —á—Ç–æ —Å–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ.

### 3. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥—Ä—É–≥–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer –¥–ª—è Unlock()

```go
func safeOperation() {
    mu.Lock()
    defer mu.Unlock() // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
    // –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ–±—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
}
```

### 2. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –º—å—é—Ç–µ–∫—Å–∞

```go
// –ü–ª–æ—Ö–æ
func slowOperation() {
    mu.Lock()
    // –î–æ–ª–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
    result = heavyCalculation()
    sharedData = result
    mu.Unlock()
}

// –•–æ—Ä–æ—à–æ
func fastOperation() {
    result := heavyCalculation() // –í—ã—á–∏—Å–ª–µ–Ω–∏—è –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    mu.Lock()
    sharedData = result          // –¢–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å –ø–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
    mu.Unlock()
}
```

### 3. –ò–∑–±–µ–≥–∞–π—Ç–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

```go
// –û–ø–∞—Å–Ω—ã–π –∫–æ–¥ - –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ deadlock
func nestedLocks() {
    mu1.Lock()
    mu2.Lock() // –ï—Å–ª–∏ –¥—Ä—É–≥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ —Å–¥–µ–ª–∞–µ—Ç –Ω–∞–æ–±–æ—Ä–æ—Ç - deadlock
    // ...
    mu2.Unlock()
    mu1.Unlock()
}
```

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –ó–∞–±—ã—Ç—ã–π Unlock()
–ü—Ä–∏–≤–æ–¥–∏—Ç –∫ deadlock - –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∂–¥—É—Ç –≤–µ—á–Ω–æ.

### 2. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π Lock()
–ü–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å —É–∂–µ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–π –º—å—é—Ç–µ–∫—Å –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ deadlock.

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–ø–∏–π –º—å—é—Ç–µ–∫—Å–∞
–ú—å—é—Ç–µ–∫—Å—ã –Ω–µ–ª—å–∑—è –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å - –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏.

### 4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
–ú—å—é—Ç–µ–∫—Å –¥–æ–ª–∂–µ–Ω –∑–∞—â–∏—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç.

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –º—å—é—Ç–µ–∫—Å–∞–º

### 1. –ö–∞–Ω–∞–ª—ã
–î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∫–∞–Ω–∞–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –±–æ–ª–µ–µ –∏–¥–∏–æ–º–∞—Ç–∏—á–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º.

### 2. Atomic –æ–ø–µ—Ä–∞—Ü–∏–∏
–î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sync/atomic`.

### 3. sync.Map
–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ map.

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ú—å—é—Ç–µ–∫—Å—ã –≤ Go –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è:
- **–ù–∏–∑–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏** ‚Äî –±—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å —á–µ—Ä–µ–∑ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–í—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏** ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è
- **–°–∞–º–æ—Å–ø–∏–Ω–Ω–∏–Ω–≥–∞** ‚Äî –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú—å—é—Ç–µ–∫—Å—ã ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ Go. –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏—Ö —Ä–∞–±–æ—Ç—ã –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞: –∑–∞—â–∏—â–∞–π—Ç–µ –º—å—é—Ç–µ–∫—Å–æ–º –¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ –∫–æ–¥, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è.
# 13 - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω

## –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å –≥–æ—Ä—É—Ç–∏–Ω—ã?

–í Go **–Ω–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞** –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω –∏–∑–≤–Ω–µ. –≠—Ç–æ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö:

### –ü—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏** - —Ä–∏—Å–∫ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- **–£—Ç–µ—á–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤** - –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã, —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –º—å—é—Ç–µ–∫—Å—ã
- **–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å** - —Å–ª–æ–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –≥–æ—Ä—É—Ç–∏–Ω

### 1. –ü–∞—Ç—Ç–µ—Ä–Ω –æ—Ç–º–µ–Ω—ã —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª

```go
done := make(chan struct{})
go func() {
    for {
        select {
        case <-done:  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ–Ω—ã
            return    // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º—Å—è
        default:
            // –†–∞–±–æ—Ç–∞
        }
    }
}()

// –ó–∞–≤–µ—Ä—à–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É
close(done)
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Context

```go
ctx, cancel := context.WithCancel(context.Background())

go func(ctx context.Context) {
    for {
        select {
        case <-ctx.Done():  // –ü–æ–ª—É—á–∞–µ–º —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ–Ω—ã
            // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
            cleanup()
            return
        default:
            performWork()
        }
    }
}(ctx)

// –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
cancel()
```

### 3. –¢–∞–π–º–∞—É—Ç—ã –∏ –¥–µ–¥–ª–∞–π–Ω—ã

```go
// –ì–æ—Ä—É—Ç–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
defer cancel()

go worker(ctx)
```

## –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ó–∞–≤–∏—Å—à–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: –ì–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤:
```go
select {
case result := <-operationChan:
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
case <-time.After(5 * time.Second):
    // –¢–∞–π–º–∞—É—Ç - –≤—ã—Ö–æ–¥–∏–º –∏–∑ –≥–æ—Ä—É—Ç–∏–Ω—ã
    return
}
```

### 2. –ì–æ—Ä—É—Ç–∏–Ω—ã, –∏–≥–Ω–æ—Ä–∏—Ä—É—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã –æ—Ç–º–µ–Ω—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: –ì–æ—Ä—É—Ç–∏–Ω–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–Ω–∞–ª—ã –æ—Ç–º–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:
```go
func worker(ctx context.Context) {
    for i := 0; i < 1000; i++ {
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        if i%10 == 0 {
            select {
            case <-ctx.Done():
                return
            default:
            }
        }
        // –†–∞–±–æ—Ç–∞
    }
}
```

## –û–ø–∞—Å–Ω—ã–µ –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏

### 1. Runtime.Goexit (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```go
go func() {
    defer fmt.Println("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ")
    runtime.Goexit()  // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≥–æ—Ä—É—Ç–∏–Ω—É
}()
```

**–ü—Ä–æ–±–ª–µ–º—ã**: –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–∞–º —Ä–µ—Å—É—Ä—Å–æ–≤, –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º.

### 2. –ü–∞–Ω–∏–∫–∞ –≤ –≥–æ—Ä—É—Ç–∏–Ω–µ

```go
go func() {
    defer func() {
        if r := recover(); r != nil {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–Ω–∏–∫–∏
        }
    }()
    panic("–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ")
}()
```

**–ü—Ä–æ–±–ª–µ–º—ã**: –ù–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏.

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
```go
go func() {
    resource := acquireResource()
    defer releaseResource(resource)  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
    
    // –†–∞–±–æ—Ç–∞ —Å —Ä–µ—Å—É—Ä—Å–æ–º
}()
```

### 2. –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ –≥–æ—Ä—É—Ç–∏–Ω—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```go
type Worker struct {
    quit chan struct{}
}

func (w *Worker) Stop() {
    close(w.quit)  // –°–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
}
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```go
var wg sync.WaitGroup
wg.Add(1)

go func() {
    defer wg.Done()
    // –†–∞–±–æ—Ç–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã
}()

// –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
wg.Wait()
```

## –ò—Å–∫–ª—é—á–µ–Ω–∏—è: –∫–æ–≥–¥–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ

### 1. –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
```go
func TestTimeout(t *testing.T) {
    go func() {
        time.Sleep(10 * time.Second)  // –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    }()
    
    // –í —Ç–µ—Å—Ç–∞—Ö –∏–Ω–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∞–π–º–∞—É—Ç—ã
    select {
    case <-time.After(1 * time.Second):
        t.Fatal("—Ç–µ—Å—Ç –ø—Ä–µ–≤—ã—Å–∏–ª –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è")
    }
}
```

### 2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
```go
go func() {
    if criticalError {
        log.Fatal("–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞")  // –ó–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É
    }
}()
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í Go –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–º. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

- **–ö–∞–Ω–∞–ª—ã –æ—Ç–º–µ–Ω—ã** –¥–ª—è —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- **Context** –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç–º–µ–Ω—ã
- **–¢–∞–π–º–∞—É—Ç—ã** –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **WaitGroup** –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞—à–∏—Ö concurrent-–ø—Ä–æ–≥—Ä–∞–º–º.
# 14 - –∫–æ–Ω—Ç–µ–∫—Å—Ç

## –ß—Ç–æ —Ç–∞–∫–æ–µ Context?

**Context** (–∫–æ–Ω—Ç–µ–∫—Å—Ç) ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤ Go –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç–º–µ–Ω—ã –∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏. –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≥–æ—Ä—É—Ç–∏–Ω.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ Context:
- **–ü–µ—Ä–µ–¥–∞—á–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç–º–µ–Ω—ã** –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤** –∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤
- **–ü–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞—á–µ–Ω–∏–π** (request-scoped –¥–∞–Ω–Ω—ã—Ö)
- **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã** –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω

## –¢–∏–ø—ã Context

### 1. Background Context
```go
ctx := context.Background() // –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è
```

### 2. TODO Context
```go
ctx := context.TODO() // –ó–∞–≥–ª—É—à–∫–∞, –∫–æ–≥–¥–∞ –Ω–µ —è—Å–Ω–æ –∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
```

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã

#### WithCancel - —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã
```go
ctx, cancel := context.WithCancel(context.Background())
defer cancel() // –í–∞–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å cancel –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

// –ì–¥–µ-—Ç–æ –≤ –∫–æ–¥–µ: cancel() - –æ—Ç–º–µ–Ω—è–µ—Ç –≤—Å–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
```

#### WithTimeout - —Å —Ç–∞–π–º–∞—É—Ç–æ–º
```go
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
defer cancel()
```

#### WithDeadline - —Å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
```go
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è
deadline := time.Now().Add(2 * time.Hour)
ctx, cancel := context.WithDeadline(context.Background(), deadline)
defer cancel()
```

#### WithValue - –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–Ω–∞—á–µ–Ω–∏–π
```go
type keyType string
const userKey keyType = "user"

ctx := context.WithValue(context.Background(), userKey, "Alice")
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
```go
func worker(ctx context.Context) {
    for {
        select {
        case <-ctx.Done(): // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–º–µ–Ω—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            fmt.Println("Worker stopped:", ctx.Err())
            return
        default:
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞–±–æ—Ç—É
            performTask()
        }
    }
}
```

### –ü—Ä–∏–º–µ—Ä —Å HTTP –∑–∞–ø—Ä–æ—Å–æ–º
```go
func httpCallWithTimeout(ctx context.Context, url string) (string, error) {
    req, _ := http.NewRequestWithContext(ctx, "GET", url, nil)
    client := &http.Client{}
    
    resp, err := client.Do(req)
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()
    
    body, _ := io.ReadAll(resp.Body)
    return string(body), nil
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
ctx, cancel := context.WithTimeout(context.Background(), 3*time.Second)
defer cancel()

result, err := httpCallWithTimeout(ctx, "https://api.example.com")
```

## –ú–µ—Ç–æ–¥—ã Context –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### Deadline() 
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω
```go
if deadline, ok := ctx.Deadline(); ok {
    fmt.Println("Context will expire at:", deadline)
}
```

### Done()
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```go
select {
case <-ctx.Done():
    return ctx.Err() // Context canceled –∏–ª–∏ Deadline exceeded
}
```

### Err()
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –æ—Ç–º–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```go
if err := ctx.Err(); err != nil {
    switch err {
    case context.Canceled:
        fmt.Println("Context was canceled")
    case context.DeadlineExceeded:
        fmt.Println("Context deadline exceeded")
    }
}
```

### Value(key)
–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```go
if userID, ok := ctx.Value("userID").(string); ok {
    fmt.Println("User ID:", userID)
}
```

## Best Practices

### 1. –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ Context –∫–∞–∫ –ø–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
```go
// –ü—Ä–∞–≤–∏–ª—å–Ω–æ
func ProcessData(ctx context.Context, data []byte) error

// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ  
func ProcessData(data []byte, ctx context.Context) error
```

### 2. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ Context –≤ —Ü–∏–∫–ª–∞—Ö
```go
func longRunningTask(ctx context.Context) error {
    for i := 0; i < 1000; i++ {
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        if i%100 == 0 {
            select {
            case <-ctx.Done():
                return ctx.Err()
            default:
            }
        }
        // –†–∞–±–æ—Ç–∞
    }
    return nil
}
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer cancel()
```go
func operation() {
    ctx, cancel := context.WithTimeout(context.Background(), time.Second)
    defer cancel() // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º ctx
}
```

### 4. –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
```go
func handleRequest(parentCtx context.Context) {
    // –°–æ–∑–¥–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–º —Ç–∞–π–º–∞—É—Ç–æ–º
    ctx, cancel := context.WithTimeout(parentCtx, 100*time.Millisecond)
    defer cancel()
    
    processData(ctx)
}
```

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```go
// –ü–ª–æ—Ö–æ - —Ñ—É–Ω–∫—Ü–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
func badFunction(ctx context.Context) {
    time.Sleep(10 * time.Second) // –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–º–µ–Ω—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
}
```

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ WithValue
```go
// –ü–ª–æ—Ö–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∫–∞–∫ –∫–ª—é—á–µ–π
ctx := context.WithValue(ctx, "userID", 123)

// –•–æ—Ä–æ—à–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤
type contextKey string
const userIDKey contextKey = "userID"
ctx := context.WithValue(ctx, userIDKey, 123)
```

### 3. –£—Ç–µ—á–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω
```go
// –ü–ª–æ—Ö–æ - –≥–æ—Ä—É—Ç–∏–Ω–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–µ—á–Ω–æ
go func() {
    for {
        // —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    }
}()

// –•–æ—Ä–æ—à–æ - –≥–æ—Ä—É—Ç–∏–Ω–∞ —Å–ª—É—à–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
go func(ctx context.Context) {
    for {
        select {
        case <-ctx.Done():
            return
        default:
            // —Ä–∞–±–æ—Ç–∞
        }
    }
}(ctx)
```

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```go
package main

import (
    "context"
    "fmt"
    "time"
)

func databaseQuery(ctx context.Context, query string) (string, error) {
    // –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–ª–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
    select {
    case <-time.After(2 * time.Second):
        return "query result", nil
    case <-ctx.Done():
        return "", ctx.Err()
    }
}

func apiCall(ctx context.Context, url string) (string, error) {
    // –ò–º–∏—Ç–∞—Ü–∏—è API –≤—ã–∑–æ–≤–∞
    select {
    case <-time.After(1 * time.Second):
        return "api response", nil
    case <-ctx.Done():
        return "", ctx.Err()
    }
}

func processUserRequest(ctx context.Context, userID string) error {
    // –î–æ–±–∞–≤–ª—è–µ–º userID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    ctx = context.WithValue(ctx, "userID", userID)
    
    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ–±—â–∏–º —Ç–∞–π–º–∞—É—Ç–æ–º
    ctx, cancel := context.WithTimeout(ctx, 3*time.Second)
    defer cancel()
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    resultCh := make(chan string, 2)
    errCh := make(chan error, 2)
    
    go func() {
        result, err := databaseQuery(ctx, "SELECT * FROM users")
        if err != nil {
            errCh <- err
            return
        }
        resultCh <- result
    }()
    
    go func() {
        result, err := apiCall(ctx, "https://api.example.com/user")
        if err != nil {
            errCh <- err
            return
        }
        resultCh <- result
    }()
    
    // –û–∂–∏–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for i := 0; i < 2; i++ {
        select {
        case result := <-resultCh:
            fmt.Println("Received:", result)
        case err := <-errCh:
            return err
        case <-ctx.Done():
            return ctx.Err()
        }
    }
    
    return nil
}

func main() {
    ctx := context.Background()
    
    if err := processUserRequest(ctx, "user123"); err != nil {
        fmt.Println("Error:", err)
    }
}
```

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Context

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- **HTTP handlers** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `r.Context()`
- **GRPC** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã
- **–†–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ API** –∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- **–õ—é–±—ã–µ –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –¥–∞–Ω–Ω—ã—Ö
- **–°–µ—Ä–≤–∏—Å—ã** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é graceful shutdown

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Context ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ–ø–µ—Ä–∞—Ü–∏–π –≤ Go. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏
- –û–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≥–æ—Ä—É—Ç–∏–Ω
- –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å graceful shutdown

–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–µ-—Ñ–∞–∫—Ç–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç–º–µ–Ω—ã –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
# 15 - select

## –ß—Ç–æ —Ç–∞–∫–æ–µ select?

**Select** ‚Äî —ç—Ç–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ Go, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω–µ –æ–∂–∏–¥–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–Ω–∞–ª–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –≠—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ switch, –Ω–æ –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤.

## –ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

```go
select {
case <-channel1:
    // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ channel1
case data := <-channel2:
    // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ channel2
case channel3 <- value:
    // –æ—Ç–ø—Ä–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞
default:
    // –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –Ω–µ –≥–æ—Ç–æ–≤
}
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –û–∂–∏–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
```go
ch1 := make(chan string)
ch2 := make(chan int)

go func() {
    time.Sleep(1 * time.Second)
    ch1 <- "hello"
}()

go func() {
    time.Sleep(2 * time.Second) 
    ch2 <- 42
}()

select {
case msg := <-ch1:
    fmt.Println("Received:", msg)
case num := <-ch2:
    fmt.Println("Received:", num)
}
```

### 2. –¢–∞–π–º–∞—É—Ç—ã
```go
select {
case result := <-longOperation():
    fmt.Println("Operation completed:", result)
case <-time.After(3 * time.Second):
    fmt.Println("Operation timed out")
}
```

### 3. Non-blocking –æ–ø–µ—Ä–∞—Ü–∏–∏
```go
select {
case value := <-channel:
    fmt.Println("Received:", value)
default:
    fmt.Println("No value ready") // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –û–∂–∏–¥–∞–Ω–∏–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
```go
func waitWithTimeout() {
    done := make(chan bool)
    
    go func() {
        time.Sleep(5 * time.Second) // –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
        done <- true
    }()
    
    select {
    case <-done:
        fmt.Println("Operation completed")
    case <-time.After(3 * time.Second):
        fmt.Println("Timeout exceeded")
    }
}
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```go
func prioritySelect() {
    urgent := make(chan string)
    normal := make(chan string)
    
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    select {
    case msg := <-urgent:
        fmt.Println("Urgent:", msg)
    case msg := <-normal:
        fmt.Println("Normal:", msg) 
    default:
        fmt.Println("No messages")
    }
}
```

### Multiple select –≤ —Ü–∏–∫–ª–µ
```go
func worker(stopCh <-chan struct{}, dataCh <-chan int) {
    for {
        select {
        case data := <-dataCh:
            fmt.Println("Processing:", data)
        case <-stopCh:
            fmt.Println("Worker stopping")
            return
        }
    }
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã

### –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –≥–æ—Ç–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
```go
ch1 := make(chan int, 1)
ch2 := make(chan int, 1)

ch1 <- 1
ch2 <- 2

// –í—ã–±–æ—Ä —Å–ª—É—á–∞—è –±—É–¥–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–º
select {
case v := <-ch1:
    fmt.Println("From ch1:", v)
case v := <-ch2:
    fmt.Println("From ch2:", v)
}
```

### Select —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –∫–∞–Ω–∞–ª—ã
```go
func sendWithBackpressure() {
    ch := make(chan int, 1)
    
    // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    select {
    case ch <- 42:
        fmt.Println("Sent successfully")
    default:
        fmt.Println("Channel full, skipping")
    }
}
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. Graceful shutdown
```go
func server(shutdownCh <-chan struct{}, requests <-chan Request) {
    for {
        select {
        case req := <-requests:
            handleRequest(req)
        case <-shutdownCh:
            cleanup()
            return
        }
    }
}
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```go
func operationWithDeadline() error {
    resultCh := make(chan string)
    
    go func() {
        result := expensiveOperation()
        resultCh <- result
    }()
    
    select {
    case result := <-resultCh:
        fmt.Println("Success:", result)
        return nil
    case <-time.After(5 * time.Second):
        return errors.New("operation timed out")
    }
}
```

### 3. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
```go
func periodicWorker() {
    ticker := time.NewTicker(1 * time.Second)
    defer ticker.Stop()
    
    for {
        select {
        case <-ticker.C:
            performPeriodicTask()
        case <-stopCh:
            return
        }
    }
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—ã—Ö –∫–∞–Ω–∞–ª–æ–≤

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞–Ω–∞–ª–∞
```go
func readUntilClosed(ch <-chan int) {
    for {
        select {
        case value, ok := <-ch:
            if !ok {
                fmt.Println("Channel closed")
                return
            }
            fmt.Println("Received:", value)
        }
    }
}
```

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏

### Select —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
```go
func operationWithContext(ctx context.Context, ch <-chan int) {
    for {
        select {
        case data := <-ch:
            process(data)
        case <-ctx.Done():
            fmt.Println("Context canceled:", ctx.Err())
            return
        }
    }
}
```

### –ú—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
```go
func fanIn(inputs ...<-chan int) <-chan int {
    output := make(chan int)
    
    for _, input := range inputs {
        go func(ch <-chan int) {
            for value := range ch {
                output <- value
            }
        }(input)
    }
    
    return output
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
func main() {
    ch1 := make(chan int)
    ch2 := make(chan int)
    
    multiplexed := fanIn(ch1, ch2)
    
    for value := range multiplexed {
        fmt.Println("Received:", value)
    }
}
```

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. Deadlock —Å –ø—É—Å—Ç—ã–º select
```go
select {} // –í–µ—á–Ω—ã–π deadlock
```

### 2. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
```go
select {
case value := <-ch: // –ú–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
    // ...
}
```

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å default
```go
// –ü–ª–æ—Ö–æ - –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å busy loop
for {
    select {
    case data := <-ch:
        process(data)
    default:
        // –ü—É—Å—Ç–æ–π default —Å–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
    }
}

// –õ—É—á—à–µ - –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –ø–∞—É–∑—É
for {
    select {
    case data := <-ch:
        process(data)
    default:
        time.Sleep(10 * time.Millisecond)
    }
}
```

## Best Practices

### 1. –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤—Å–µ —Å–ª—É—á–∞–∏
```go
select {
case result := <-resultCh:
    handleResult(result)
case err := <-errorCh:
    handleError(err)
case <-time.After(timeout):
    handleTimeout()
}
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ default –¥–ª—è non-blocking –æ–ø–µ—Ä–∞—Ü–∏–π
```go
select {
case ch <- value:
    // –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
default:
    // –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º—Å—è –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –ø–æ–ª–Ω—ã–π
}
```

### 3. –ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–ª—è –æ—Ç–º–µ–Ω—ã
```go
select {
case <-ctx.Done():
    return ctx.Err()
case result := <-operation():
    return result
}
```

### 4. –ò–∑–±–µ–≥–∞–π—Ç–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö select
```go
// –ü–ª–æ—Ö–æ
select {
case a := <-ch1:
    select {
    case b := <-ch2:
        // —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
    }
}

// –õ—É—á—à–µ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

Select –≤ Go –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω:
- **O(1)** —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
- **–°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ–ª–æ–¥–∞–Ω–∏–µ
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Select ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –≤ Go. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω
- –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –∏ –¥–µ–¥–ª–∞–π–Ω—ã
- –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã

–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ select –¥–µ–ª–∞–µ—Ç Go-–ø—Ä–æ–≥—Ä–∞–º–º—ã –±–æ–ª–µ–µ –æ—Ç–∑—ã–≤—á–∏–≤—ã–º–∏, –Ω–∞–¥–µ–∂–Ω—ã–º–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏.
# 16 - –≤–∏–¥—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç
# 17 - –ü—Ä–∏–º–∏—Ç–∏–≤—ã Lock\RWlock
# 18 - –∫–∞–Ω–∞–ª—ã
# 19 - –∞—Ç–æ–º–∏–∫–∏
# 20 - REST
# 21 - grpc
# 22 - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
# 23 - basic auth
# 24 - jwt
# 25 - –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–∏–Ω–∞—Ä–∫–∏–∫ —á–µ—Ä–µ–∑ get-–∑–∞–ø—Ä–æ—Å
# 26 - –ò–Ω–¥–µ–∫—Å—ã –≤ Postgres
# 27 - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Ç–∞–±–ª–∏—Ü—ã
# 28 -
# 29 -
# 30 -